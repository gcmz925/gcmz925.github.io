<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.23.1","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js" defer></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Hexo</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  






  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Hexo</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>







</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">39</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/07/07/Windows%20C++%20%E9%A1%B9%E7%9B%AE%E5%AE%9E%E7%8E%B0%20GNU%20gettext%20%E5%9B%BD%E9%99%85%E5%8C%96%E6%94%AF%E6%8C%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/07/Windows%20C++%20%E9%A1%B9%E7%9B%AE%E5%AE%9E%E7%8E%B0%20GNU%20gettext%20%E5%9B%BD%E9%99%85%E5%8C%96%E6%94%AF%E6%8C%81/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2025-07-07 00:24:31 / Modified: 23:27:02" itemprop="dateCreated datePublished" datetime="2025-07-07T00:24:31+08:00">2025-07-07</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>åœ¨ Linux å¼€å‘ä¸­ï¼ŒGNU <code>gettext</code> æ˜¯å®ç°å›½é™…åŒ–ï¼ˆi18nï¼‰çš„ç»å…¸æ–¹å¼ï¼Œå°¤å…¶é€‚åˆ C&#x2F;C++ é¡¹ç›®ã€‚ä½†åœ¨ Windows ä¸Šï¼Œ<code>gettext</code> æ²¡æœ‰å®˜æ–¹æä¾›çš„ MSVC æ”¯æŒåº“ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨æ„å»ºæ‰€éœ€åº“ï¼Œå¹¶è®¾ç½®å¥½é¡¹ç›®ç¯å¢ƒã€‚</p>
<p>è¿™ç¯‡åšå®¢å°†è¯¦ç»†ä»‹ç»åœ¨ Windows + Visual Studio ä¸‹ï¼Œé€šè¿‡æ‰‹åŠ¨ç¼–è¯‘ <code>gettext</code> æºç å®ç°å¤šè¯­è¨€æ”¯æŒçš„å…¨è¿‡ç¨‹ï¼Œå¹¶é¢å¤–ä»‹ç»é€šè¿‡èµ„æºæ–‡ä»¶ï¼ˆ.rcï¼‰å®ç°å¤šè¯­è¨€åˆ‡æ¢çš„å¦ä¸€ç§æ–¹å¼ã€‚</p>
<hr>
<h2 id="ä¸€ã€å‡†å¤‡-gettext-å¼€å‘ç¯å¢ƒ"><a href="#ä¸€ã€å‡†å¤‡-gettext-å¼€å‘ç¯å¢ƒ" class="headerlink" title="ä¸€ã€å‡†å¤‡ gettext å¼€å‘ç¯å¢ƒ"></a>ä¸€ã€å‡†å¤‡ gettext å¼€å‘ç¯å¢ƒ</h2><h3 id="1-1-ä¸‹è½½ä¸æ„å»º-gettext-for-Windows"><a href="#1-1-ä¸‹è½½ä¸æ„å»º-gettext-for-Windows" class="headerlink" title="1.1 ä¸‹è½½ä¸æ„å»º gettext for Windows"></a>1.1 ä¸‹è½½ä¸æ„å»º <code>gettext</code> for Windows</h3><p><code>GNU gettext-0.18.3.2</code> æ˜¯ç›®å‰è¾ƒæ–°çš„ç‰ˆæœ¬ï¼Œå¯ä»¥åœ¨ <a target="_blank" rel="noopener" href="http://www.gnu.org/software/gettext/">GNU å®˜ç½‘</a> ä¸‹è½½æºç ã€‚ä½†å®˜æ–¹å¹¶æœªæä¾› Visual Studio (MSVC) çš„é¢„ç¼–è¯‘ç‰ˆæœ¬ã€‚</p>
<p>ğŸ‘‰ æ¨èä½¿ç”¨è¿™ä¸ªç°æˆçš„ MSVC å·¥ç¨‹æ¨¡æ¿ï¼š<a target="_blank" rel="noopener" href="https://github.com/gcmz925/gettext-msvc-2019">gettext-msvc-2019</a></p>
<p>å…‹éš†é¡¹ç›®åï¼Œç›´æ¥ç”¨ Visual Studio æ‰“å¼€ <code>.sln</code> å¹¶ç¼–è¯‘ï¼Œä¼šç”Ÿæˆä¸¤ä¸ªåº“æ–‡ä»¶ï¼š</p>
<ul>
<li><p><code>libiconv.lib</code></p>
</li>
<li><p><code>libintl.lib</code></p>
</li>
</ul>
<p>ç”Ÿæˆåå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202507072250947.png" alt="ç¼–è¯‘ libintl å’Œ libiconv"></p>
<hr>
<h3 id="1-2-åˆ›å»ºä½ çš„å·¥ç¨‹å¹¶é…ç½®ä¾èµ–"><a href="#1-2-åˆ›å»ºä½ çš„å·¥ç¨‹å¹¶é…ç½®ä¾èµ–" class="headerlink" title="1.2 åˆ›å»ºä½ çš„å·¥ç¨‹å¹¶é…ç½®ä¾èµ–"></a>1.2 åˆ›å»ºä½ çš„å·¥ç¨‹å¹¶é…ç½®ä¾èµ–</h3><p>æ–°å»ºä¸€ä¸ª Visual Studio C++ å·¥ç¨‹ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p>
<ul>
<li><p>æ·»åŠ å¤´æ–‡ä»¶è·¯å¾„ï¼š<code>gettext</code> æºç ä¸­çš„ <code>intl</code> æ–‡ä»¶å¤¹</p>
</li>
<li><p>æ·»åŠ  lib ç›®å½•ï¼šåŒ…å« <code>libiconv.lib</code> å’Œ <code>libintl.lib</code> çš„è·¯å¾„</p>
</li>
<li><p>é“¾æ¥åº“ï¼šåœ¨ <code>é“¾æ¥å™¨ -&gt; è¾“å…¥ -&gt; é™„åŠ ä¾èµ–é¡¹</code> æ·»åŠ è¿™ä¸¤ä¸ªåº“</p>
</li>
</ul>
<p><img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202507072253889.png" alt="é…ç½®é¡¹ç›®å±æ€§"></p>
<hr>
<h3 id="1-3-ç¤ºä¾‹ä»£ç "><a href="#1-3-ç¤ºä¾‹ä»£ç " class="headerlink" title="1.3 ç¤ºä¾‹ä»£ç "></a>1.3 ç¤ºä¾‹ä»£ç </h3><p>åˆ›å»º <code>main.c</code> æ–‡ä»¶å¹¶å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;libgnuintl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;locale.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib, <span class="string">&quot;E:\\Develop\\EveryDay\\20250706\\gettext-msvc\\Release-x64\\libiconv.lib&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib, <span class="string">&quot;E:\\Develop\\EveryDay\\20250706\\gettext-msvc\\Release-x64\\libintl.lib&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _(STRING) gettext(STRING)  <span class="comment">// å®ç”¨äºç®€åŒ–ç¿»è¯‘è°ƒç”¨</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL, <span class="string">&quot;&quot;</span>); <span class="comment">// è‡ªåŠ¨è¯»å– LANG ç¯å¢ƒå˜é‡</span></span><br><span class="line">    <span class="built_in">bindtextdomain</span>(<span class="string">&quot;myapp&quot;</span>, <span class="string">&quot;./locale&quot;</span>);</span><br><span class="line">    <span class="built_in">textdomain</span>(<span class="string">&quot;myapp&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, _(<span class="string">&quot;Hello, World!&quot;</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, _(<span class="string">&quot;Goodbye!&quot;</span>));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="äºŒã€ç”Ÿæˆç¿»è¯‘æ–‡ä»¶"><a href="#äºŒã€ç”Ÿæˆç¿»è¯‘æ–‡ä»¶" class="headerlink" title="äºŒã€ç”Ÿæˆç¿»è¯‘æ–‡ä»¶"></a>äºŒã€ç”Ÿæˆç¿»è¯‘æ–‡ä»¶</h2><h3 id="2-1-ä½¿ç”¨-xgettext-æå–æ–‡æœ¬"><a href="#2-1-ä½¿ç”¨-xgettext-æå–æ–‡æœ¬" class="headerlink" title="2.1 ä½¿ç”¨ xgettext æå–æ–‡æœ¬"></a>2.1 ä½¿ç”¨ <code>xgettext</code> æå–æ–‡æœ¬</h3><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä»ä»£ç ä¸­æå–éœ€è¦ç¿»è¯‘çš„å­—ç¬¦ä¸²ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xgettext -k_ -o myapp.po main.c</span><br></pre></td></tr></table></figure>

<p>âš ï¸ å¦‚æœä»£ç æ–‡ä»¶æ˜¯ UTF-8 ç¼–ç ï¼Œè®°å¾—æ·»åŠ ç¼–ç å‚æ•°ï¼Œå¦åˆ™ä¼šæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xgettext: Non-ASCII string at main.c:...</span><br><span class="line">Please specify the source encoding through --from-code.</span><br></pre></td></tr></table></figure>

<p>æ”¹ä¸ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xgettext --from-code=UTF-8 -k_ -o myapp.po main.c</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="2-2-ç¼–è¾‘-po-æ–‡ä»¶"><a href="#2-2-ç¼–è¾‘-po-æ–‡ä»¶" class="headerlink" title="2.2 ç¼–è¾‘ .po æ–‡ä»¶"></a>2.2 ç¼–è¾‘ <code>.po</code> æ–‡ä»¶</h3><p>åœ¨ <code>msgstr &quot;&quot;</code> ä¸­å¡«å†™ç¿»è¯‘åçš„æ–‡æœ¬ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">msgid &quot;Hello, World!&quot;</span><br><span class="line">msgstr &quot;ä½ å¥½ï¼Œä¸–ç•Œï¼&quot;</span><br><span class="line"></span><br><span class="line">msgid &quot;Goodbye!&quot;</span><br><span class="line">msgstr &quot;å†è§ï¼&quot;</span><br></pre></td></tr></table></figure>

<p>ç¤ºæ„å›¾ï¼š</p>
<p><img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202507072317737.png" alt="ç¼–è¾‘ po æ–‡ä»¶"></p>
<hr>
<h3 id="2-3-ç¼–è¯‘-po-ä¸º-mo"><a href="#2-3-ç¼–è¯‘-po-ä¸º-mo" class="headerlink" title="2.3 ç¼–è¯‘ .po ä¸º .mo"></a>2.3 ç¼–è¯‘ <code>.po</code> ä¸º <code>.mo</code></h3><p>åˆ›å»ºç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">main.exe</span><br><span class="line">locale/</span><br><span class="line">â””â”€â”€ zh_CN/</span><br><span class="line">    â””â”€â”€ LC_MESSAGES/</span><br><span class="line">        â””â”€â”€ myapp.po</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msgfmt -o ./locale/zh_CN/LC_MESSAGES/myapp.mo ./locale/zh_CN/LC_MESSAGES/myapp.po</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç¨‹åºåï¼Œçœ‹åˆ°å¦‚ä¸‹è¾“å‡ºè¡¨ç¤ºæˆåŠŸï¼š</p>
<p><img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202507072320486.png" alt="ç¿»è¯‘ç»“æœ"></p>
<hr>
<h2 id="ä¸‰ã€å¸¸è§é—®é¢˜æ±‡æ€»"><a href="#ä¸‰ã€å¸¸è§é—®é¢˜æ±‡æ€»" class="headerlink" title="ä¸‰ã€å¸¸è§é—®é¢˜æ±‡æ€»"></a>ä¸‰ã€å¸¸è§é—®é¢˜æ±‡æ€»</h2><ol>
<li><p><strong>DLL ç‰ˆæœ¬ä¸ä¸€è‡´</strong><br> æ£€æŸ¥æ˜¯å¦ 64 ä½ç¨‹åºè¯¯ç”¨äº† 32 ä½çš„ DLLï¼Œæˆ–ç‰ˆæœ¬ä¸åŒ¹é…ã€‚</p>
</li>
<li><p><strong>ç¼–ç é”™è¯¯</strong><br> Windows ä¸Šé»˜è®¤æ˜¯ ANSI ç¼–ç ï¼Œå»ºè®®ç»Ÿä¸€ä¸º UTF-8ï¼Œå¹¶ç”¨ <code>--from-code=UTF-8</code> æ˜ç¡®æŒ‡å®šã€‚</p>
</li>
<li><p><strong>ç¯å¢ƒå˜é‡ LANG æ²¡è®¾ç½®</strong><br> å¯ä»¥æ‰‹åŠ¨è®¾ç½®ç¯å¢ƒå˜é‡ <code>LANG=zh_CN</code> æ¥å¼ºåˆ¶è¯­è¨€åŠ è½½ã€‚</p>
</li>
</ol>
<hr>
<h2 id="å››ã€æ›¿ä»£æ–¹æ¡ˆï¼šä½¿ç”¨-rc-èµ„æºæ–‡ä»¶åšå¤šè¯­è¨€åˆ‡æ¢"><a href="#å››ã€æ›¿ä»£æ–¹æ¡ˆï¼šä½¿ç”¨-rc-èµ„æºæ–‡ä»¶åšå¤šè¯­è¨€åˆ‡æ¢" class="headerlink" title="å››ã€æ›¿ä»£æ–¹æ¡ˆï¼šä½¿ç”¨ .rc èµ„æºæ–‡ä»¶åšå¤šè¯­è¨€åˆ‡æ¢"></a>å››ã€æ›¿ä»£æ–¹æ¡ˆï¼šä½¿ç”¨ <code>.rc</code> èµ„æºæ–‡ä»¶åšå¤šè¯­è¨€åˆ‡æ¢</h2><p>é™¤äº† gettextï¼Œä¹Ÿå¯ä»¥é€šè¿‡ Windows çš„èµ„æºæ–‡ä»¶ <code>.rc</code> æ¥æ”¯æŒå¤šè¯­è¨€ï¼š</p>
<ul>
<li><p>ä¸ºæ¯ç§è¯­è¨€ç”Ÿæˆä¸€ä¸ªèµ„æº DLLï¼ˆå¸¦ç‰¹å®šè¯­è¨€ IDï¼‰</p>
</li>
<li><p>ä¸»ç¨‹åºæ ¹æ®ç³»ç»Ÿè¯­è¨€æˆ–ç”¨æˆ·è®¾ç½®åŠ è½½å¯¹åº”çš„ DLL</p>
</li>
<li><p>é€šè¿‡ <code>LoadString()</code> è·å–ç¿»è¯‘æ–‡æœ¬</p>
</li>
</ul>
<p>ğŸ‘‰ å‚è€ƒæ–‡ç« ï¼š<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/8989cb6727f0">ç”¨ .rc æ–‡ä»¶åšå¤šè¯­è¨€</a></p>
<p>è¿™ç§æ–¹å¼æ›´åŠ è´´åˆ Windows å¹³å°ç‰¹æ€§ï¼Œä½†ä¸å¤Ÿè·¨å¹³å°ã€‚è‹¥é¡¹ç›®éœ€å…¼å®¹ Linuxã€macOSï¼Œæ¨èè¿˜æ˜¯ä½¿ç”¨ gettextã€‚</p>
<hr>
<h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>è™½ç„¶åœ¨ Windows ä¸Šä½¿ç”¨ <code>gettext</code> éœ€è¦ä¸€äº›é¢å¤–çš„é…ç½®ä¸æ„å»ºå·¥ä½œï¼Œä½†ä¸€æ—¦æ­å»ºæˆåŠŸï¼Œå¤šè¯­è¨€æ”¯æŒå°±å˜å¾—éå¸¸è½»æ¾å’Œè§„èŒƒã€‚å¸Œæœ›æœ¬æ–‡èƒ½å¸®ä½ å°‘è¸©å‘ï¼Œé¡ºåˆ©å®Œæˆ C++ é¡¹ç›®çš„å›½é™…åŒ–å·¥ä½œã€‚</p>
<p>å¦‚æœ‰é—®é¢˜æ¬¢è¿ç•™è¨€äº¤æµ ğŸ‘‡</p>
<hr>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/06/22/debug/%E4%BE%8B%E5%AD%90/PE%E6%96%87%E4%BB%B6%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/06/22/debug/%E4%BE%8B%E5%AD%90/PE%E6%96%87%E4%BB%B6%E5%88%86%E6%9E%90/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2025-06-22 22:53:55 / Modified: 23:14:52" itemprop="dateCreated datePublished" datetime="2025-06-22T22:53:55+08:00">2025-06-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>ä¹¦æ¥ä¸Šæ–‡ï¼Œæ¥ç€æ¥å¤„ç†ä¸€ä¸‹PEæ–‡ä»¶çš„å¯¼å…¥è¡¨</p>
<h3 id="å¯¼å…¥è¡¨"><a href="#å¯¼å…¥è¡¨" class="headerlink" title="å¯¼å…¥è¡¨"></a>å¯¼å…¥è¡¨</h3><p>å¯¼å…¥è¡¨ä½ç½®å’Œå¤§å°å¯ä»¥ä»PEæ–‡ä»¶å¤´ä¸­<code>IMAGE_OPTIONAL_HEADER32</code>ç»“æ„çš„<code>IMAGE_DATA_DIRECTORY</code>æ•°æ®ç›®å½•å­—æ®µä¸­è·å–ï¼Œä»<code>IMAGE_DATA_DIRECTORY</code>å­—æ®µå¾—åˆ°çš„æ˜¯å¯¼å…¥è¡¨çš„RVAå€¼ï¼Œå¦‚æœåœ¨å†…å­˜ä¸­æŸ¥æ‰¾å¯¼å…¥è¡¨ï¼Œé‚£ä¹ˆå°†RVAå€¼åŠ ä¸ŠPEæ–‡ä»¶è£…å…¥çš„åŸºå€å°±æ˜¯å®é™…çš„åœ°å€ã€‚</p>
<p>æ‰¾åˆ°äº†æ•°æ®ç›®å½•ç»“æ„ï¼Œæ—¢èƒ½å¤Ÿæ‰¾åˆ°å¯¼å…¥è¡¨ï¼Œå¯¼å…¥è¡¨ç”±ä¸€ç³»åˆ—çš„<code>IMAGE_IMPORT_DESCRIPTOR</code>ç»“æ„ç»„æˆï¼Œç»“æ„çš„æ•°é‡å–å†³äºç¨‹åºéœ€è¦ä½¿ç”¨çš„DLLæ–‡ä»¶æ•°é‡ï¼Œæ¯ä¸ªç»“æ„å¯¹åº”ä¸€ä¸ªDLLæ–‡ä»¶ï¼Œåœ¨æ‰€æœ‰ç»“æ„çš„æœ€åï¼Œç”±ä¸€ä¸ªå†…å®¹å…¨ä¸º0çš„<code>IMAGE_IMPORT_DESCRIPTOR</code>ç»“æ„ä½œä¸ºç»“æŸæ ‡å¿—ï¼Œè¡¨ç»“æ„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_IMAGE_IMPORT_DESCRIPTOR</span> &#123;</span><br><span class="line">    <span class="keyword">union</span> &#123;</span><br><span class="line">        DWORD   Characteristics;</span><br><span class="line">        DWORD   OriginalFirstThunk;     <span class="comment">// åŒ…å«æŒ‡å‘IMAGE_THUNK_DATA(è¾“å…¥åç§°è¡¨)ç»“æ„çš„æ•°ç»„</span></span><br><span class="line">    &#125; DUMMYUNIONNAME;</span><br><span class="line">    DWORD   TimeDateStamp;              <span class="comment">// å½“å¯æ‰§è¡Œæ–‡ä»¶ä¸ä¸è¢«è¾“å…¥çš„DLLè¿›è¡Œç»‘å®šæ—¶ï¼Œæ­¤å­—æ®µä¸º0 </span></span><br><span class="line">    DWORD   ForwarderChain;             <span class="comment">// ç¬¬ä¸€ä¸ªè¢«è½¬å‘çš„APIçš„ç´¢å¼•</span></span><br><span class="line">    DWORD   Name;                       <span class="comment">// æŒ‡å‘è¢«è¾“å…¥çš„DLLçš„ASCIIå­—ç¬¦ä¸²çš„RVA</span></span><br><span class="line">    DWORD   FirstThunk;                 <span class="comment">// æŒ‡å‘è¾“å…¥åœ°å€è¡¨(IAT)çš„RVA</span></span><br><span class="line">&#125; IMAGE_IMPORT_DESCRIPTOR;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>OriginalFirstThunk</code>å’Œ<code>FirstThunk</code>å­—æ®µæ˜¯ç›¸åŒçš„ï¼Œä»–ä»¬éƒ½æŒ‡å‘ä¸€ä¸ªåŒ…å«<code>IMAGE_THUNK_DATA</code>ç»“æ„çš„æ•°ç»„ï¼Œæ•°ç»„ä¸­æ¯ä¸ª<code>IMAGE_THUNK_DATA</code>ç»“æ„å®šä¹‰äº†ä¸€ä¸ªå¯¼å…¥å‡½æ•°çš„å…·ä½“ä¿¡æ¯ï¼Œæ•°ç»„çš„æœ€åä»¥ä¸€ä¸ªå†…å®¹å…¨ä¸º0çš„<code>IMAGE_THUNK_DATA</code>ç»“æ„ä½œä¸ºç»“æŸï¼Œè¯¥ç»“æ„çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_IMAGE_THUNK_DATA32</span> &#123;</span><br><span class="line">    <span class="keyword">union</span> &#123;</span><br><span class="line">        DWORD ForwarderString;      <span class="comment">// PBYTE </span></span><br><span class="line">        DWORD Function;             <span class="comment">// PDWORD</span></span><br><span class="line">        DWORD Ordinal;</span><br><span class="line">        DWORD AddressOfData;        <span class="comment">// PIMAGE_IMPORT_BY_NAME</span></span><br><span class="line">    &#125; u1;</span><br><span class="line">&#125; IMAGE_THUNK_DATA32;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æœäº†ä¸‹ï¼Œè¿™æ˜¯ä¸€ä¸ªåŒå­—å…±ç”¨ä½“ç»“æ„ï¼Œå½“ç»“æ„çš„æœ€é«˜ä½ä¸º1æ—¶ï¼Œè¡¨ç¤ºå‡½æ•°æ˜¯ä»¥åºå·çš„æ–¹å¼å¯¼å…¥çš„ï¼Œè¿™æ—¶åŒå­—çš„ä½ä½å°±æ˜¯å‡½æ•°çš„åºå·ï¼Œå½“åŒå­—æœ€é«˜ä½ä¸º0æ—¶ï¼Œè¡¨ç¤ºå‡½æ•°ä»¥å‡½æ•°åæ–¹å¼å¯¼å…¥ï¼Œè¿™æ—¶åŒå­—çš„å€¼æ˜¯ä¸€ä¸ªRVAï¼ŒæŒ‡å‘ä¸€ä¸ªç”¨æ¥å®šä¹‰å¯¼å…¥å‡½æ•°åç§°çš„<code>IMAGE_IMPORT_BY_NAME</code>ç»“æ„ï¼Œæ­¤ç»“æ„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_IMAGE_IMPORT_BY_NAME</span> &#123;</span><br><span class="line">    WORD    Hint;          <span class="comment">// å‡½æ•°åºå·</span></span><br><span class="line">    CHAR   Name[<span class="number">1</span>];        <span class="comment">// å¯¼å…¥å‡½æ•°çš„åç§°</span></span><br><span class="line">&#125; IMAGE_IMPORT_BY_NAME, *PIMAGE_IMPORT_BY_NAME;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„æ‰€æœ‰ç»“æ„å°±æ˜¯å¯¼å…¥è¡¨çš„å…¨éƒ¨ï¼Œæ€»ç»“èµ·æ¥å°±æ˜¯ä¸‹å›¾è¿™å¼ è¡¨ã€‚</p>
<p><img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202506222257114.png" alt="image.png"></p>
<p>ç°åœ¨æˆ‘ä»¬æ¥åˆ†æä¸‹ä¸Šå›¾ï¼Œå¯¼å…¥è¡¨ä¸­<code>IMAGE_IMPORT_DESCRIPTOR</code>ç»“æ„çš„NAMEå­—æ®µæŒ‡å‘å­—ç¬¦ä¸²<code>Kernel32.dll</code>è¡¨æ˜å½“å‰ç¨‹åºè¦ä»<code>Kernel32.dll</code>æ–‡ä»¶ä¸­å¯¼å…¥å‡½æ•°ï¼Œ<code>OriginalFirstThunk</code>å’Œ<code>FirstThunk</code>å­—æ®µæŒ‡å‘ä¸¤ä¸ªåŒæ ·çš„<code>IMAGE_THUNK_DATA</code>æ•°ç»„ï¼Œç”±äºè¦å¯¼å…¥4ä¸ªå‡½æ•°ï¼Œæ‰€æœ‰æ•°ç»„ä¸­åŒ…å«4ä¸ªæœ‰æ•ˆé¡¹ç›®å¹¶ä»¥æœ€åä¸€ä¸ªå†…å®¹ä¸º0çš„é¡¹ç›®ä½œä¸ºç»“æŸã€‚</p>
<p>ç¬¬4ä¸ªå‡½æ•°æ˜¯ä»¥åºå·å¯¼å…¥çš„ï¼Œä¸å…¶å¯¹åº”çš„<code>IMAGE_THUNK_DATA</code>ç»“æ„æœ€é«˜ä½ç­‰äº1ï¼Œå’Œå‡½æ•°çš„åºå·0010hç»„åˆèµ·æ¥çš„æ•°å€¼å°±æ˜¯<code>80000010h</code>ï¼Œå…¶ä½™çš„3ä¸ªå‡½æ•°é‡‡ç”¨çš„æ˜¯ä»¥å‡½æ•°åæ–¹å¼å¯¼å…¥ï¼Œæ‰€ä»¥<code>IMAGE_THUNK_DATA</code>ç»“æ„çš„æ•°å€¼æ˜¯ä¸€ä¸ªRVAï¼Œåˆ†åˆ«æŒ‡å‘3ä¸ª<code>IMAGE_IMPORT_BY_NAME</code>ç»“æ„ï¼Œæ¯ä¸ªç»“æ„çš„ç¬¬ä¸€ä¸ªå­—æ®µæ˜¯å‡½æ•°çš„åºå·ï¼Œåé¢å°±æ˜¯å‡½æ•°çš„å­—ç¬¦ä¸²åç§°äº†</p>
<p>ä¸Šå›¾ä¸ºä»€ä¹ˆä¼šå‡ºç°ä¸¤ä¸ªä¸€æ¨¡ä¸€æ ·çš„<code>IMAGE_THUNK_DATA</code>æ•°ç»„ç»“æ„å‘¢? è¿™æ˜¯å› ä¸ºPEè£…è½½å™¨ä¼šå°†å…¶ä¸­ä¸€ä¸ªç»“æ„ä¿®æ”¹ä¸ºå‡½æ•°çš„åœ°å€<code>jmp dword ptr[xxxx]</code>å…¶ä¸­çš„xxxxå°±æ˜¯ç”±<code>FirstThunk</code>å­—æ®µæŒ‡å‘çš„é‚£ä¸ªæ•°ç»„ä¸­çš„ä¸€å‘˜ã€‚</p>
<p>å®é™…ä¸Šå½“PEæ–‡ä»¶è¢«è£…è½½å…¥å†…å­˜åï¼Œå†…å­˜ä¸­çš„æ˜ åƒä¼šè¢«Windowsä¿®æ­£ä¸ºå¦‚ä¸‹å›¾æ‰€ç¤ºçš„æ ·å­ï¼š</p>
<p><img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202506222300435.png" alt="image.png"></p>
<p>å…¶ä¸­ç”±<code>FristThunk</code>å­—æ®µæŒ‡å‘çš„é‚£ä¸ªæ•°ç»„ä¸­çš„æ¯ä¸ªåŒå­—éƒ½è¢«æ›¿æ¢æˆäº†çœŸæ­£çš„å‡½æ•°å…¥å£åœ°å€ï¼Œä¹‹æ‰€ä»¥åœ¨PEæ–‡ä»¶ä¸­ä½¿ç”¨ä¸¤ä»½<code>IMAGE_THUNK_DATA</code>æ•°ç»„çš„æ‹·è´å¹¶ä¿®æ”¹å…¶ä¸­çš„ä¸€ä»½ï¼Œæ˜¯ä¸ºäº†æœ€åè¿˜å¯ä»¥ç•™ä¸‹ä¸€ä»½å¤‡ä»½æ•°æ®ç”¨æ¥åè¿‡æ¥æŸ¥è¯¢åœ°å€æ‰€å¯¹åº”çš„å¯¼å…¥å‡½æ•°åã€‚</p>
<p>æœ€åé€šè¿‡ç¼–ç¨‹å®ç°è¯»å–å¯¼å…¥è¡¨æ•°æ®ï¼ˆæŠŠä¹‹å‰æ¬ çš„ä»£ç è¡¥ä¸Šï¼‰ï¼Œå…ˆå¤„ç†32ä½çš„ï¼Œåç»­å¤„ç†64çš„ã€‚<br>pe_analyzer.c</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Imagehlp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib,<span class="string">&quot;Imagehlp.lib&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="function">HANDLE <span class="title">OpenPeByFileName</span><span class="params">(LPTSTR FileName)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    HANDLE hFile = <span class="literal">NULL</span>;</span><br><span class="line">    HANDLE hMapFile = <span class="literal">NULL</span>;</span><br><span class="line">    LPVOID lpMapAddress = <span class="literal">NULL</span>;</span><br><span class="line">    DWORD dwFileSize = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    hFile = <span class="built_in">CreateFile</span>(FileName,</span><br><span class="line">        GENERIC_READ,</span><br><span class="line">        FILE_SHARE_READ,</span><br><span class="line">        <span class="literal">NULL</span>,</span><br><span class="line">        OPEN_EXISTING,</span><br><span class="line">        FILE_ATTRIBUTE_NORMAL,</span><br><span class="line">        <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (hFile == INVALID_HANDLE_VALUE)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Failed to open file: %lu\n&quot;</span>, <span class="built_in">GetLastError</span>());</span><br><span class="line">        <span class="keyword">goto</span> cleanup;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dwFileSize = <span class="built_in">GetFileSize</span>(hFile, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (dwFileSize == INVALID_FILE_SIZE || dwFileSize == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Invalid file size\n&quot;</span>);</span><br><span class="line">        <span class="keyword">goto</span> cleanup;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    hMapFile = <span class="built_in">CreateFileMapping</span>(hFile,</span><br><span class="line">        <span class="literal">NULL</span>,</span><br><span class="line">        PAGE_READONLY,</span><br><span class="line">        <span class="number">0</span>,</span><br><span class="line">        dwFileSize,</span><br><span class="line">        <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (hMapFile == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;CreateFileMapping failed: %lu\n&quot;</span>, <span class="built_in">GetLastError</span>());</span><br><span class="line">        <span class="keyword">goto</span> cleanup;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    lpMapAddress = <span class="built_in">MapViewOfFile</span>(hMapFile,</span><br><span class="line">        FILE_MAP_READ,</span><br><span class="line">        <span class="number">0</span>,</span><br><span class="line">        <span class="number">0</span>,</span><br><span class="line">        dwFileSize);</span><br><span class="line">    <span class="keyword">if</span> (lpMapAddress == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;MapViewOfFile failed: %lu\n&quot;</span>, <span class="built_in">GetLastError</span>());</span><br><span class="line">        <span class="keyword">goto</span> cleanup;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æˆåŠŸæ—¶ï¼Œå…ˆå…³é—­å¥æŸ„ï¼Œæ˜ å°„ä»ç„¶æœ‰æ•ˆ</span></span><br><span class="line">    <span class="built_in">CloseHandle</span>(hMapFile);</span><br><span class="line">    <span class="built_in">CloseHandle</span>(hFile);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> lpMapAddress;</span><br><span class="line"></span><br><span class="line">cleanup:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (hMapFile)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">CloseHandle</span>(hMapFile);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!hFile &amp;&amp; hFile != INVALID_HANDLE_VALUE)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">CloseHandle</span>(hFile);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ˜¾ç¤ºDOSå¤´ä¿¡æ¯</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DisplayDOSHeadInfo</span><span class="params">(HANDLE ImageBase)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    PIMAGE_DOS_HEADER pDosHead = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    pDosHead = (PIMAGE_DOS_HEADER)ImageBase;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;DOSå¤´ï¼š        %x\n&quot;</span>, pDosHead-&gt;e_magic);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;æ–‡ä»¶åœ°å€ï¼š     %x\n&quot;</span>, pDosHead-&gt;e_lfarlc);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;PEç»“æ„åç§»ï¼š   %x\n&quot;</span>, pDosHead-&gt;e_lfanew);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­æ˜¯å¦æ˜¯æœ‰æ•ˆPEæ–‡ä»¶</span></span><br><span class="line"><span class="function">BOOL <span class="title">IsPEFile</span><span class="params">(HANDLE ImageBase)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    PIMAGE_DOS_HEADER pDosHead = <span class="literal">NULL</span>;</span><br><span class="line">    PIMAGE_NT_HEADERS pNtHead = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (ImageBase == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    pDosHead = (PIMAGE_DOS_HEADER)ImageBase;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (IMAGE_DOS_SIGNATURE != pDosHead-&gt;e_magic)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    pNtHead = (PIMAGE_NT_HEADERS)((DWORD)pDosHead + pDosHead-&gt;e_lfanew);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (IMAGE_NT_SIGNATURE != pNtHead-&gt;Signature)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–NTå¤´æŒ‡é’ˆ</span></span><br><span class="line"><span class="function">PIMAGE_NT_HEADERS <span class="title">GetNtHead</span><span class="params">(HANDLE ImageBase)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    PIMAGE_DOS_HEADER pDosHead = <span class="literal">NULL</span>;</span><br><span class="line">    PIMAGE_NT_HEADERS pNtHead = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    pDosHead = (PIMAGE_DOS_HEADER)ImageBase;</span><br><span class="line">    pNtHead = (PIMAGE_NT_HEADERS)((DWORD)pDosHead + pDosHead-&gt;e_lfanew);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> pNtHead;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ˜¾ç¤ºPEå¤´ä¸­çš„æ–‡ä»¶å¤´ä¿¡æ¯</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DisplayFileHeaderInfo</span><span class="params">(HANDLE ImageBase)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    PIMAGE_NT_HEADERS pNtHead = <span class="literal">NULL</span>;</span><br><span class="line">    PIMAGE_FILE_HEADER pFileHead = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    pNtHead = <span class="built_in">GetNtHead</span>(ImageBase);</span><br><span class="line">    <span class="keyword">if</span> (!pNtHead)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    pFileHead = &amp;pNtHead-&gt;FileHeader;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;è¿è¡Œå¹³å°:     %x\n&quot;</span>, pFileHead-&gt;Machine);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;èŠ‚åŒºæ•°ç›®:     %x\n&quot;</span>, pFileHead-&gt;NumberOfSections);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;æ—¶é—´æ ‡è®°:     %x\n&quot;</span>, pFileHead-&gt;TimeDateStamp);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;å¯é€‰å¤´å¤§å°:   %x\n&quot;</span>, pFileHead-&gt;SizeOfOptionalHeader);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;æ–‡ä»¶ç‰¹æ€§:     %x\n&quot;</span>, pFileHead-&gt;Characteristics);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ˜¾ç¤ºPEå¤´ä¸­çš„å¯é€‰å¤´ä¿¡æ¯</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DisplayOptionalHeaderInfo</span><span class="params">(HANDLE ImageBase)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    PIMAGE_NT_HEADERS pNtHead = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    pNtHead = <span class="built_in">GetNtHead</span>(ImageBase);</span><br><span class="line">    <span class="keyword">if</span> (!pNtHead)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;å…¥å£ç‚¹ï¼š        %x\n&quot;</span>, pNtHead-&gt;OptionalHeader.AddressOfEntryPoint);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;é•œåƒåŸºå€ï¼š      %x\n&quot;</span>, pNtHead-&gt;OptionalHeader.ImageBase);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;é•œåƒå¤§å°ï¼š      %x\n&quot;</span>, pNtHead-&gt;OptionalHeader.SizeOfImage);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;ä»£ç åŸºå€ï¼š      %x\n&quot;</span>, pNtHead-&gt;OptionalHeader.BaseOfCode);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;åŒºå—å¯¹é½ï¼š      %x\n&quot;</span>, pNtHead-&gt;OptionalHeader.SectionAlignment);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;æ–‡ä»¶å—å¯¹é½ï¼š    %x\n&quot;</span>, pNtHead-&gt;OptionalHeader.FileAlignment);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;å­ç³»ç»Ÿï¼š        %x\n&quot;</span>, pNtHead-&gt;OptionalHeader.Subsystem);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;åŒºæ®µæ•°ç›®ï¼š      %x\n&quot;</span>, pNtHead-&gt;FileHeader.NumberOfSections);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;æ—¶é—´æ—¥æœŸæ ‡å¿—ï¼š  %x\n&quot;</span>, pNtHead-&gt;FileHeader.TimeDateStamp);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;é¦–éƒ¨å¤§å°ï¼š      %x\n&quot;</span>, pNtHead-&gt;OptionalHeader.SizeOfHeaders);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;ç‰¹å¾å€¼ï¼š        %x\n&quot;</span>, pNtHead-&gt;FileHeader.Characteristics);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;æ ¡éªŒå’Œï¼š        %x\n&quot;</span>, pNtHead-&gt;OptionalHeader.CheckSum);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;å¯é€‰å¤´éƒ¨å¤§å°ï¼š  %x\n&quot;</span>, pNtHead-&gt;FileHeader.SizeOfOptionalHeader);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;RVA æ•°åŠå¤§å°ï¼š  %x\n&quot;</span>, pNtHead-&gt;OptionalHeader.NumberOfRvaAndSizes);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ˜¾ç¤ºèŠ‚åŒºä¿¡æ¯</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DisplaySectionHeaderInfo</span><span class="params">(HANDLE ImageBase)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    PIMAGE_NT_HEADERS pNtHead = <span class="literal">NULL</span>;</span><br><span class="line">    PIMAGE_FILE_HEADER pFileHead = <span class="literal">NULL</span>;</span><br><span class="line">    PIMAGE_SECTION_HEADER pSection = <span class="literal">NULL</span>;</span><br><span class="line">    DWORD NumberOfSections = <span class="number">0</span>;</span><br><span class="line">    DWORD* difA = <span class="literal">NULL</span>;</span><br><span class="line">    DWORD* difS = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    pNtHead = <span class="built_in">GetNtHead</span>(ImageBase);</span><br><span class="line">    <span class="keyword">if</span> (!pNtHead)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    pFileHead = &amp;pNtHead-&gt;FileHeader;</span><br><span class="line">    pSection = <span class="built_in">IMAGE_FIRST_SECTION</span>(pNtHead);</span><br><span class="line">    NumberOfSections = pFileHead-&gt;NumberOfSections;</span><br><span class="line"></span><br><span class="line">    difA = (DWORD*)<span class="built_in">malloc</span>(NumberOfSections * <span class="built_in">sizeof</span>(DWORD));</span><br><span class="line">    difS = (DWORD*)<span class="built_in">malloc</span>(NumberOfSections * <span class="built_in">sizeof</span>(DWORD));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!difA || !difS)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Memory allocation failed\n&quot;</span>);</span><br><span class="line">        <span class="built_in">free</span>(difA);</span><br><span class="line">        <span class="built_in">free</span>(difS);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;èŠ‚åŒºåç§° ç›¸å¯¹åç§»\tè™šæ‹Ÿå¤§å°\tRawæ•°æ®æŒ‡é’ˆ\tRawæ•°æ®å¤§å°\tèŠ‚åŒºå±æ€§\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; NumberOfSections; i++, pSection++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s\t 0x%.8X \t 0x%.8X \t 0x%.8X \t 0x%.8X \t 0x%.8X\n&quot;</span>,</span><br><span class="line">            pSection-&gt;Name,</span><br><span class="line">            pSection-&gt;VirtualAddress,</span><br><span class="line">            pSection-&gt;Misc.VirtualSize,</span><br><span class="line">            pSection-&gt;PointerToRawData,</span><br><span class="line">            pSection-&gt;SizeOfRawData,</span><br><span class="line">            pSection-&gt;Characteristics);</span><br><span class="line"></span><br><span class="line">        difA[i] = pSection-&gt;VirtualAddress;</span><br><span class="line">        difS[i] = pSection-&gt;VirtualAddress - pSection-&gt;PointerToRawData;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">free</span>(difA);</span><br><span class="line">    <span class="built_in">free</span>(difS);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†RVAè½¬æ¢ä¸ºVA</span></span><br><span class="line"><span class="function">PVOID <span class="title">gcImageRvaToVa</span><span class="params">(PIMAGE_NT_HEADERS ntHeader, PVOID imageBase, DWORD rva, PIMAGE_SECTION_HEADER* SectionHeader)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    PIMAGE_SECTION_HEADER section = <span class="built_in">IMAGE_FIRST_SECTION</span>(ntHeader);</span><br><span class="line">    DWORD sectionStart = <span class="number">0</span>;</span><br><span class="line">    DWORD sectionEnd = <span class="number">0</span>;</span><br><span class="line">    DWORD delta = <span class="number">0</span>;</span><br><span class="line">    DWORD ptr = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; ntHeader-&gt;FileHeader.NumberOfSections; i++, section++)</span><br><span class="line">    &#123;</span><br><span class="line">        sectionStart = section-&gt;VirtualAddress;</span><br><span class="line">        sectionEnd = sectionStart + <span class="built_in">max</span>(section-&gt;SizeOfRawData, section-&gt;Misc.VirtualSize);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (rva &gt;= sectionStart &amp;&amp; rva &lt; sectionEnd)</span><br><span class="line">        &#123;</span><br><span class="line">            delta = rva - sectionStart;</span><br><span class="line">            ptr = section-&gt;PointerToRawData + delta;</span><br><span class="line">            <span class="keyword">return</span> (PVOID)((BYTE*)imageBase + ptr);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ˜¾ç¤ºå¯¼å…¥è¡¨ä¿¡æ¯</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DisplayImportTable</span><span class="params">(HANDLE ImageBase)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    PIMAGE_DOS_HEADER pDosHead = <span class="literal">NULL</span>;</span><br><span class="line">    PIMAGE_NT_HEADERS pNtHead = <span class="literal">NULL</span>;</span><br><span class="line">    PIMAGE_IMPORT_DESCRIPTOR pInput = <span class="literal">NULL</span>;</span><br><span class="line">    PIMAGE_THUNK_DATA _pThunk = <span class="literal">NULL</span>;</span><br><span class="line">    DWORD dwThunk = <span class="number">0</span>;</span><br><span class="line">    USHORT Hint = <span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span>* szFunction = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="type">char</span>* szFunctionModule = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    pDosHead = (PIMAGE_DOS_HEADER)ImageBase;</span><br><span class="line">    pNtHead = <span class="built_in">GetNtHead</span>(ImageBase);</span><br><span class="line">    <span class="keyword">if</span> (!pNtHead)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯å¦å­˜åœ¨å¯¼å…¥è¡¨</span></span><br><span class="line">    <span class="keyword">if</span> (pNtHead-&gt;OptionalHeader.DataDirectory[<span class="number">1</span>].VirtualAddress == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å¯¼å…¥è¡¨åœ°å€</span></span><br><span class="line">    pInput = (PIMAGE_IMPORT_DESCRIPTOR)<span class="built_in">gcImageRvaToVa</span>(pNtHead, pDosHead, pNtHead-&gt;OptionalHeader.DataDirectory[<span class="number">1</span>].VirtualAddress, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (; pInput-&gt;Name != <span class="literal">NULL</span>; pInput++)</span><br><span class="line">    &#123;</span><br><span class="line">        szFunctionModule = (PSTR)<span class="built_in">gcImageRvaToVa</span>(pNtHead, pDosHead, (ULONG)pInput-&gt;Name, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (pInput-&gt;OriginalFirstThunk != <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            dwThunk = pInput-&gt;OriginalFirstThunk;</span><br><span class="line">            _pThunk = (PIMAGE_THUNK_DATA)<span class="built_in">gcImageRvaToVa</span>(pNtHead, pDosHead, dwThunk, <span class="literal">NULL</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            dwThunk = pInput-&gt;FirstThunk;</span><br><span class="line">            _pThunk = (PIMAGE_THUNK_DATA)<span class="built_in">gcImageRvaToVa</span>(pNtHead, pDosHead, dwThunk, <span class="literal">NULL</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (; _pThunk-&gt;u<span class="number">1.</span>AddressOfData != <span class="literal">NULL</span>; _pThunk++)</span><br><span class="line">        &#123;</span><br><span class="line">            szFunction = (PSTR)<span class="built_in">gcImageRvaToVa</span>(pNtHead, pDosHead, (ULONG)(((PIMAGE_IMPORT_BY_NAME)_pThunk-&gt;u<span class="number">1.</span>AddressOfData)-&gt;Name), <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (szFunction != <span class="literal">NULL</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">memcpy</span>(&amp;Hint, szFunction - <span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                Hint = (USHORT)<span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%0.4x\t%0.8x\t%s\t%s\n&quot;</span>, Hint, dwThunk, szFunctionModule, szFunction);</span><br><span class="line"></span><br><span class="line">            dwThunk += <span class="built_in">sizeof</span>(ULONG_PTR);  <span class="comment">// 32ä½ç³»ç»Ÿæ˜¯4ï¼Œ64ä½ç³»ç»Ÿæ˜¯8</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸»å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    HANDLE lpMapAddress = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    lpMapAddress = <span class="built_in">OpenPeByFileName</span>(<span class="string">L&quot;E://Develop//Project//WinKernelProgram//99.st//PeHead//PE//Debug//PE.exe&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (lpMapAddress == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Failed to open PE file.\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;IMAGE_DOS_HEADER sizeof :%d\n&quot;</span>, <span class="built_in">sizeof</span>(IMAGE_DOS_HEADER));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;IMAGE_FILE_HEADER sizeof :%d\n&quot;</span>, <span class="built_in">sizeof</span>(IMAGE_FILE_HEADER));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;IMAGE_OPTIONAL_HEADER32 sizeof :%d\n&quot;</span>, <span class="built_in">sizeof</span>(IMAGE_OPTIONAL_HEADER32));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">IsPEFile</span>(lpMapAddress))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Not a valid PE file.\n&quot;</span>);</span><br><span class="line">        <span class="built_in">UnmapViewOfFile</span>(lpMapAddress);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">DisplayDOSHeadInfo</span>(lpMapAddress);</span><br><span class="line">    <span class="built_in">DisplayFileHeaderInfo</span>(lpMapAddress);</span><br><span class="line">    <span class="built_in">DisplayOptionalHeaderInfo</span>(lpMapAddress);</span><br><span class="line">    <span class="built_in">DisplaySectionHeaderInfo</span>(lpMapAddress);</span><br><span class="line">    <span class="built_in">DisplayImportTable</span>(lpMapAddress);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">UnmapViewOfFile</span>(lpMapAddress);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>pe_analyzer.h</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> PE_ANALYZER_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PE_ANALYZER_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Imagehlp.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å¼€æŒ‡å®šè·¯å¾„çš„ PE æ–‡ä»¶å¹¶è¿”å›æ˜ å°„åçš„å†…å­˜åœ°å€</span></span><br><span class="line"><span class="function">HANDLE <span class="title">OpenPeByFileName</span><span class="params">(LPTSTR FileName)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­æ˜ å°„åœ°å€æ˜¯å¦æ˜¯åˆæ³• PE æ–‡ä»¶</span></span><br><span class="line"><span class="function">BOOL <span class="title">IsPEFile</span><span class="params">(HANDLE ImageBase)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å– PE æ˜ å°„ä¸­çš„ NT å¤´åœ°å€</span></span><br><span class="line"><span class="function">PIMAGE_NT_HEADERS <span class="title">GetNtHead</span><span class="params">(HANDLE ImageBase)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å° DOS å¤´ä¿¡æ¯</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DisplayDOSHeadInfo</span><span class="params">(HANDLE ImageBase)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å°æ–‡ä»¶å¤´ï¼ˆIMAGE_FILE_HEADERï¼‰ä¿¡æ¯</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DisplayFileHeaderInfo</span><span class="params">(HANDLE ImageBase)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å°å¯é€‰å¤´ï¼ˆIMAGE_OPTIONAL_HEADERï¼‰ä¿¡æ¯</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DisplayOptionalHeaderInfo</span><span class="params">(HANDLE ImageBase)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å°èŠ‚åŒºè¡¨ä¿¡æ¯</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DisplaySectionHeaderInfo</span><span class="params">(HANDLE ImageBase)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°† RVA è½¬æ¢ä¸ºå®é™…å†…å­˜åœ°å€ï¼ˆVAï¼‰</span></span><br><span class="line"><span class="function">PVOID <span class="title">gcImageRvaToVa</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    PIMAGE_NT_HEADERS ntHeader,</span></span></span><br><span class="line"><span class="params"><span class="function">    PVOID imageBase,</span></span></span><br><span class="line"><span class="params"><span class="function">    DWORD rva,</span></span></span><br><span class="line"><span class="params"><span class="function">    PIMAGE_SECTION_HEADER* SectionHeader</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å°å¯¼å…¥è¡¨ä¿¡æ¯</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DisplayImportTable</span><span class="params">(HANDLE ImageBase)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// PE_ANALYZER_H</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/06/15/debug/%E4%BE%8B%E5%AD%90/%E3%80%8AWindows%E6%A0%B8%E5%BF%83%E7%BC%96%E7%A8%8B%E3%80%8B%E8%8B%A5%E5%B9%B2%E7%9F%A5%E8%AF%86%E7%82%B9%E5%AE%9E%E6%88%98%E5%BA%94%E7%94%A8%E5%88%86%E4%BA%AB2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/06/15/debug/%E4%BE%8B%E5%AD%90/%E3%80%8AWindows%E6%A0%B8%E5%BF%83%E7%BC%96%E7%A8%8B%E3%80%8B%E8%8B%A5%E5%B9%B2%E7%9F%A5%E8%AF%86%E7%82%B9%E5%AE%9E%E6%88%98%E5%BA%94%E7%94%A8%E5%88%86%E4%BA%AB2/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2025-06-15 22:00:28 / Modified: 22:05:11" itemprop="dateCreated datePublished" datetime="2025-06-15T22:00:28+08:00">2025-06-15</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="6ã€æ­»é”æ£€æµ‹å·¥å…·LockCop"><a href="#6ã€æ­»é”æ£€æµ‹å·¥å…·LockCop" class="headerlink" title="6ã€æ­»é”æ£€æµ‹å·¥å…·LockCop"></a>6ã€æ­»é”æ£€æµ‹å·¥å…·LockCop</h3><p><strong>åœ¨**<strong>9.8.6èŠ‚</strong></strong>ï¼ˆä½¿ç”¨ç­‰å¾…é“¾éå†APIæ¥æ£€æµ‹æ­»é”ï¼‰ä¸­è®²åˆ°äº†æ­»é”æ£€æµ‹å·¥å…·LockCop**ï¼Œä½¿ç”¨è¯¥å·¥å…·å¯ä»¥æ£€æµ‹ç¨‹åºä¸­æ˜¯å¦å­˜åœ¨å¤šçº¿ç¨‹æ­»é”ï¼š</p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/dce9475b87ff2c28a7a0e89dede9cbf0.png"></p>
<p>è¯¥å·¥å…·æ˜¯è°ƒç”¨ç³»ç»ŸWCT ï¼ˆWait Chain Traversalï¼Œç­‰å¾…é“¾éå†ï¼‰APIå‡½æ•°GetThreadWaitChainæ¥åˆ¤æ–­ç›®æ ‡çº¿ç¨‹æ˜¯å¦å‘ç”Ÿäº†æ­»é”ï¼Œä½†æ˜¯åªèƒ½ç›‘æµ‹å…³é”®ä»£ç æ®µã€äº’æ–¥é‡ç­‰å¼•å‘çš„æ­»é”ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/b6789fe87885ec897de25381bda4ef8c.png"></p>
<p>æ‰€ä»¥åœ¨ä½¿ç”¨LockCopå·¥å…·åº”è¯¥æ³¨æ„ï¼š</p>
<blockquote>
<p>1ï¼‰è¯¥å·¥å…·å› ä¸ºè°ƒç”¨çš„APIæ˜¯Vistaä»¥ä¸Šç³»ç»Ÿæ‰æä¾›çš„ï¼Œæ‰€ä»¥ä¸æ”¯æŒXPç³»ç»Ÿã€‚<br>2ï¼‰è¯¥å·¥å…·åªèƒ½æ£€æµ‹ä¸´ç•ŒåŒºæ­»é”å’Œäº’æ–¥é‡æ­»é”ï¼Œäº‹ä»¶ã€ä¿¡å·é‡ç­‰å¼•å‘çš„æ­»é”æ˜¯æ²¡æ³•ç›‘æµ‹åˆ°çš„ã€‚<br>3ï¼‰è¯¥å·¥å…·æ£€æµ‹ä¸åˆ°WaitForMultipleObjectså¼•å‘çš„æ­»é”ã€‚</p>
</blockquote>
<h3 id="7ã€å¦‚ä½•ä»¥ç®¡ç†å‘˜æƒé™å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ï¼Ÿ"><a href="#7ã€å¦‚ä½•ä»¥ç®¡ç†å‘˜æƒé™å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ï¼Ÿ" class="headerlink" title="7ã€å¦‚ä½•ä»¥ç®¡ç†å‘˜æƒé™å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ï¼Ÿ"></a>7ã€å¦‚ä½•ä»¥ç®¡ç†å‘˜æƒé™å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ï¼Ÿ</h3><p><strong>åœ¨**<strong>4.5.1èŠ‚</strong></strong>ï¼ˆè‡ªåŠ¨æå‡è¿›ç¨‹çš„æƒé™ï¼‰è®²åˆ°äº†å¦‚æœä»¥ç®¡ç†å‘˜æƒé™å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ã€‚**</p>
<p>åœ¨Win7åŠä»¥ä¸Šç³»ç»Ÿä¸­ï¼Œå¦‚æœç³»ç»ŸUACå¼€å…³æ‰“å¼€ï¼Œä¸”å½“å‰ç³»ç»Ÿç™»å½•ç”¨æˆ·ä¸æ˜¯è¶…çº§ç®¡ç†å‘˜Administratorç”¨æˆ·ï¼Œå¦‚æœç¨‹åºè®¾ç½®äº†ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œï¼Œåˆ™åœ¨ç¨‹åºå¯åŠ¨æ—¶ç³»ç»Ÿä¼šå¼¹å‡ºUACæç¤ºæ¡†ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/5bf44d7f35e93d0c13fd99674d63d03c.png"></p>
<p>æç¤ºç”¨æˆ·è½¯ä»¶å¯èƒ½ä¼šå¯¹æœºå™¨è¿›è¡Œæ›´æ”¹ï¼ˆä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œçš„ç¨‹åºå¯ä»¥ä¿®æ”¹ç³»ç»Ÿå…³é”®è·¯å¾„ä¸­çš„æ–‡ä»¶æˆ–æ³¨å†Œè¡¨ç­‰ï¼‰ã€‚æ‰€ä»¥æœ‰äº›è½¯ä»¶ä¸ºäº†é¿å…ç³»ç»Ÿé¢‘ç¹åœ°å¼¹å‡ºUACæç¤ºæ¡†ï¼Œæ•…æ„å°†ç¨‹åºè®¾ç½®ä»¥æ ‡å‡†ç”¨æˆ·æƒé™è¿è¡Œï¼Œæ¯”å¦‚æˆ‘ä»¬ç ”ç©¶è¿‡QQï¼Œå®ƒé»˜è®¤å°±æ˜¯ä»¥æ ‡å‡†ç”¨æˆ·æƒé™è¿è¡Œçš„ã€‚</p>
<p>åœ¨ä»¥æ ‡å‡†ç”¨æˆ·æƒé™è¿è¡Œçš„è¿›ç¨‹ä¸­ï¼Œå¦‚æœè¦å¯åŠ¨ä¸€ä¸ªå­è¿›ç¨‹ï¼Œåˆ™é»˜è®¤æƒ…å†µä¸‹å­è¿›ç¨‹æ˜¯ç»§æ‰¿çˆ¶è¿›ç¨‹çš„æƒé™ï¼Œå³ä»¥æ ‡å‡†ç”¨æˆ·æƒé™è¿è¡Œã€‚ä½†æœ‰äº›åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä»¥æ ‡å‡†ç”¨æˆ·æƒé™è¿è¡Œçš„è¿›ç¨‹ä¸­å¯åŠ¨ä¸€ä¸ªä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œçš„å­è¿›ç¨‹ï¼Œæ¯”å¦‚æ‰§è¡Œè½¯ä»¶çš„å‡çº§æ›´æ–°æ—¶ï¼Œå‡çº§ç¨‹åºéœ€è¦å†™æ³¨å†Œè¡¨ï¼ˆå‘HKEY_LOCAL_MACHINEæ³¨å†Œè¡¨ä¸‹å†™å…¥ä¿¡æ¯ï¼Œéœ€è¦ç®¡ç†å‘˜æƒé™ï¼›å‘å½“å‰ç”¨æˆ·çš„HKEY_CURRENT_USERè·¯å¾„ä¸‹å†™å…¥ä¿¡æ¯ï¼Œåˆ™ä¸éœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰ã€éœ€è¦å‘ç³»ç»Ÿå…³é”®è·¯å¾„æ‹·è´æ–‡ä»¶ï¼Œéœ€è¦æœ‰ç®¡ç†å‘˜æƒé™æ‰èƒ½æ‰§è¡Œï¼Œæ‰€ä»¥è¢«å¯åŠ¨èµ·æ¥çš„å‡çº§ç¨‹åºéœ€è¦ä»¥ç®¡ç†å‘˜æƒé™å¯åŠ¨è¿è¡Œã€‚</p>
<p>é‚£å¦‚ä½•åœ¨ä¸€ä¸ªä»¥æ ‡å‡†ç”¨æˆ·æƒé™è¿è¡Œçš„è¿›ç¨‹ä¸­ï¼Œå»å¯åŠ¨ä¸€ä¸ªä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œçš„ç¨‹åºå‘¢ï¼Ÿå…¶å®å¾ˆç®€å•ï¼Œè°ƒç”¨ç³»ç»ŸAPIæ¥å£SheeExecuteExï¼Œä¼ å…¥runaså‚æ•°å³å¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">SHELLEXECUTEINFO si;</span><br><span class="line"><span class="built_in">RtlZeroMemory</span>( &amp;si, <span class="built_in">sizeof</span>( SHELLEXECUTEINFO ) );</span><br><span class="line">si.cbSize = <span class="built_in">sizeof</span>(SHELLEXECUTEINFO);</span><br><span class="line">si.lpFile = _T(<span class="string">&quot;D:\\test.exe&quot;</span>);</span><br><span class="line"><span class="comment">//si.lpParameters = lpCmdParam;</span></span><br><span class="line">si.nShow = SW_SHOWNORMAL;</span><br><span class="line">si.lpVerb = _T(<span class="string">&quot;runas&quot;</span>);</span><br><span class="line">BOOL bRet = <span class="built_in">ShellExecuteEx</span>( &amp;si );</span><br><span class="line"><span class="keyword">if</span> ( !bRet ) <span class="comment">// ç¨‹åºå¯åŠ¨å¤±è´¥</span></span><br><span class="line">&#123;</span><br><span class="line">    TCHAR achLog[<span class="number">256</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// å…ˆå–lasterrorå€¼</span></span><br><span class="line">    DWORD dwLastErr = <span class="built_in">GetLastError</span>();</span><br><span class="line">    _stprintf( achLog, _T(<span class="string">&quot;ShellExecuteEx failed, GetLastError: %d.&quot;</span>), dwLastErr );</span><br><span class="line">    <span class="built_in">WriteLog</span>( achLog );</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// å†å–hInstAppé”™è¯¯ä»£ç </span></span><br><span class="line">    <span class="type">int</span> nHInsVal = (<span class="type">int</span>)si.hInstApp;</span><br><span class="line">    <span class="keyword">if</span> ( nHInsVal &lt;= <span class="number">32</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        _stprintf( achLog, _T(<span class="string">&quot;ShellExecuteEx failure, errcode: %d.&quot;</span>), nHInsVal );</span><br><span class="line">        <span class="built_in">WriteLog</span>( achLog );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="8ã€å¦‚ä½•åˆ¤æ–­ç¨‹åºæ˜¯å¦ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œï¼Ÿ"><a href="#8ã€å¦‚ä½•åˆ¤æ–­ç¨‹åºæ˜¯å¦ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œï¼Ÿ" class="headerlink" title="8ã€å¦‚ä½•åˆ¤æ–­ç¨‹åºæ˜¯å¦ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œï¼Ÿ"></a>8ã€å¦‚ä½•åˆ¤æ–­ç¨‹åºæ˜¯å¦ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œï¼Ÿ</h3><p>æœ‰æ—¶æˆ‘ä»¬éœ€è¦åˆ¤æ–­è¿›ç¨‹æ˜¯å¦ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œï¼Œæ¯”å¦‚åœ¨è¿è¡Œå®‰è£…åŒ…æ—¶éœ€è¦å®‰è£…åŒ…è¿›ç¨‹ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œï¼Œå› ä¸ºå®‰è£…åŒ…å°†æ‰§è¡Œå†™æ³¨å†Œè¡¨ã€æ³¨å†Œç»„ä»¶ç­‰éœ€è¦ç®¡ç†å‘˜æƒé™çš„æ“ä½œã€‚å¦‚æœæ²¡æœ‰ç”³è¯·åˆ°ç®¡ç†å‘˜æƒé™ï¼Œè¿™äº›éœ€è¦ç®¡ç†å‘˜æƒé™çš„æ“ä½œéƒ½ä¼šæ‰§è¡Œå¤±è´¥ï¼Œåˆ™ä¼šå¯¼è‡´å®‰è£…å¤±è´¥ã€‚ä»¥QQ7.1å®‰è£…åŒ…ä¸ºä¾‹ï¼Œå¦‚æœå½“å‰ä»¥æ ‡å‡†ç”¨æˆ·ç™»å½•åˆ°ç³»ç»Ÿä¸­ï¼Œå¹¶ä¸”UACå…³é—­ï¼ŒåŒå‡»è¿è¡Œæ—¶å°†ç”³è¯·ä¸åˆ°ç®¡ç†å‘˜æƒé™ï¼ŒQQä¼šå¼¹å‡ºå¦‚ä¸‹çš„æç¤ºæ¡†ï¼š</p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/5b1027ff85f08b9b62ded3189194bd4f.png"></p>
<p>æˆ‘ä»¬çš„å®‰è£…ç¨‹åºå¯ä»¥å‚è€ƒQQçš„åšæ³•ï¼Œé¿å…å‡ºç°æ²¡æœ‰ç®¡ç†å‘˜æƒé™å¯¼è‡´å®‰è£…å¤±è´¥çš„é—®é¢˜ï¼Œå³å¦‚æœæ²¡æœ‰ç”³è¯·åˆ°ç®¡ç†å‘˜æƒé™ï¼Œåˆ™ç›´æ¥å¼¹å‡ºå¦‚ä¸Šç±»ä¼¼çš„æç¤ºã€‚è¦å¼¹å‡ºæç¤ºï¼Œåˆ™è¦åˆ¤æ–­å½“å‰å®‰è£…ç¨‹åºçš„è¿›ç¨‹æ˜¯å¦ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œã€‚é‚£åº”è¯¥å¦‚ä½•åˆ¤æ–­å‘¢ï¼Ÿç›¸å…³ç¤ºä¾‹ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 1ã€é€šè¿‡è¿›ç¨‹idè·å–è¿›ç¨‹å¥æŸ„</span></span><br><span class="line">DWORD dwPid = <span class="number">2337</span>; <span class="comment">// ç›®æ ‡è¿›ç¨‹çš„è¿›ç¨‹id</span></span><br><span class="line">HANDLE hProcess = ::<span class="built_in">OpenProcess</span>( <span class="comment">/*PROCESS_ALL_ACCESS*/</span>PROCESS_QUERY_INFORMATION, FALSE, dwPid );</span><br><span class="line"><span class="keyword">if</span> ( hProcess == <span class="literal">NULL</span> )</span><br><span class="line">&#123;</span><br><span class="line">strTip.<span class="built_in">Format</span>( _T(<span class="string">&quot;OpenProcess to get the process handle failed, possible reason: the process id doesn&#x27;t exsit, GetLastError: %d&quot;</span>), <span class="built_in">GetLastError</span>() );</span><br><span class="line"><span class="built_in">AfxMessageBox</span>( strTip );</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 2ã€è°ƒç”¨IsRunasAdminå‡½æ•°åˆ¤æ–­ç›®æ ‡è¿›ç¨‹æ˜¯å¦å·²ç®¡ç†å‘˜æƒé™è¿è¡Œ</span></span><br><span class="line">BOOL bRunAsAdmin = <span class="built_in">IsRunasAdmin</span>( hProcess );</span><br><span class="line"><span class="keyword">if</span> ( bRunAsAdmin )</span><br><span class="line">&#123;</span><br><span class="line">    strTip.<span class="built_in">Format</span>( _T(<span class="string">&quot;Pid(%d) run as admin!&quot;</span>), dwPid );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    strTip.<span class="built_in">Format</span>( _T(<span class="string">&quot;Pid(%d) don&#x27;t run as admin!&quot;</span>), dwPid );</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">AfxMessageBox</span>( strTip );</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 3ã€åˆ¤æ–­è¿›ç¨‹æ˜¯å¦å·²ç®¡ç†å‘˜æƒé™è¿è¡Œçš„å‡½æ•°å®ç°</span></span><br><span class="line"><span class="function">BOOL <span class="title">IsRunasAdmin</span><span class="params">( HANDLE hProcess )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    BOOL bElevated = FALSE;  </span><br><span class="line">    HANDLE hToken = <span class="literal">NULL</span>;  </span><br><span class="line"> </span><br><span class="line">    CString strTip;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Get target process token</span></span><br><span class="line">    <span class="keyword">if</span> ( !<span class="built_in">OpenProcessToken</span>( hProcess<span class="comment">/*GetCurrentProcess()*/</span>, TOKEN_QUERY, &amp;hToken ) )</span><br><span class="line">    &#123;</span><br><span class="line">        strTip.<span class="built_in">Format</span>( _T(<span class="string">&quot;OpenProcessToken failed, GetLastError: %d&quot;</span>), <span class="built_in">GetLastError</span>() );</span><br><span class="line">        <span class="built_in">AfxMessageBox</span>( strTip );</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    TOKEN_ELEVATION tokenEle;</span><br><span class="line">    DWORD dwRetLen = <span class="number">0</span>;  </span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Retrieve token elevation information</span></span><br><span class="line">    <span class="keyword">if</span> ( <span class="built_in">GetTokenInformation</span>( hToken, TokenElevation, &amp;tokenEle, <span class="built_in">sizeof</span>(tokenEle), &amp;dwRetLen ) )</span><br><span class="line">    &#123;  </span><br><span class="line">        <span class="keyword">if</span> ( dwRetLen == <span class="built_in">sizeof</span>(tokenEle) )</span><br><span class="line">        &#123;</span><br><span class="line">            bElevated = tokenEle.TokenIsElevated;  </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        strTip.<span class="built_in">Format</span>( _T(<span class="string">&quot;GetTokenInformation failed, GetLastError: %d&quot;</span>), <span class="built_in">GetLastError</span>() );</span><br><span class="line">        <span class="built_in">AfxMessageBox</span>( strTip );</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">CloseHandle</span>( hToken );  </span><br><span class="line">    <span class="keyword">return</span> bElevated;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9ã€DLLå»¶è¿ŸåŠ è½½ä¸DLLè¿œç¨‹æ³¨å…¥"><a href="#9ã€DLLå»¶è¿ŸåŠ è½½ä¸DLLè¿œç¨‹æ³¨å…¥" class="headerlink" title="9ã€DLLå»¶è¿ŸåŠ è½½ä¸DLLè¿œç¨‹æ³¨å…¥"></a>9ã€DLLå»¶è¿ŸåŠ è½½ä¸DLLè¿œç¨‹æ³¨å…¥</h3><p><strong>åœ¨<strong><strong>ç¬¬22ç« </strong></strong>è®²åˆ°äº†DLLå»¶è¿ŸåŠ è½½ä¸DLLè¿œç¨‹æ³¨å…¥çš„ç›¸å…³å†…å®¹</strong>ã€‚ä¸‹é¢ä»å®é™…å·¥ç¨‹åº”ç”¨çš„è§’åº¦å»å¤§æ¦‚åœ°è®²è¿°ä¸Šè¿°ä¸¤æ–¹é¢çš„å†…å®¹ã€‚</p>
<h4 id="9-1ã€DLLå»¶è¿ŸåŠ è½½"><a href="#9-1ã€DLLå»¶è¿ŸåŠ è½½" class="headerlink" title="9.1ã€DLLå»¶è¿ŸåŠ è½½"></a>9.1ã€DLLå»¶è¿ŸåŠ è½½</h4><p>å½“å¯åŠ¨ä¸€ä¸ªç¨‹åºæ—¶ï¼Œç³»ç»Ÿä¼šç»™ç¨‹åºè¿›ç¨‹åˆ†é…ä¸€ä¸ªè¿›ç¨‹ç©ºé—´ï¼Œç³»ç»Ÿä¼šå…ˆå°†ä¸»ç¨‹åºä¾èµ–çš„å„ä¸ªdllåº“åŠ è½½åˆ°è¿›ç¨‹ç©ºé—´ä¸­ï¼Œå½“æ‰€ä»¥ä¾èµ–çš„åº“åŠ è½½åˆ°è¿›ç¨‹ç©ºé—´ä¸­åï¼Œæœ€åæ‰ä¼šå°†exeä¸»ç¨‹åºåŠ è½½å¹¶è¿è¡Œèµ·æ¥ï¼Œç„¶åè¿›å…¥exeä¸»ç¨‹åºçš„mainå‡½æ•°ï¼Œä¸»ç¨‹åºè¿è¡Œèµ·æ¥ã€‚</p>
<p>è½¯ä»¶çš„æŸäº›åŠŸèƒ½æ˜¯è°ƒç”¨æŸä¸ªDLLåº“çš„æ¥å£å®ç°çš„ï¼Œä½†è¿™äº›åŠŸèƒ½å¯èƒ½å®¢æˆ·ä¸ä¼šç”¨æˆ–å¾ˆå°‘ç”¨ï¼Œå¯ä»¥å°†ç›¸å…³çš„DLLåº“è®¾ç½®ä¸ºå»¶è¿ŸåŠ è½½ã€‚è®¾ç½®ä¸ºå»¶è¿ŸåŠ è½½åï¼Œå°±ä¸ä¼šåœ¨å¯åŠ¨ä¸»ç¨‹åºæ—¶å°±åŠ è½½DLLåº“ï¼Œè€Œæ˜¯åœ¨è°ƒç”¨åˆ°DLLæ¥å£æ—¶å†å»åŠ è½½ï¼ŒWindowsç³»ç»Ÿæ˜¯æ”¯æŒDLLå»¶è¿ŸåŠ è½½çš„ã€‚</p>
<p>å°†ä¸æ€ç”¨çš„åŠŸèƒ½æ‰€åœ¨çš„DLLåº“è®¾ç½®ä¸ºå»¶è¿ŸåŠ è½½ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸¤å¤§å¥½å¤„ï¼š</p>
<blockquote>
<p><strong>1ï¼‰æé«˜ç¨‹åºçš„å¯åŠ¨é€Ÿåº¦</strong><br>å°†DLLåº“è®¾ç½®ä¸ºå»¶è¿ŸåŠ è½½åï¼Œç¨‹åºå¯åŠ¨æ—¶å°±ä¸ä¼šåŠ è½½è¯¥DLLåº“ï¼Œè¿™æ ·å°±èƒ½å‡å°‘ç¨‹åºå¯åŠ¨è¦åŠ è½½çš„DLLåº“ä¸ªæ•°ï¼Œå¯ä»¥æå‡ç¨‹åºçš„æ‰§è¡Œé€Ÿåº¦ã€‚<br><strong>2ï¼‰è¾ƒå°‘ç¨‹åºå¯¹è™šæ‹Ÿå†…å­˜çš„å ç”¨</strong><br>DLLåº“åŠ è½½åˆ°è¿›ç¨‹ç©ºé—´ä¸­ï¼Œä¸»è¦æœ‰ä¸¤æ–¹é¢ä¼šå ç”¨ç¨‹åºçš„å†…å­˜ç©ºé—´ï¼ˆè™šæ‹Ÿå†…å­˜ç©ºé—´ï¼‰ã€‚ä¸€æ–¹é¢ï¼ŒDLLäºŒè¿›åˆ¶æ–‡ä»¶ä¸­å­˜æ”¾çš„æ˜¯è¦CPUæ‰§è¡Œçš„äºŒè¿›åˆ¶ä»£ç ï¼ŒåŠ è½½åˆ°è¿›ç¨‹ç©ºé—´åä¼šå ç”¨è¿›ç¨‹ä»£ç æ®µçš„å†…å­˜ï¼Œè¿™æ˜¯ç¨‹åºè™šæ‹Ÿå†…å­˜çš„ä¸€éƒ¨åˆ†ã€‚<br>å¦ä¸€æ–¹é¢ï¼ŒDLLåº“ä¸­æœ‰äº›å˜é‡ï¼ŒDLLåŠ è½½åˆ°è¿›ç¨‹ç©ºé—´ä¸­åï¼Œæœ‰äº›å˜é‡éœ€è¦åˆ†é…å†…å­˜ï¼Œè¿™äº›å˜é‡çš„å†…å­˜åˆ™æ˜¯ç¨‹åºæ•°æ®æ®µçš„å†…å­˜ï¼Œä¹Ÿæ˜¯ç¨‹åºè™šæ‹Ÿå†…å­˜çš„ä¸€éƒ¨åˆ†ã€‚æ‰€ä»¥å‡å°‘DLLåº“çš„åŠ è½½ï¼Œå¯ä»¥é™ä½è¿›ç¨‹å¯¹è™šæ‹Ÿå†…å­˜çš„å ç”¨ã€‚</p>
</blockquote>
<p>é‚£å¦‚ä½•å°†DLLè®¾ç½®æˆå»¶è¿ŸåŠ è½½å‘¢ï¼Ÿå…¶å®å¾ˆç®€å•ï¼Œåœ¨VisualÂ Studioä¸­å°±å¯ä»¥è®¾ç½®ï¼Œåœ¨exeä¸»ç¨‹åºä¸­é…ç½®å³å¯ã€‚æ‰“å¼€exeä¸»ç¨‹åºå·¥ç¨‹çš„å·¥ç¨‹å±æ€§ï¼Œåˆ°åœ¨<strong>é“¾æ¥å™¨ -&gt; è¾“å…¥ -&gt; å»¶è¿ŸåŠ è½½çš„DLL</strong>Â ä¸‹ï¼Œè¾“å…¥è¦å»¶è¿ŸåŠ è½½çš„DLLæ–‡ä»¶åç§°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/366e4598a1df876d24cb9b457e9fe832.png"></p>
<p>å¦‚æœæœ‰å¤šä¸ªDLLåº“éœ€è¦å»¶è¿ŸåŠ è½½ï¼Œç”¨é€—å·éš”å¼€å³å¯ã€‚</p>
<h4 id="9-2ã€DLLè¿œç¨‹æ³¨å…¥"><a href="#9-2ã€DLLè¿œç¨‹æ³¨å…¥" class="headerlink" title="9.2ã€DLLè¿œç¨‹æ³¨å…¥"></a>9.2ã€DLLè¿œç¨‹æ³¨å…¥</h4><p>æœ‰äº›è½¯ä»¶é€šè¿‡DLLæ¨¡å—è¿œç¨‹æ³¨å…¥å®ç°å¯¹ç›®æ ‡ç¨‹åºçš„ç›‘æ§ï¼Œå…¶å®åœ¨æ—¥å¸¸å·¥ä½œä¸­ä¸€ç›´éƒ½æœ‰DLLè¿œç¨‹æ³¨å…¥çš„èº«å½±ï¼Œæ¯”å¦‚è¾“å…¥æ³•ä¹‹æ‰€ä»¥èƒ½åœ¨æ‰€æœ‰çš„è½¯ä»¶ä¸Šè¿›è¡Œè¾“å…¥ï¼Œæ˜¯å› ä¸ºè¾“å…¥æ³•æœ‰ä¸“é—¨çš„DLLè¿œç¨‹æ³¨å…¥åˆ°å½“å‰ç³»ç»Ÿæ‰€æœ‰çš„UIè¿›ç¨‹ä¸­ã€‚æ­¤å¤–ï¼Œæœ‰äº›ç¬¬ä¸‰æ–¹å®‰å…¨è½¯ä»¶ä¹Ÿæ˜¯é€šè¿‡DLLè¿œç¨‹æ³¨å…¥çš„æ–¹å¼æ³¨å…¥åˆ°ç›®æ ‡è¿›ç¨‹ä¸­ï¼Œå»å¯¹ç›®æ ‡è¿›ç¨‹çš„å®æ—¶ç½‘ç»œæ•°æ®è¿›è¡Œåˆ†æå’Œç›‘æ§ã€‚</p>
<h3 id="10ã€SEHç»“æ„åŒ–å¼‚å¸¸ä¸C-å¼‚å¸¸"><a href="#10ã€SEHç»“æ„åŒ–å¼‚å¸¸ä¸C-å¼‚å¸¸" class="headerlink" title="10ã€SEHç»“æ„åŒ–å¼‚å¸¸ä¸C++å¼‚å¸¸"></a>10ã€SEHç»“æ„åŒ–å¼‚å¸¸ä¸C++å¼‚å¸¸</h3><p><strong>ç¬¬25ç« </strong><strong>ï¼ˆæœªå¤„ç†å¼‚å¸¸ã€å‘é‡åŒ–å¼‚å¸¸å¤„ç†ä¸C++å¼‚å¸¸ï¼‰ä¸­è®²åˆ°äº†SEHç»“æ„åŒ–å¼‚å¸¸ä¸C++å¼‚å¸¸ç›¸å…³çš„å†…å®¹ã€‚</strong></p>
<h4 id="10-1ã€SEHç»“æ„åŒ–å¼‚å¸¸"><a href="#10-1ã€SEHç»“æ„åŒ–å¼‚å¸¸" class="headerlink" title="10.1ã€SEHç»“æ„åŒ–å¼‚å¸¸"></a>10.1ã€SEHç»“æ„åŒ–å¼‚å¸¸</h4><p>SEHï¼ˆStructured Exception Handlingï¼‰ï¼Œç»“æ„åŒ–å¼‚å¸¸å¤„ç†ï¼Œæ˜¯Windowsæ“ä½œç³»ç»Ÿä¸Šï¼ŒMicrosoftå¯¹C&#x2F;C++ç¨‹åºè¯­è¨€åšçš„è¯­æ³•æ‰©å±•ï¼Œç”¨äºå¤„ç†å¼‚å¸¸äº‹ä»¶çš„ç¨‹åºæ§åˆ¶ç»“æ„ã€‚å¼‚å¸¸äº‹ä»¶æ˜¯æ‰“æ–­ç¨‹åºæ­£å¸¸æ‰§è¡Œæµç¨‹çš„ä¸åœ¨æœŸæœ›ä¹‹ä¸­çš„ç¡¬ä»¶ã€è½¯ä»¶äº‹ä»¶ã€‚ç¡¬ä»¶å¼‚å¸¸æ˜¯CPUæŠ›å‡ºçš„å¦‚â€œé™¤0â€ã€æ•°å€¼æº¢å‡ºç­‰ï¼›è½¯ä»¶å¼‚å¸¸æ˜¯æ“ä½œç³»ç»Ÿä¸ç¨‹åºé€šè¿‡RaiseExceptionè¯­å¥æŠ›å‡ºçš„å¼‚å¸¸ã€‚</p>
<p>Microsoftæ‰©å±•äº†Cè¯­è¨€çš„è¯­æ³•ï¼Œç”¨ try-exceptä¸try-finallyè¯­å¥æ¥å¤„ç†å¼‚å¸¸ã€‚try-exceptç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">__try </span><br><span class="line">&#123;</span><br><span class="line">   <span class="comment">// guarded code</span></span><br><span class="line">&#125;</span><br><span class="line">__except ( expression )</span><br><span class="line">&#123;</span><br><span class="line">   <span class="comment">// exception handler code</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>try-finallyç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">__try &#123;</span><br><span class="line">   <span class="comment">// guarded code</span></span><br><span class="line">&#125;</span><br><span class="line">__finally &#123;</span><br><span class="line">   <span class="comment">// termination code</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¼‚å¸¸å¤„ç†ç¨‹åºå¯ä»¥é‡Šæ”¾å·²ç»è·å–çš„èµ„æºã€æ˜¾ç¤ºå‡ºé”™ä¿¡æ¯ä¸ç¨‹åºå†…éƒ¨çŠ¶æ€ä¾›è°ƒè¯•ã€ä»é”™è¯¯ä¸­æ¢å¤ã€å°è¯•é‡æ–°æ‰§è¡Œå‡ºé”™çš„ä»£ç æˆ–è€…å…³é—­ç¨‹åºç­‰ç­‰ã€‚ä¸€ä¸ª__tryè¯­å¥ä¸èƒ½æ—¢æœ‰__exceptï¼Œåˆæœ‰__finallyã€‚ä½†try-exceptä¸try-finallyè¯­å¥å¯ä»¥åµŒå¥—ä½¿ç”¨ã€‚</p>
<p>ä»¥è°ƒç”¨ç³»ç»ŸAPIå‡½æ•°HtmlHelpæ‰“å¼€.chmæ–‡ä»¶ä¸ºä¾‹ï¼Œåœ¨é¡¹ç›®ä¸­å‘ç°ï¼Œå¦‚æœç›®æ ‡è·¯å¾„ä¸­çš„.chmæ–‡ä»¶ä¸å­˜åœ¨ï¼ŒHtmlHelpå‡½æ•°å†…éƒ¨ä¼šäº§ç”Ÿå¼‚å¸¸ï¼Œå¯¼è‡´ç¨‹åºå´©æºƒï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ·»åŠ äº†__tryâ€¦__exceptè¿›è¡Œä¿æŠ¤ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">OpenChmHelpFile</span><span class="params">( LPCTSTR lpStrPath )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    HWND hHelpWnd = <span class="literal">NULL</span>;</span><br><span class="line">    </span><br><span class="line">    __try</span><br><span class="line">    &#123;</span><br><span class="line">        hHelpWnd = <span class="built_in">HtmlHelp</span>( <span class="literal">NULL</span>, lpStrPath, HH_DISPLAY_TOPIC, <span class="literal">NULL</span> );</span><br><span class="line">    &#125;</span><br><span class="line">    __except( EXCEPTION_EXECUTE_HANDLER )</span><br><span class="line">    &#123;</span><br><span class="line">        hHelpWnd = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> ( <span class="literal">NULL</span> == hHelpWnd )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">WriteLog</span>( _T(<span class="string">&quot;[OpenChmHelpFile] HtmlHelp execute failed, path [%s]!&quot;</span>), lpStrPath );</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="10-2ã€C-å¼‚å¸¸"><a href="#10-2ã€C-å¼‚å¸¸" class="headerlink" title="10.2ã€C++å¼‚å¸¸"></a>10.2ã€C++å¼‚å¸¸</h4><p>C++å¼‚å¸¸å¤„ç†çš„å£°æ˜ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> </span><br><span class="line">&#123;</span><br><span class="line">   <span class="comment">// code that could throw an exception</span></span><br><span class="line">&#125;</span><br><span class="line">[ <span class="built_in">catch</span> (exception-declaration) </span><br><span class="line">&#123;</span><br><span class="line">   <span class="comment">// code that executes when exception-declaration is thrown</span></span><br><span class="line">   <span class="comment">// in the try block</span></span><br><span class="line">&#125;</span><br><span class="line">[<span class="built_in">catch</span> (exception-declaration) </span><br><span class="line">&#123;</span><br><span class="line">   <span class="comment">// code that handles another exception type</span></span><br><span class="line">&#125; ] . . . ]</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">// The following syntax shows a throw expression:</span></span><br><span class="line"><span class="keyword">throw</span> [expression]</span><br></pre></td></tr></table></figure>

<p>C++å¼‚å¸¸å¤„ç†ä½¿ç”¨tryã€catchå’Œthrowä¸‰ä¸ªå…³é”®å­—å®ç°ï¼Œç”¨throwæŠ›å‡ºå¼‚å¸¸ï¼Œç„¶åç”¨tryâ€¦catchæ•è·å¼‚å¸¸ã€‚</p>
<p>æ¯”å¦‚åœ¨ä½¿ç”¨newå»åŠ¨æ€ç”³è¯·å†…å­˜æ—¶ï¼Œå¦‚æœè¿›ç¨‹å†…å­˜ä¸è¶³ï¼Œç”³è¯·ä¸åˆ°æŒ‡å®šå¤§å°çš„å †å†…å­˜æ—¶ï¼Œnewå†…éƒ¨ä¼šæŠ›å‡ºbad_allocå¼‚å¸¸ï¼Œæ•è·è¿™ä¸ªå¼‚å¸¸çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> *p = <span class="keyword">new</span> <span class="type">int</span>[<span class="number">10000000000</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">catch</span> (bad_alloc &amp;e)</span><br><span class="line">&#123;</span><br><span class="line">    cout &lt;&lt; e.<span class="built_in">what</span>() &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="10-3ã€SEHç»“æ„åŒ–å¼‚å¸¸ä¸C-å¼‚å¸¸çš„åŒºåˆ«"><a href="#10-3ã€SEHç»“æ„åŒ–å¼‚å¸¸ä¸C-å¼‚å¸¸çš„åŒºåˆ«" class="headerlink" title="10.3ã€SEHç»“æ„åŒ–å¼‚å¸¸ä¸C++å¼‚å¸¸çš„åŒºåˆ«"></a>10.3ã€SEHç»“æ„åŒ–å¼‚å¸¸ä¸C++å¼‚å¸¸çš„åŒºåˆ«</h4><p>SEH æ˜¯æ“ä½œç³»ç»Ÿæ‰€æä¾›çš„ä¾¿åˆ©ï¼Œå®ƒåœ¨ä»»ä½•è¯­è¨€ä¸­éƒ½å¯ä»¥ä½¿ç”¨ã€‚è€ŒC++å¼‚å¸¸å¤„ç†åªæœ‰åœ¨ç¼–å†™C++ä»£ç æ—¶æ‰å¯ä»¥ä½¿ç”¨ã€‚Microsof çš„ Visual C++ç¼–è¯‘å™¨ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„ç»“æ„åŒ–å¼‚å¸¸æœºåˆ¶æ¥å®ç° C++å¼‚å¸¸å¤„ç†æœºåˆ¶ã€‚æ‰€ä»¥ï¼Œåœ¨åˆ›å»ºä¸€ä¸ª C++ try å—æ—¶ï¼Œç¼–è¯‘å™¨ä¼šä¸ºæˆ‘ä»¬ç”Ÿæˆä¸€ä¸ª SEH __tryå—ã€‚C++çš„catch è¯­å¥å¯¹åº”SEH å¼‚å¸¸è¿‡æ»¤ç¨‹åºï¼Œcatch å—ä¸­çš„ä»£ç åˆ™å¯¹åº”SEH __exceptå—ä¸­çš„ä»£ç ã€‚è€Œç¼–è¯‘å™¨ä¹Ÿä¼šä¸ºC++ throwè¯­å¥ç”Ÿæˆå¯¹WindowsRaiseExceptionå‡½æ•°çš„è°ƒç”¨ï¼Œthrowè¯­å¥æ‰€ä½¿ç”¨çš„å˜é‡åˆ™æˆä¸ºRaiseExceptionçš„é™„åŠ å‚æ•°ã€‚</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/06/15/Obsidian%20%E5%A4%9A%E5%BA%93%E5%85%B1%E7%94%A8%E9%85%8D%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/06/15/Obsidian%20%E5%A4%9A%E5%BA%93%E5%85%B1%E7%94%A8%E9%85%8D%E7%BD%AE/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-06-15 22:00:15" itemprop="dateCreated datePublished" datetime="2025-06-15T22:00:15+08:00">2025-06-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-06-25 00:32:29" itemprop="dateModified" datetime="2025-06-25T00:32:29+08:00">2025-06-25</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mklink [[/D] | [/H] | [/J]] Link Target</span><br></pre></td></tr></table></figure>

<h2 id="D-åˆ›å»ºç¬¦å·ç›®å½•è¿æ¥-è½¯è¿æ¥-H-æ–‡æœ¬æ–‡ä»¶é“¾æ¥-ç¡¬è¿æ¥-J-åˆ›å»ºç›®å½•è¿æ¥-è½¯è¿æ¥-Link-è¦åˆ›å»ºæ–°é“¾æ¥çš„æ–‡ä»¶-Target-æºæ–‡ä»¶"><a href="#D-åˆ›å»ºç¬¦å·ç›®å½•è¿æ¥-è½¯è¿æ¥-H-æ–‡æœ¬æ–‡ä»¶é“¾æ¥-ç¡¬è¿æ¥-J-åˆ›å»ºç›®å½•è¿æ¥-è½¯è¿æ¥-Link-è¦åˆ›å»ºæ–°é“¾æ¥çš„æ–‡ä»¶-Target-æºæ–‡ä»¶" class="headerlink" title="  &#x2F;D åˆ›å»ºç¬¦å·ç›®å½•è¿æ¥,(è½¯è¿æ¥)  &#x2F;H æ–‡æœ¬æ–‡ä»¶é“¾æ¥(ç¡¬è¿æ¥)  &#x2F;J åˆ›å»ºç›®å½•è¿æ¥(è½¯è¿æ¥)  Link è¦åˆ›å»ºæ–°é“¾æ¥çš„æ–‡ä»¶  Target æºæ–‡ä»¶"></a>  &#x2F;D åˆ›å»ºç¬¦å·ç›®å½•è¿æ¥,(è½¯è¿æ¥)<br>  &#x2F;H æ–‡æœ¬æ–‡ä»¶é“¾æ¥(ç¡¬è¿æ¥)<br>  &#x2F;J åˆ›å»ºç›®å½•è¿æ¥(è½¯è¿æ¥)<br>  Link è¦åˆ›å»ºæ–°é“¾æ¥çš„æ–‡ä»¶<br>  Target æºæ–‡ä»¶</h2><h2 id="å‚æ•°-D-å’Œ-J-éƒ½æ˜¯å»ºç«‹ç›®å½•è¿æ¥-H-æ˜¯å»ºç«‹æ–‡ä»¶é“¾æ¥"><a href="#å‚æ•°-D-å’Œ-J-éƒ½æ˜¯å»ºç«‹ç›®å½•è¿æ¥-H-æ˜¯å»ºç«‹æ–‡ä»¶é“¾æ¥" class="headerlink" title="  å‚æ•° &#x2F;D å’Œ &#x2F;J éƒ½æ˜¯å»ºç«‹ç›®å½•è¿æ¥, &#x2F;H æ˜¯å»ºç«‹æ–‡ä»¶é“¾æ¥"></a>  å‚æ•° &#x2F;D å’Œ &#x2F;J éƒ½æ˜¯å»ºç«‹ç›®å½•è¿æ¥, &#x2F;H æ˜¯å»ºç«‹æ–‡ä»¶é“¾æ¥</h2><p>å‰é¢æ˜¯ç›®æ ‡ï¼Œåé¢æ˜¯æº</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mklink /j /d   E:\Develop\Hexoblog\source\Hexo\.obsidian  D:\AllSoftware\Obsidian\Ev\.obsidian</span><br><span class="line"></span><br><span class="line">mklink /j /d   E:\Develop\Project\WinKernelProgram\WinKernelProgram\.obsidian  D:\AllSoftware\Obsidian\Ev\.obsidian</span><br><span class="line"></span><br><span class="line">mklink /j /d   E:\Develop\Note\.obsidian  D:\AllSoftware\Obsidian\Ev\.obsidian</span><br></pre></td></tr></table></figure>


<p>mlink å‘½ä»¤ä½¿ç”¨ä¹Ÿå¯ä»¥çœ‹è¿™é‡Œ</p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/4268d00450c2">https://www.jianshu.com/p/4268d00450c2</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/06/02/debug/%E4%BE%8B%E5%AD%90/%E3%80%8AWindows%E6%A0%B8%E5%BF%83%E7%BC%96%E7%A8%8B%E3%80%8B%E8%8B%A5%E5%B9%B2%E7%9F%A5%E8%AF%86%E7%82%B9%E5%AE%9E%E6%88%98%E5%BA%94%E7%94%A8%E5%88%86%E4%BA%AB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/06/02/debug/%E4%BE%8B%E5%AD%90/%E3%80%8AWindows%E6%A0%B8%E5%BF%83%E7%BC%96%E7%A8%8B%E3%80%8B%E8%8B%A5%E5%B9%B2%E7%9F%A5%E8%AF%86%E7%82%B9%E5%AE%9E%E6%88%98%E5%BA%94%E7%94%A8%E5%88%86%E4%BA%AB/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2025-06-02 22:22:57 / Modified: 22:42:54" itemprop="dateCreated datePublished" datetime="2025-06-02T22:22:57+08:00">2025-06-02</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="1ã€è¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜åˆ†åŒº"><a href="#1ã€è¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜åˆ†åŒº" class="headerlink" title="1ã€è¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜åˆ†åŒº"></a>1ã€è¿›ç¨‹çš„<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98&spm=1001.2101.3001.7020">è™šæ‹Ÿå†…å­˜</a>åˆ†åŒº</h3><p><strong>åœ¨**<strong>13.2èŠ‚</strong></strong>ï¼ˆè™šæ‹Ÿåœ°å€ç©ºé—´çš„åˆ†åŒºï¼‰ä¸­è®²åˆ°äº†è¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜åˆ†åŒº**ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202506022223711.png" alt="image.png"></p>
<h4 id="1-1ã€ç”¨æˆ·æ€è™šæ‹Ÿå†…å­˜ä¸å†…æ ¸æ€è™šæ‹Ÿå†…å­˜"><a href="#1-1ã€ç”¨æˆ·æ€è™šæ‹Ÿå†…å­˜ä¸å†…æ ¸æ€è™šæ‹Ÿå†…å­˜" class="headerlink" title="1.1ã€ç”¨æˆ·æ€è™šæ‹Ÿå†…å­˜ä¸å†…æ ¸æ€è™šæ‹Ÿå†…å­˜"></a>1.1ã€ç”¨æˆ·æ€è™šæ‹Ÿå†…å­˜ä¸å†…æ ¸æ€è™šæ‹Ÿå†…å­˜</h4><p>ç¨‹åºçš„è™šæ‹Ÿå†…å­˜ä¸»è¦åˆ†ä¸ºç”¨æˆ·æ€è™šæ‹Ÿå†…å­˜åŒºå’Œå†…æ ¸æ€è™šæ‹Ÿå†…å­˜åŒºï¼Œæ¯”å¦‚å¯¹äºä¸€ä¸ª32ä½ç¨‹åºï¼Œç³»ç»Ÿä¼šç»™è¿›ç¨‹åˆ†é…4GBçš„è™šæ‹Ÿå†…å­˜ï¼Œé»˜è®¤æƒ…å†µä¸‹ç”¨æˆ·æ€è™šæ‹Ÿå†…å­˜å 2GBï¼Œå†…æ ¸æ€è™šæ‹Ÿå†…å­˜å 2GBã€‚</p>
<p>ä¸€èˆ¬ç¨‹åºçš„ä¸šåŠ¡æ¨¡å—ä¸»è¦è¿è¡Œåœ¨ç”¨æˆ·æ€è™šæ‹Ÿå†…å­˜ä¸­ï¼Œé©±åŠ¨ç›¸å…³çš„æ¨¡å—åˆ™å¯èƒ½è¿è¡Œåœ¨å†…æ ¸æ€è™šæ‹Ÿå†…å­˜ä¸­ã€‚è¿è¡Œåœ¨ç”¨æˆ·æ€çš„æ¨¡å—ç¦æ­¢è®¿é—®å†…æ ¸æ€å†…å­˜åœ°å€ï¼Œè¿è¡Œåœ¨å†…æ ¸æ€çš„æ¨¡å—ç¦æ­¢è®¿é—®ç”¨æˆ·æ€è™šæ‹Ÿå†…å­˜ã€‚</p>
<blockquote>
<p>**åœ¨ç¨‹åºå‘ç”Ÿå†…å­˜å¼‚å¸¸æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°ç”¨æˆ·æ€æ¨¡å—è®¿é—®å†…æ ¸æ€å†…å­˜åœ°å€çš„æƒ…å†µï¼Œä¼šäº§ç”Ÿå†…å­˜è®¿é—®è¿ä¾‹ï¼Œç¨‹åºå‘ç”Ÿå´©æºƒã€‚å…·ä½“çš„è¡¨ç°ä¸ºï¼Œå‘ç”Ÿå´©æºƒçš„é‚£æ¡æ±‡ç¼–æŒ‡ä»¤ä¸­è®¿é—®äº†ä¸€ä¸ªå¾ˆå¤§çš„å†…æ ¸æ€å†…å­˜åœ°å€ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov Â  Â  edx,dword ptr [eax] Â ds:002b:fc8b7653=????????</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°æ±‡ç¼–æŒ‡ä»¤ä¸­è®¿é—®äº†ä¸€ä¸ªå¾ˆå¤§çš„å†…å­˜åœ°å€0xfc8b7653ï¼Œå¯¹äº32ä½ç¨‹åºæ¥è¯´ï¼Œè¯¥åœ°å€å±äºå†…æ ¸æ€çš„å†…å­˜åœ°å€ã€‚</p>
</blockquote>
<blockquote>
<p>**æœ‰äººå¯èƒ½ä¼šè¯´ç›´æ¥çœ‹C++ä»£ç å°±å¥½äº†ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æŸ¥çœ‹æ±‡ç¼–å‘¢ï¼Ÿ**å› ä¸ºç¨‹åºå‘ç”Ÿå´©æºƒæ—¶ï¼Œæœ€ç»ˆæ˜¯å´©æºƒåœ¨æŸæ¡æ±‡ç¼–æŒ‡ä»¤ä¸Šï¼ŒæŸ¥çœ‹æ±‡ç¼–ä»£ç èƒ½çœ‹å‡ºå‘ç”Ÿå´©æºƒçš„æœ€ç›´æ¥åŸå› ï¼Œæ¯”å¦‚æŒ‡ä»¤ä¸­è®¿é—®äº†ä¸è¯¥è®¿é—®çš„å†…å­˜ï¼Œä¾‹å¦‚è®¿é—®äº†å¾ˆå°çš„å†…å­˜ï¼ˆå°åœ°å€å†…å­˜åŒºçš„å†…å­˜ï¼‰æˆ–è€…è®¿é—®äº†å¾ˆå¤§çš„å†…å­˜åœ°å€ï¼ˆå†…æ ¸æ€è™šæ‹Ÿå†…å­˜åŒºçš„å†…å­˜ï¼‰ã€‚æ­¤å¤–ï¼Œä¸€è¡Œä»£ç å¯èƒ½ç”±å‡ ä¸ªå­å¥æ„æˆï¼Œé€šè¿‡æŸ¥çœ‹æ±‡ç¼–ä»£ç ä¸Šä¸‹æ–‡ï¼Œå°±èƒ½ç¡®å®šåˆ°åº•æ˜¯å“ªä¸ªå­å¥å‡ºçš„é—®é¢˜ã€‚Â </p>
</blockquote>
<p>Â  Â å¯¹äº32ä½ç¨‹åºï¼Œé»˜è®¤ç”¨æˆ·æ€è™šæ‹Ÿå†…å­˜å ç”¨2GBï¼Œå¦‚æœç¨‹åºä¸­çš„ä¸šåŠ¡æ¨¡å—åºå¤§ï¼ˆéœ€è¦å ç”¨å¤§é‡çš„å†…å­˜ï¼‰ï¼Œè€Œä¸šåŠ¡æ¨¡å—åŸºæœ¬éƒ½è¿è¡Œåœ¨ç”¨æˆ·æ€è™šæ‹Ÿå†…å­˜ä¸­ï¼Œé»˜è®¤çš„2GBçš„è™šæ‹Ÿå†…å­˜å¯èƒ½ä¸å¤Ÿç”¨ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®å°†ç”¨æˆ·æ€è™šæ‹Ÿå†…å­˜ä»2GBæ‰©å±•åˆ°3GBã€‚å…·ä½“çš„åšæ³•æ˜¯ï¼Œ<strong>åœ¨Visual Studioçš„å·¥ç¨‹å±æ€§ä¸­å¯ä»¥å¼€å¯</strong><strong>&#x2F;LARGEADDRESSAWARE****å¯ç”¨å¤§åœ°å€é€‰é¡¹</strong>ï¼šï¼ˆé“¾æ¥å™¨ -&gt; ç³»ç»Ÿ -&gt; å¯åŠ¨å¤§åœ°å€ï¼‰<br>Â  Â <br><img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202506022224519.png" alt="image.png"></p>
<p>è¿™æ ·ç”¨æˆ·æ€çš„è™šæ‹Ÿå†…å­˜å°±ä¼šä»é»˜è®¤çš„2GBæ‰©å……åˆ°3GBï¼Œå†…æ ¸æ€å†…å­˜ä¹Ÿå°±å˜åˆ°äº†1GBã€‚</p>
<p>Â Â  ç”¨æˆ·æ€è™šæ‹Ÿå†…å­˜è¾¾åˆ°ä¸Šé™ï¼Œå¯èƒ½æœ‰ä¸¤ä¸ªåŸå› ï¼š</p>
<blockquote>
<p><strong>1ï¼‰ç¨‹åºä¸­æœ‰å†…å­˜æ³„æ¼ï¼Œå¤šæ¬¡æ³„æ¼å°†å†…å­˜è€—å°½äº†</strong><br>æœ‰å†…å­˜æ³„æ¼çš„ä»£ç é¢‘ç¹åœ°è¢«æ‰§è¡Œï¼Œå†…å­˜æŒç»­åœ°è¢«å ç”¨ä¸é‡Šæ”¾ï¼Œå¯¼è‡´ç¨‹åºå ç”¨çš„è™šæ‹Ÿå†…å­˜æ¥è¿‘æˆ–è¾¾åˆ°ç”¨æˆ·æ€è™šæ‹Ÿå†…å­˜çš„ä¸Šé™ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œåˆ™è¦æ’æŸ¥å†…å­˜æ³„æ¼çš„ç‚¹ï¼Œå½»åº•æ¶ˆé™¤å†…å­˜æ³„æ¼ã€‚<br><strong>2ï¼‰ç¨‹åºä¸­åŒ…å«äº†å¤šä¸ªä¸šåŠ¡æ¨¡å—ï¼Œç¡®å®è¦å ç”¨å¤§é‡çš„ç”¨æˆ·æ€å†…å­˜</strong><br>ç¨‹åºä¸­åŒ…å«äº†å¤šä¸ªä¸šåŠ¡æ¨¡å—ï¼Œç¡®å®è¦å ç”¨å¤§é‡çš„ç”¨æˆ·æ€è™šæ‹Ÿå†…å­˜ã€‚æ¯”å¦‚æˆ‘ä»¬è½¯ä»¶ä¸­ä½¿ç”¨WebRTCå¼€æºåº“ï¼Œå¾ˆåºå¤§ï¼Œåˆå§‹åŒ–æ—¶ä¼šç”³è¯·å¤§é‡çš„å†…å­˜ï¼ˆä¸€ä¸Šæ¥å¾ˆå¤šä¸šåŠ¡å°±ä¼šå°†å†…å­˜åˆ†é…å¥½ï¼‰ï¼Œå³å¯åŠ¨æ—¶å°±ä¼šå ç”¨å¤§é‡çš„å†…å­˜ã€‚è½¯ä»¶é™¤äº†WebRTCåº“ï¼Œè¿˜åŒ…å«äº†å¤šä¸ªä¸šåŠ¡æ¨¡å—ï¼Œè¿™æ ·åŠ èµ·æ¥å ç”¨çš„è™šæ‹Ÿå†…å­˜å°±æ›´å¤§äº†ã€‚</p>
</blockquote>
<p>å¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦ä¼˜åŒ–ä»£ç ï¼Œå‡å°‘ç¨‹åºå¯¹å†…å­˜çš„å ç”¨ã€‚æœ‰ä¸€ä¸ªé‡è¦çš„åŸåˆ™ï¼Œéœ€è¦ä½¿ç”¨æ—¶å†å»ç”³è¯·ï¼Œä¸å†ä½¿ç”¨æ—¶ç«‹å³å°†å†…å­˜é‡Šæ”¾æ‰ã€‚</p>
<p>Â  Â åæ¥<strong>æˆ‘ä»¬ç”¨Process Explorerå·¥å…·è§‚å¯Ÿè½¯ä»¶åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å ç”¨çš„æ€»è™šæ‹Ÿå†…å­˜å¤§å°ï¼ˆç”¨æˆ·æ€çš„è™šæ‹Ÿå†…å­˜ï¼‰ï¼š</strong></p>
<p><img src="https://i-blog.csdnimg.cn/direct/bada6ebe895240bf8f65e7c32e158ea4.png"></p>
<p>åœ¨å´©æºƒæ—¶é—´ç‚¹å·¦å³ï¼Œç¨‹åºçš„ç”¨æˆ·æ€å†…å­˜å·²ç»æ¥è¿‘32ä½ç¨‹åºé»˜è®¤çš„2GBçš„ç”¨æˆ·æ€è™šæ‹Ÿå†…å­˜çš„ä¸Šé™äº†ï¼ˆæ³¨æ„ä¸Šå›¾ä¸­ä¸æ˜¯å½“æ—¶çš„é—®é¢˜æˆªå›¾ï¼Œåªæ˜¯ä¸€ä¸ªæŸ¥çœ‹ç¨‹åºè™šæ‹Ÿå†…å­˜å ç”¨çš„å®ä¾‹ï¼‰ã€‚è¿›ä¸€æ­¥æ’æŸ¥ï¼Œæ’é™¤äº†å†…å­˜æ³„æ¼çš„å­˜åœ¨ï¼Œæ˜¯å› ä¸ºè½¯ä»¶ä¸­çš„å¤šä¸ªä¸šåŠ¡æ¨¡å—ç¡®å®éœ€è¦å ç”¨å¤§é‡çš„å†…å­˜ç©ºé—´ã€‚äºæ˜¯ä»ä¸Šå±‚åˆ°åº•å±‚å¯¹å†…å­˜å ç”¨è¿›è¡Œäº†ä¸€äº›ä¼˜åŒ–ï¼Œè™½ç„¶å‡å°‘å‡ºé—®é¢˜çš„æ¦‚ç‡ï¼Œä½†è¿˜æ˜¯ä¼šå‡ºç°é—ªé€€çš„é—®é¢˜ã€‚</p>
<p>Â  Â å› ä¸ºæ—¶é—´ä»“ä¿ƒï¼Œæ¶‰åŠåˆ°åº•å±‚çš„å¤šä¸ªæ¨¡å—ï¼Œä¸€æ—¶åŠä¼šå¾ˆéš¾è¿›è¡Œè¾ƒå¤§çš„ä¼˜åŒ–ã€‚åæ¥å°±å¼€å¯äº†å¤§åœ°å€é€‰é¡¹ï¼Œå³å°†32ä½ç¨‹åºçš„2GBçš„ç”¨æˆ·æ€è™šæ‹Ÿå†…å­˜æ‰©å……äº†3GBï¼Œæš‚æ—¶å°†è¿™ä¸ªé—®é¢˜è§„é¿æ‰ã€‚ç»åç»­æµ‹è¯•éªŒè¯ï¼Œç¡®å®æœ‰æ•ˆåœ°è§£å†³äº†é—®é¢˜ã€‚è‡³äºå¦‚ä½•å¼€å¯32ä½ç¨‹åºçš„å¤§åœ°å€æ¨¡å¼ï¼Œ<strong>åªè¦åœ¨exeä¸»ç¨‹åºçš„å·¥ç¨‹å±æ€§</strong>ä¸­å¼€å¯&#x2F;LARGEADDRESSAWAREå¤§åœ°å€é€‰é¡¹å³å¯ï¼š</p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/60136e98c9e7aa36e668ef37b8a742a3.png"></p>
<h4 id="1-2ã€å°äº0x10000çš„å°åœ°å€å†…å­˜åŒº"><a href="#1-2ã€å°äº0x10000çš„å°åœ°å€å†…å­˜åŒº" class="headerlink" title="1.2ã€å°äº0x10000çš„å°åœ°å€å†…å­˜åŒº"></a>1.2ã€å°äº0x10000çš„å°åœ°å€å†…å­˜åŒº</h4><p>Â  Â  Â  Â Windowsç³»ç»Ÿä¸“é—¨é¢„ç•™äº†ä¸€å—ä»0åˆ°0x10000çš„å°åœ°å€å†…å­˜åŒºï¼Œåˆç§°ç©ºæŒ‡é’ˆå†…å­˜åŒºæˆ–ç©ºæŒ‡é’ˆèµ‹å€¼å†…å­˜åˆ†åŒºï¼š</p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/571ade4ce4337f789873a924df944136.png"></p>
<p>ä¸“é—¨ä¸ºäº†å¸®ç¨‹åºå‘˜å®šä½è®¿é—®ç©ºæŒ‡é’ˆçš„é—®é¢˜ã€‚</p>
<p>Â  Â å½“è®¿é—®åˆ°è¿™ä¸ªå†…å­˜åŒºåŸŸæ—¶ï¼Œå°±ä¼šè§¦å‘å†…å­˜è®¿é—®è¿ä¾‹ï¼Œç³»ç»Ÿä¼šå¼ºåˆ¶å°†è¿›ç¨‹ç»ˆæ­¢æ‰ã€‚ä¸ºä»€ä¹ˆä½¿ç”¨ç©ºæŒ‡é’ˆå°±ä¼šè®¿é—®åˆ°è¿™ä¸ªå°åœ°å€å†…å­˜åŒºå‘¢ï¼Ÿæ¯”å¦‚ç±»å¯¹è±¡æŒ‡é’ˆå€¼ä¸ºNULLï¼Œä»£ç ä¸­æ²¡æœ‰åˆ¤æ–­æŒ‡é’ˆæ˜¯å¦ä¸ºç©ºï¼Œç›´æ¥ä½¿ç”¨è¯¥æŒ‡é’ˆå»è®¿é—®æŒ‡å‘çš„ç±»çš„æˆå‘˜å˜é‡ï¼Œå³å°†NULLå€¼ä½œä¸ºC++ç±»å¯¹è±¡çš„é¦–åœ°å€ï¼Œé‚£ä¹ˆç±»å¯¹è±¡çš„æ•°æ®æˆå‘˜çš„å†…å­˜åœ°å€å°±æ˜¯ç›¸å¯¹äºæ‰€åœ¨å¯¹è±¡åœ°å€NULLçš„åç§»ï¼Œå³æˆå‘˜å˜é‡çš„åœ°å€æ˜¯ä¸ªå¾ˆå°çš„å†…å­˜åœ°å€ï¼Œè€Œè®¿é—®å˜é‡çš„å€¼å°±æ˜¯å»è¯»æˆ–å†™è¯¥å˜é‡çš„å†…å­˜åœ°å€ä¸­çš„å†…å®¹ï¼Œå°±æ˜¯å»è®¿é—®å˜é‡çš„å†…å­˜ï¼Œè¿™æ ·å°±ä¼šå»è®¿é—®ä¸€ä¸ªå¾ˆå°çš„å†…å­˜åœ°å€ï¼Œå³è®¿é—®ç©ºæŒ‡é’ˆèµ‹å€¼åŒºï¼Œå°±ä¼šè§¦å‘å†…å­˜è®¿é—®è¿ä¾‹ï¼Œå¼•å‘å´©æºƒã€‚</p>
<blockquote>
<p><strong>è¿™é‡Œæ¶‰åŠäº†ç±»å¯¹è±¡ä¸­çš„æˆå‘˜å˜é‡å†…å­˜åœ¨ç±»å¯¹è±¡ä¸­æ’å¸ƒé—®é¢˜</strong>ï¼Œæˆå‘˜å˜é‡çš„å†…å­˜åœ°å€éƒ½æ˜¯ç›¸å¯¹äºæ‰€åœ¨ç±»å¯¹è±¡çš„å†…å­˜åœ°å€çš„åç§»ï¼æ¯”å¦‚æŸæ¡ˆä¾‹ä¸­å› ä¸ºç©ºæŒ‡é’ˆè®¿é—®äº†ä¸€ä¸ªå¾ˆå°çš„å†…å­˜åœ°å€ï¼ˆå°åœ°å€å†…å­˜åŒºï¼‰ï¼Œäº§ç”Ÿå†…å­˜è®¿é—®è¿ä¾‹å‘ç”Ÿå´©æºƒï¼Œå‘ç”Ÿå´©æºƒçš„é‚£æ¡æ±‡ç¼–æŒ‡ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov Â  Â  edx,dword ptr [eax] Â ds:002b:00000124=????????</span><br></pre></td></tr></table></figure>

<p>è¯¥æ±‡ç¼–æŒ‡ä»¤ä¸­è®¿é—®çš„0x00000124ï¼Œæ˜¯ä¸ªå¾ˆå°çš„å†…å­˜åœ°å€ï¼Œå±äºç©ºæŒ‡é’ˆå†…å­˜åŒºï¼Œæ˜¯ç¦æ­¢è®¿é—®çš„ï¼Œæ‰€ä»¥äº§ç”Ÿäº†å†…å­˜è®¿é—®è¿ä¾‹ã€‚</p>
</blockquote>
<blockquote>
<p>ç©ºæŒ‡é’ˆæ˜¯å¼•å‘ç¨‹åºå¼‚å¸¸çš„å¸¸è§åŸå› ä¹‹ä¸€ã€‚å¦å¤–ï¼Œè®¿é—®å·²ç»é‡Šæ”¾å†…å­˜çš„é‡æŒ‡é’ˆï¼Œåˆ†ææ€è·¯ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œå³ç±»çš„æˆå‘˜å˜é‡çš„åœ°å€æ˜¯ç›¸å¯¹æ‰€åœ¨ç±»å¯¹è±¡åœ°å€çš„åç§»ã€‚</p>
</blockquote>
<p>Â  Â **è¿™ä¸ªåœ°æ–¹æœ‰ä¸€ç‚¹éœ€è¦æä¸€ä¸‹ï¼Œä½¿ç”¨ç©ºæŒ‡é’ˆå»è°ƒç”¨ç±»çš„æˆå‘˜å‡½æ•°æ˜¯å¦ä¸€å®šä¼šå¯¼è‡´å´©æºƒå‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä¸ä¸€å®šï¼Œä¸ä¸€å®šä¼šå¯¼è‡´å´©æºƒï¼Œè¿™ä¸»è¦çœ‹æœ‰æ²¡æœ‰è®¿é—®ä¸åº”è¯¥è®¿é—®çš„å†…å­˜ã€‚æ¯”å¦‚è¢«è°ƒç”¨å‡½æ•°ä¸­æ²¡æœ‰è®¿é—®ç±»çš„æ•°æ®æˆå‘˜ï¼ˆæˆå‘˜å˜é‡ï¼Œå ç”¨çš„æ˜¯æ•°æ®æ®µå†…å­˜ï¼‰ï¼Œå³ä¸ä¼šè®¿é—®ç±»å¯¹è±¡çš„å†…å­˜ï¼Œå°±ä¸ä¼šå´©æºƒã€‚</p>
<blockquote>
<p>è°ƒç”¨çš„å‡½æ•°æ‰§è¡Œçš„æ˜¯ä»£ç æ®µä¸Šçš„æŒ‡ä»¤ï¼Œè°ƒç”¨å‡½æ•°æœ¬èº«å¹¶ä¸ä¼šæœ‰å¼‚å¸¸ã€‚è¿™é‡Œè¦åŒºåˆ†æ•°æ®æ®µå†…å­˜ä¸ä»£ç æ®µå†…å­˜ã€‚</p>
</blockquote>
<p>ä½†å¦‚æœä½¿ç”¨ç©ºæŒ‡é’ˆå»è°ƒç”¨è™šå‡½æ•°ï¼Œä¼šæ¶‰åŠåˆ°è™šå‡½æ•°çš„äºŒæ¬¡å¯»å€ï¼Œå³å…ˆå»è®¿é—®ç±»å¯¹è±¡ä¸­éšå«çš„è™šå‡½æ•°è¡¨æŒ‡é’ˆä¸­çš„å†…å®¹ï¼ˆå­˜æ”¾çš„è™šå‡½æ•°è¡¨çš„é¦–åœ°å€ï¼‰ï¼Œè™šå‡½æ•°è¡¨æŒ‡é’ˆå˜é‡çš„åœ°å€å°±æ˜¯å…¶æ‰€å±çš„C++ç±»å¯¹è±¡çš„é¦–åœ°å€ï¼Œå°±ä¼šå› ä¸ºç©ºæŒ‡é’ˆè®¿é—®å¾ˆå°çš„å†…å­˜åœ°å€ï¼Œå¼•å‘å†…å­˜è®¿é—®è¿ä¾‹ã€‚</p>
<h3 id="2ã€ä¿å­˜çº¿ç¨‹ä¸Šä¸‹æ–‡çš„CONTEXTç»“æ„ä½“"><a href="#2ã€ä¿å­˜çº¿ç¨‹ä¸Šä¸‹æ–‡çš„CONTEXTç»“æ„ä½“" class="headerlink" title="2ã€ä¿å­˜çº¿ç¨‹ä¸Šä¸‹æ–‡çš„CONTEXTç»“æ„ä½“"></a>2ã€ä¿å­˜çº¿ç¨‹ä¸Šä¸‹æ–‡çš„CONTEXT<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E7%BB%93%E6%9E%84%E4%BD%93&spm=1001.2101.3001.7020">ç»“æ„ä½“</a></h3><p><strong>åœ¨**<strong>7.7èŠ‚</strong></strong>ï¼ˆåœ¨å®é™…ä¸Šä¸‹æ–‡ä¸­è°ˆCONTEXTç»“æ„ä½“ï¼‰ä¸­è®²åˆ°äº†ä¿å­˜çº¿ç¨‹ä¸Šä¸‹æ–‡ä¿¡æ¯çš„CONTEXTç»“æ„ä½“ã€‚åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´åˆ‡æ¢æ—¶ä¼šä½¿ç”¨åˆ°ç³»ç»Ÿå®šä¹‰çš„CONTEXTç»“æ„ä½“ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Context Frame</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  This frame has a several purposes: 1) it is used as an argument to</span></span><br><span class="line"><span class="comment">//  NtContinue, 2) is is used to constuct a call frame for APC delivery,</span></span><br><span class="line"><span class="comment">//  and 3) it is used in the user level thread creation routines.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  The layout of the record conforms to a standard call frame.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_CONTEXT</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// The flags values within this flag control the contents of</span></span><br><span class="line">    <span class="comment">// a CONTEXT record.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// If the context record is used as an input parameter, then</span></span><br><span class="line">    <span class="comment">// for each portion of the context record controlled by a flag</span></span><br><span class="line">    <span class="comment">// whose value is set, it is assumed that that portion of the</span></span><br><span class="line">    <span class="comment">// context record contains valid context. If the context record</span></span><br><span class="line">    <span class="comment">// is being used to modify a threads context, then only that</span></span><br><span class="line">    <span class="comment">// portion of the threads context will be modified.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// If the context record is used as an IN OUT parameter to capture</span></span><br><span class="line">    <span class="comment">// the context of a thread, then only those portions of the thread&#x27;s</span></span><br><span class="line">    <span class="comment">// context corresponding to set flags will be returned.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// The context record is never used as an OUT only parameter.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line"> </span><br><span class="line">    DWORD ContextFlags;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// This section is specified/returned if CONTEXT_DEBUG_REGISTERS is</span></span><br><span class="line">    <span class="comment">// set in ContextFlags.  Note that CONTEXT_DEBUG_REGISTERS is NOT</span></span><br><span class="line">    <span class="comment">// included in CONTEXT_FULL.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line"> </span><br><span class="line">    DWORD   Dr0;</span><br><span class="line">    DWORD   Dr1;</span><br><span class="line">    DWORD   Dr2;</span><br><span class="line">    DWORD   Dr3;</span><br><span class="line">    DWORD   Dr6;</span><br><span class="line">    DWORD   Dr7;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// This section is specified/returned if the</span></span><br><span class="line">    <span class="comment">// ContextFlags word contians the flag CONTEXT_FLOATING_POINT.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line"> </span><br><span class="line">    FLOATING_SAVE_AREA FloatSave;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// This section is specified/returned if the</span></span><br><span class="line">    <span class="comment">// ContextFlags word contians the flag CONTEXT_SEGMENTS.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line"> </span><br><span class="line">    DWORD   SegGs;</span><br><span class="line">    DWORD   SegFs;</span><br><span class="line">    DWORD   SegEs;</span><br><span class="line">    DWORD   SegDs;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// This section is specified/returned if the</span></span><br><span class="line">    <span class="comment">// ContextFlags word contians the flag CONTEXT_INTEGER.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line"> </span><br><span class="line">    DWORD   Edi;</span><br><span class="line">    DWORD   Esi;</span><br><span class="line">    DWORD   Ebx;</span><br><span class="line">    DWORD   Edx;</span><br><span class="line">    DWORD   Ecx;</span><br><span class="line">    DWORD   Eax;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// This section is specified/returned if the</span></span><br><span class="line">    <span class="comment">// ContextFlags word contians the flag CONTEXT_CONTROL.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line"> </span><br><span class="line">    DWORD   Ebp;</span><br><span class="line">    DWORD   Eip;</span><br><span class="line">    DWORD   SegCs;              <span class="comment">// MUST BE SANITIZED</span></span><br><span class="line">    DWORD   EFlags;             <span class="comment">// MUST BE SANITIZED</span></span><br><span class="line">    DWORD   Esp;</span><br><span class="line">    DWORD   SegSs;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// This section is specified/returned if the ContextFlags word</span></span><br><span class="line">    <span class="comment">// contains the flag CONTEXT_EXTENDED_REGISTERS.</span></span><br><span class="line">    <span class="comment">// The format and contexts are processor specific</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line"> </span><br><span class="line">    BYTE    ExtendedRegisters[MAXIMUM_SUPPORTED_EXTENSION];</span><br><span class="line"> </span><br><span class="line">&#125; CONTEXT;</span><br></pre></td></tr></table></figure>


<p>çº¿ç¨‹æ˜¯åˆ†é…CPUæ—¶é—´ç‰‡çš„åŸºæœ¬å•å…ƒï¼Œçº¿ç¨‹å¤±å»CPUæ—¶é—´ç‰‡åï¼Œçº¿ç¨‹å°±ä¼šè¢«æŒ‚èµ·ï¼Œè¿›å…¥äº†ç¡çœ çŠ¶æ€ï¼›çº¿ç¨‹è·å–åˆ°äº†CPUæ—¶é—´ç‰‡ï¼Œåˆ™ä¼šä»ç¡çœ ä¸­å”¤é†’ï¼Œç»§ç»­æ‰§è¡Œã€‚</p>
<p><strong>çº¿ç¨‹å¤±å»æ—¶é—´ç‰‡æ—¶</strong>ï¼Œä¼šå°†çº¿ç¨‹ä¸Šä¸‹æ–‡ä¸­çš„å¯„å­˜å™¨ç­‰ä¿¡æ¯ä¿å­˜åˆ°CONTEXTç»“æ„ä½“ä¸­ï¼Œç„¶åè¿›å…¥æŒ‚èµ·ï¼ˆç¡çœ ï¼‰çŠ¶æ€ï¼›<strong>å½“çº¿ç¨‹è·å–CPUæ—¶é—´ç‰‡å</strong>ï¼Œåˆ™ä¼šä»ä¹‹å‰ä¿å­˜çš„CONTEXTç»“æ„ä½“ä¸­æŠŠä¹‹å‰ä¿å­˜çš„å¯„å­˜å™¨ä¿¡æ¯ç»™è¯»å‡ºæ¥ï¼Œæ”¾åˆ°å½“å‰çš„å¯„å­˜å™¨ä¸­ï¼Œç„¶åçº¿ç¨‹ç»§ç»­æ¥ç€æŒ‚èµ·å‰çš„çŠ¶æ€ç»§ç»­è¿è¡Œã€‚è¿™ç‚¹å¯¹äºä»æ±‡ç¼–è§’åº¦å»ç†è§£å¤šçº¿ç¨‹ä»£ç çš„æ‰§è¡Œç»†èŠ‚å¾ˆé‡è¦ã€‚</p>
<h3 id="3ã€ä»æ±‡ç¼–ä»£ç è§’åº¦å»ç†è§£å¤šçº¿ç¨‹è¿è¡Œè¿‡ç¨‹çš„å…¸å‹å®ä¾‹"><a href="#3ã€ä»æ±‡ç¼–ä»£ç è§’åº¦å»ç†è§£å¤šçº¿ç¨‹è¿è¡Œè¿‡ç¨‹çš„å…¸å‹å®ä¾‹" class="headerlink" title="3ã€ä»æ±‡ç¼–ä»£ç è§’åº¦å»ç†è§£å¤šçº¿ç¨‹è¿è¡Œè¿‡ç¨‹çš„å…¸å‹å®ä¾‹"></a>3ã€ä»æ±‡ç¼–ä»£ç è§’åº¦å»ç†è§£å¤šçº¿ç¨‹è¿è¡Œè¿‡ç¨‹çš„å…¸å‹å®ä¾‹</h3><p>åœ¨8.1èŠ‚ï¼ˆåŸå­è®¿é—®:Interlocked ç³»åˆ—å‡½æ•°ï¼‰ä¸­è®²åˆ°çš„é‚£ä¸ªå¤šçº¿ç¨‹å®ä¾‹ï¼Œè™½ç„¶å¾ˆç®€å•ï¼Œä½†å®ƒæ˜¯ä»æ±‡ç¼–è§’åº¦å»ç†è§£å¤šçº¿ç¨‹ä»£ç æ‰§è¡Œç»†èŠ‚çš„å…¸å‹å®ä¾‹ã€‚ä»æ±‡ç¼–ä»£ç çš„è§’åº¦æ‰èƒ½å°†è¿™ä¸ªå®ä¾‹ç†è§£é€å½»çš„ï¼</p>
<p>è¯¥ä¾‹å­ä¸­å®šä¹‰äº†ä¸€ä¸ªlongå‹çš„å…¨å±€å˜é‡ï¼Œç„¶ååˆ›å»ºäº†ä¸¤ä¸ªçº¿ç¨‹ï¼Œçº¿ç¨‹å‡½æ•°åˆ†åˆ«æ˜¯ThreadFunc1å’ŒThreadFunc2ï¼Œè¿™ä¸¤ä¸ªçº¿ç¨‹å‡½æ•°ä¸­å‡å¯¹g_xå˜é‡è¿›è¡Œè‡ªåŠ æ“ä½œï¼ˆåœ¨è®¿é—®å…±äº«å˜é‡g_xæ—¶æœªåŠ é”åŒæ­¥ï¼‰ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// define a global variable</span></span><br><span class="line"><span class="type">long</span> g_x = <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line"><span class="function">DWORD WINAPI <span class="title">ThreadFunc1</span><span class="params">(PVOID pvParam)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    g_x++;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function">DWORD WINAPI <span class="title">ThreadFunc2</span><span class="params">(PVOID pvParam)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    g_x++;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œ<strong>å½“è¿™ä¸¤ä¸ªçº¿ç¨‹å‡½æ•°æ‰§è¡Œå®Œåï¼Œå…¨å±€å˜é‡g_xçš„å€¼ä¼šæ˜¯å¤šå°‘å‘¢ï¼Ÿä¸€å®šä¼šæ˜¯2å—ï¼Ÿ</strong></p>
<p>Â  Â å®é™…ä¸Šï¼Œ<strong>åœ¨ä¸¤ä¸ªçº¿ç¨‹å‡½æ•°æ‰§è¡Œå®Œåï¼Œg_xçš„å€¼ä¸ä¸€å®šä¸º2</strong>ã€‚è¿™ä¸ªå®ä¾‹éœ€è¦ä»æ±‡ç¼–ä»£ç çš„è§’åº¦å»ç†è§£ï¼Œä»C++æºç çœ‹åˆ™å¾ˆéš¾ææ‡‚ï¼Œè¿™æ˜¯ä¸€ä¸ªä»æ±‡ç¼–ä»£ç è§’åº¦å»ç†è§£ä»£ç æ‰§è¡Œç»†èŠ‚çš„å…¸å‹å®ä¾‹ã€‚</p>
<blockquote>
<p>ç†Ÿæ‚‰æ±‡ç¼–ä»£ç ï¼Œä¸ä»…å¯ä»¥è¾…åŠ©æ’æŸ¥C++è½¯ä»¶å¼‚å¸¸ï¼Œè¿˜å¯ä»¥ç†è§£å¾ˆå¤šé«˜çº§è¯­è¨€æ— æ³•ç†è§£çš„ä»£ç æ‰§è¡Œç»†èŠ‚ã€‚</p>
</blockquote>
<p>Â  Â <em>æœ‰äº›äººå¯èƒ½è§‰å¾—ï¼Œä»£ç ä¸­å°±æ˜¯ä¸€ä¸ªè‡ªåŠ çš„æ“ä½œï¼Œä¸€ä¸‹å­å°±æ‰§è¡Œå®Œäº†ï¼Œä¸­é—´åº”è¯¥ä¸ä¼šè¢«æ‰“æ–­ã€‚<strong>ä¼šä¸ä¼šè¢«æ‰“æ–­ï¼Œå…¶å®è¦çœ‹æ±‡ç¼–ä»£ç çš„</strong></em>ï¼Œè¿™è¡ŒC++æºç å¯¹åº”ä¸‰è¡Œæ±‡ç¼–ä»£ç ï¼Œå¯¹g_xå˜é‡çš„è‡ªåŠ è¿™å¥C++ä»£ç ï¼Œå¯¹åº”çš„æ±‡ç¼–ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MOV EAX, [g_x]  // å°†g_xå˜é‡çš„å€¼è¯»åˆ°EAXå¯„å­˜å™¨ä¸­</span><br><span class="line">INC EAX         // å°†EAXä¸­çš„å€¼æ‰§è¡Œè‡ªåŠ æ“ä½œ</span><br><span class="line">MOV [g_x], EAX  // ç„¶åå°†EAXä¸­çš„å€¼è®¾ç½®åˆ°g_xå˜é‡å†…å­˜ä¸­</span><br></pre></td></tr></table></figure>

<p>çœ‹C++ä»£ç ï¼šg_x++ï¼Œåªèƒ½ä¿è¯CPUæ‰§è¡ŒæŸæ¡<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E6%B1%87%E7%BC%96%E6%8C%87%E4%BB%A4&spm=1001.2101.3001.7020">æ±‡ç¼–æŒ‡ä»¤</a>æ—¶ä¸ä¼šè¢«æ‰“æ–­ï¼ˆæ±‡ç¼–æŒ‡ä»¤æ˜¯CPUæ‰§è¡Œçš„æœ€å°ç²’åº¦ï¼‰ï¼Œä½†3æ¡æ±‡ç¼–æŒ‡ä»¤ï¼ŒæŒ‡ä»¤ä¸æŒ‡ä»¤ä¹‹é—´æ˜¯å¯èƒ½è¢«æ‰“æ–­çš„ã€‚</p>
<p>Â  ä¸ºä»€ä¹ˆè¯´ä¸¤ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæˆåg_xå˜é‡çš„å€¼æ˜¯ä¸ç¡®å®šçš„å‘¢ï¼Ÿæ¯”å¦‚å¯èƒ½å­˜åœ¨ä¸¤ç§åœºæ™¯ï¼š</p>
<p><strong>1ï¼‰åœºæ™¯1ï¼ˆæœ€ç»ˆç»“æœg_x&#x3D;2ï¼‰</strong>Â </p>
<p>Â  å‡è®¾çº¿ç¨‹1å…ˆå¿«é€Ÿæ‰§è¡Œäº†ä¸‰è¡Œæ±‡ç¼–æŒ‡ä»¤ï¼Œæœªè¢«æ‰“æ–­ï¼Œg_xçš„å€¼å˜æˆ1ã€‚ç„¶åç´§æ¥ç€çº¿ç¨‹2æ‰§è¡Œï¼Œåœ¨g_x&#x3D;1çš„åŸºç¡€ä¸Šç´¯åŠ ï¼Œæœ€ç»ˆä¸¤ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œåï¼Œg_xç­‰äº2ã€‚</p>
<p><strong>2ï¼‰åœºæ™¯2ï¼ˆæœ€ç»ˆç»“æœg_x&#x3D;1ï¼‰</strong></p>
<p>Â  å‡è®¾çº¿ç¨‹1å…ˆæ‰§è¡Œï¼Œå½“æ‰§è¡Œå®Œå‰ä¸¤æ¡æ±‡ç¼–æŒ‡ä»¤åï¼Œçº¿ç¨‹1å¤±å»æ—¶é—´ç‰‡ï¼ˆçº¿ç¨‹ä¸Šä¸‹æ–‡ä¿¡æ¯ä¿å­˜åˆ°CONTEXTç»“æ„ä½“ä¸­ï¼‰ï¼š</p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/79ead2f1e701b449f1309ff38eefa9e4.png"></p>
<p>å³çº¿ç¨‹1å‰ä¸¤æ¡æ±‡ç¼–æŒ‡ä»¤æ‰§è¡Œå®Œï¼Œç¬¬3æ¡æ±‡ç¼–æŒ‡ä»¤è¿˜æ²¡æ¥å¾—åŠæ‰§è¡Œï¼Œå°±å¤±å»CPUæ—¶é—´ç‰‡äº†ï¼</p>
<p>çº¿ç¨‹2æ‰§è¡Œï¼Œä¸€æ¬¡æ‰§è¡Œå®Œä¸‰æ¡æŒ‡ä»¤ï¼Œå½“å‰g_x&#x3D;1ã€‚ç„¶åçº¿ç¨‹1è·å¾—CPUæ—¶é—´ç‰‡ï¼Œå› ä¸ºä¸Šæ¬¡æ‰§è¡Œä¸¤æ¡æ±‡ç¼–æŒ‡ä»¤åEAXå¯„å­˜å™¨ä¸­çš„å€¼ä¸º1ï¼Œå› ä¸ºçº¿ç¨‹1è·å–äº†æ—¶é—´ç‰‡ï¼Œä¿å­˜çº¿ç¨‹ä¸Šä¸‹æ–‡ä¿¡æ¯çš„CONTEXTæ¢å¤åˆ°çº¿ç¨‹1ä¸­ï¼ŒEAX&#x3D;1ï¼Œç»§ç»­æ‰§è¡Œç¬¬3æ¡æŒ‡ä»¤ï¼Œæ‰§è¡Œå®Œåg_xè¿˜æ˜¯1ã€‚</p>
<p><strong>æ‰€ä»¥ï¼Œè¿™ä¸ªå¤šçº¿ç¨‹é—®é¢˜ï¼Œéœ€è¦ä»æ±‡ç¼–ä»£ç çš„è§’åº¦å»ç†è§£ï¼Œä»C++æºç çš„è§’åº¦å¾ˆéš¾æƒ³æ˜ç™½ã€‚</strong></p>
<p>ä»æœ¬ä¾‹å¯ä»¥çœ‹å‡ºï¼Œå³ä½¿æ˜¯ç®€å•çš„å˜é‡è‡ªåŠ æ“ä½œï¼Œå¤šçº¿ç¨‹æ“ä½œæ—¶ä¹Ÿè¦åšåŒæ­¥ï¼Œå¯ä»¥åŠ é”ï¼Œå¯ä»¥ä½¿ç”¨**<em>ç³»ç»Ÿçš„åŸå­é”Interlockedç³»åˆ—å‡½æ•°</em>**ï¼Œæ¯”å¦‚åŸå­è‡ªåŠ å‡½æ•°InterlockedIncrementå’ŒåŸå­è‡ªå‡å‡½æ•°InterlockedDecrementï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LONG <span class="title">InterlockedIncrement</span><span class="params">(  </span></span></span><br><span class="line"><span class="params"><span class="function">    LPLONG <span class="keyword">volatile</span> lpAddend   <span class="comment">// variable to increment</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br><span class="line"> </span><br><span class="line"><span class="function">LONG <span class="title">InterlockedDecrement</span><span class="params">(  </span></span></span><br><span class="line"><span class="params"><span class="function">    LPLONG <span class="keyword">volatile</span> lpAddend   <span class="comment">// variable address</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure>

<p>è¿™äº›åŸå­å‡½æ•°èƒ½ä¿è¯ä¼šè¢«åŸå­åœ°è¢«æ‰§è¡Œï¼Œä¸­é—´ä¸ä¼šè¢«æ‰“æ–­ã€‚ ä¿®æ”¹åçš„ä»£ç ä¸ºï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// define a global variable</span></span><br><span class="line"><span class="type">long</span> g_x = <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line"><span class="function">DWORD WINAPI <span class="title">ThreadFunc1</span><span class="params">(PVOID pvParam)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    InterlockedIncrementï¼ˆ&amp;g_xï¼‰;  <span class="comment">// è°ƒç”¨åŸå­é”å‡½æ•°InterlockedIncrementå®ç°è‡ªåŠ </span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function">DWORD WINAPI <span class="title">ThreadFunc2</span><span class="params">(PVOID pvParam)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    InterlockedIncrementï¼ˆ&amp;g_xï¼‰;  <span class="comment">// è°ƒç”¨åŸå­é”å‡½æ•°InterlockedIncrementå®ç°è‡ªåŠ </span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="4ã€è°ƒç”¨TerminateThreadå¼ºåˆ¶ç»“æŸçº¿ç¨‹ä¼šå¯¼è‡´çº¿ç¨‹ä¸­çš„èµ„æºæ²¡æœ‰é‡Šæ”¾çš„é—®é¢˜"><a href="#4ã€è°ƒç”¨TerminateThreadå¼ºåˆ¶ç»“æŸçº¿ç¨‹ä¼šå¯¼è‡´çº¿ç¨‹ä¸­çš„èµ„æºæ²¡æœ‰é‡Šæ”¾çš„é—®é¢˜" class="headerlink" title="4ã€è°ƒç”¨TerminateThreadå¼ºåˆ¶ç»“æŸçº¿ç¨‹ä¼šå¯¼è‡´çº¿ç¨‹ä¸­çš„èµ„æºæ²¡æœ‰é‡Šæ”¾çš„é—®é¢˜"></a>4ã€è°ƒç”¨TerminateThreadå¼ºåˆ¶ç»“æŸçº¿ç¨‹ä¼šå¯¼è‡´çº¿ç¨‹ä¸­çš„èµ„æºæ²¡æœ‰é‡Šæ”¾çš„é—®é¢˜</h3><p><strong>åœ¨**<strong>6.5èŠ‚</strong></strong>ï¼ˆç»ˆæ­¢è¿è¡Œçº¿ç¨‹ï¼‰ä¸­è®²åˆ°äº†è°ƒç”¨TerminateThreadç»“æŸçº¿ç¨‹çš„ç›¸å…³é—®é¢˜ã€‚</p>
<p>åˆ›å»ºçº¿ç¨‹æ—¶éœ€è¦æŒ‡å®šçº¿ç¨‹å‡½æ•°ï¼Œå½“ä»£ç æ‰§è¡Œåˆ°çº¿ç¨‹å‡½æ•°ä¸­ï¼Œçº¿ç¨‹æ‰çœŸæ­£è¿è¡Œèµ·æ¥ã€‚çº¿ç¨‹å‡½æ•°æ‰§è¡Œå®Œäº†ï¼Œçº¿ç¨‹å‡½æ•°é€€å‡ºäº†ï¼Œçº¿ç¨‹ä¹Ÿå°±é€€å‡ºäº†ã€‚çº¿ç¨‹ç»“æŸäº†ï¼Œå¯èƒ½æ˜¯çº¿ç¨‹å‡½æ•°è‡ªç„¶æ‰§è¡Œå®Œæˆäº†ï¼Œä¹Ÿå¯èƒ½æ˜¯äººä¸ºåœ°è°ƒç”¨TerminateThreadæ¥å£å¼ºåˆ¶å°†è¿›ç¨‹é€€å‡ºäº†ã€‚</p>
<p>å½“çº¿ç¨‹å‡½æ•°è‡ªç„¶åœ°æ‰§è¡Œå®Œé€€å‡ºæ—¶ï¼Œå‡½æ•°ä¸­å±€éƒ¨å˜é‡çš„æ ˆå†…å­˜ä¼šè‡ªåŠ¨è¢«é‡Šæ”¾ï¼Œå‡½æ•°ä¸­çš„èµ„æºæ‰ä¼šè‡ªåŠ¨åœ°è¢«é‡Šæ”¾ã€‚å¦‚æœçº¿ç¨‹å‡½æ•°æ‰§è¡Œçš„è¿‡ç¨‹ä¸­è¢«TerminateThreadå‡½æ•°å¼ºè¡Œç»ˆæ­¢äº†ï¼Œåˆ™ä¼šå¯¼è‡´å‡½æ•°ä¸­çš„èµ„æºä¸ä¼šè¢«é‡Šæ”¾ï¼Œæ¯”å¦‚ï¼š</p>
<blockquote>
<p><strong>1ï¼‰çº¿ç¨‹å‡½æ•°ä¸­å±€éƒ¨å˜é‡çš„æ ˆå†…å­˜æ²¡æœ‰é‡Šæ”¾</strong><br>å‡½æ•°æ²¡æœ‰æ­£å¸¸åœ°æ‰§è¡Œå®Œæˆï¼Œå‡½æ•°ä¸­å±€éƒ¨å˜é‡å ç”¨çš„æ ˆå†…å­˜æ²¡æœ‰é‡Šæ”¾ã€‚<br><strong>2ï¼‰çº¿ç¨‹å‡½æ•°ä¸­ç”³è¯·çš„èµ„æºæ²¡æœ‰é‡Šæ”¾</strong></p>
<p>æ¯”å¦‚çº¿ç¨‹å‡½æ•°ä¸­åˆšæ‹¿åˆ°ä¸€ä¸ªé”ï¼Œå°±è¢«å¼ºè¡Œç»ˆæ­¢äº†ï¼Œé‡Šæ”¾é”çš„ä»£ç æ²¡æœ‰æ‰§è¡Œåˆ°ï¼Œå¯¼è‡´çº¿ç¨‹ç»“æŸäº†é”ä¹Ÿæ²¡è¢«é‡Šæ”¾æ‰ã€‚æœ‰æ¬¡æˆ‘ä»¬åœ¨ç”¨Windbgæ’æŸ¥å¤šçº¿ç¨‹æ­»é”é—®é¢˜æ—¶ï¼Œä¸€ä¸ªçº¿ç¨‹åœ¨ç”³è¯·é”ï¼Œä½†é€šè¿‡æŸ¥çœ‹é”ä¿¡æ¯å¾—çŸ¥è¯¥é”è¢«å¦ä¸€ä¸ªçº¿ç¨‹å ç”¨ç€ï¼Œä½†æˆ‘ä»¬æŸ¥çœ‹è¿›ç¨‹çš„çº¿ç¨‹åˆ—è¡¨æ—¶å¹¶æ²¡æœ‰æ‰¾åˆ°å ç”¨é”çš„é‚£ä¸ªçº¿ç¨‹idï¼Œä¼°è®¡çº¿ç¨‹å·²ç»ç»“æŸäº†ï¼Œå¯èƒ½å°±æ˜¯å› ä¸ºè¯¥çº¿ç¨‹ä¸­é€”è¢«Terminateæ‰äº†ï¼Œè¿˜æ²¡å°†é”é‡Šæ”¾æ‰ï¼Œçº¿ç¨‹å°±è¢«ç»ˆæ­¢äº†ï¼Œæ‰€ä»¥å‡ºç°äº†è¿™ä¸ªé—®é¢˜ã€‚</p>
</blockquote>
<p>æ­¤å¤–ï¼Œçº¿ç¨‹ç»ˆæ­¢ä¸è¿›ç¨‹ç»ˆæ­¢æ˜¯æœ‰åŒºåˆ«çš„ï¼Œçº¿ç¨‹è¢«å¼ºè¡Œç»ˆæ­¢æ—¶ç³»ç»Ÿä¸ä¼šå»é‡Šæ”¾çº¿ç¨‹ä¸­çš„èµ„æºï¼Œä½†è¿›ç¨‹ç»ˆæ­¢æ—¶ç³»ç»Ÿä¼šé‡Šæ”¾è¿›ç¨‹æ‰€æœ‰çš„èµ„æºã€‚</p>
<h3 id="5ã€è°ƒç”¨WaitForSingleObjectç›‘æµ‹ç›®æ ‡ç¨‹åºæœ‰æ²¡æœ‰é€€å‡º"><a href="#5ã€è°ƒç”¨WaitForSingleObjectç›‘æµ‹ç›®æ ‡ç¨‹åºæœ‰æ²¡æœ‰é€€å‡º" class="headerlink" title="5ã€è°ƒç”¨WaitForSingleObjectç›‘æµ‹ç›®æ ‡ç¨‹åºæœ‰æ²¡æœ‰é€€å‡º"></a>5ã€è°ƒç”¨WaitForSingleObjectç›‘æµ‹ç›®æ ‡ç¨‹åºæœ‰æ²¡æœ‰é€€å‡º</h3><p><strong>åœ¨**<strong>4.4èŠ‚</strong></strong>ï¼ˆå­è¿›ç¨‹ï¼‰ä¸­è®²åˆ°äº†å¯ä»¥é€šè¿‡WaitForSingleObjectç›‘æµ‹ç›®æ ‡ç¨‹åºæœ‰æ²¡æœ‰é€€å‡º**ã€‚</p>
<h4 id="5-1ã€WaitForSingleObjectå‡½æ•°è¯´æ˜"><a href="#5-1ã€WaitForSingleObjectå‡½æ•°è¯´æ˜" class="headerlink" title="5.1ã€WaitForSingleObjectå‡½æ•°è¯´æ˜"></a>5.1ã€WaitForSingleObjectå‡½æ•°è¯´æ˜</h4><p>WaitForSingleObject å‡½æ•°å¯ä»¥ç­‰å¾…ä»¥ä¸‹å¯¹è±¡ï¼š</p>
<blockquote>
<ul>
<li>æ›´æ”¹é€šçŸ¥</li>
<li>æ§åˆ¶å°è¾“å…¥</li>
<li>å¯ç­‰å¾…è®¡æ—¶å™¨</li>
<li>å†…å­˜èµ„æºé€šçŸ¥</li>
<li>äº‹ä»¶ï¼ˆEventï¼‰</li>
<li>äº’æ–¥é‡ï¼ˆMutexï¼‰</li>
<li>ä¿¡å·é‡ï¼ˆSemaphoreï¼‰</li>
<li>çº¿ç¨‹</li>
<li>è¿›ç¨‹</li>
</ul>
</blockquote>
<p>å½“ç­‰å¾…å¯¹è±¡ä»éè§¦å‘çŠ¶æ€å˜æˆè§¦å‘çŠ¶æ€ï¼ˆå‘å‡ºä¿¡å·ï¼‰ï¼ŒÂ WaitForSingleObjectå°±ä¼šè¿”å›ï¼›æˆ–è€…æ˜¯ç­‰å¾…æ—¶é—´è¶…æ—¶ï¼ŒWaitForSingleObjectä¹Ÿä¼šè¿”å›ã€‚å…³äºWaitForSingleObjectçš„è¿”å›å€¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/4ca27a6a6386f0ab56a89ae71dc7af08.png"></p>
<p><strong>å¯¹äºäº‹ä»¶</strong>ï¼Œåˆ†æœ‰ä¿¡å·å’Œæ— ä¿¡å·ä¸¤ä¸ªçŠ¶æ€ï¼Œå½“äº‹ä»¶å¯¹è±¡ç¼–ç¨‹æœ‰ä¿¡å·æ—¶ï¼ŒWaitForSingleObjectç«‹å³è¿”å›ã€‚</p>
<p><strong>å¯¹äºäº’æ–¥é‡å’Œä¿¡å·é‡</strong>ï¼Œè°ƒç”¨WaitForSingleObjectè·å–æ‰€æœ‰æƒï¼Œå³WaitForSingleObjectè¿”å›WAIT_OBJECT_0æ—¶è·å–ä»–ä»¬çš„æ‰€æœ‰æƒï¼Œç„¶åè°ƒç”¨ReleaseMutexå’ŒReleaseSemaphoreé‡Šæ”¾å¯¹è±¡çš„æ‰€æœ‰æƒã€‚</p>
<p><strong>å¯¹äºçº¿ç¨‹å’Œè¿›ç¨‹</strong>ï¼Œçº¿ç¨‹å’Œè¿›ç¨‹åˆ›å»ºæ—¶æ— ä¿¡å·ï¼Œå½“çº¿ç¨‹å’Œè¿›ç¨‹é€€å‡ºæ—¶å¯¹åº”çš„å¥æŸ„å°±å˜æˆäº†æœ‰ä¿¡å·ï¼Œè¿™æ ·WaitForSingleObjectå°±è¿”å›äº†ã€‚å¯ä»¥é€šè¿‡WaitForSingleObjectè¿”å›ï¼Œåˆ¤æ–­çº¿ç¨‹æˆ–è¿›ç¨‹æ˜¯å¦å·²ç»é€€å‡ºäº†ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">WaitForSingleObject</span>(hThread, INFINITE); <span class="comment">// å‚æ•°INFINITEè¡¨ç¤ºæ— é™ç­‰å¾…</span></span><br></pre></td></tr></table></figure>

<h4 id="5-2ã€è°ƒç”¨WaitForSingleObjectå‡½æ•°ç›‘æµ‹çº¿ç¨‹æˆ–è¿›ç¨‹æ˜¯å¦å·²ç»é€€å‡º"><a href="#5-2ã€è°ƒç”¨WaitForSingleObjectå‡½æ•°ç›‘æµ‹çº¿ç¨‹æˆ–è¿›ç¨‹æ˜¯å¦å·²ç»é€€å‡º" class="headerlink" title="5.2ã€è°ƒç”¨WaitForSingleObjectå‡½æ•°ç›‘æµ‹çº¿ç¨‹æˆ–è¿›ç¨‹æ˜¯å¦å·²ç»é€€å‡º"></a>5.2ã€è°ƒç”¨WaitForSingleObjectå‡½æ•°ç›‘æµ‹çº¿ç¨‹æˆ–è¿›ç¨‹æ˜¯å¦å·²ç»é€€å‡º</h4><p><img src="https://i-blog.csdnimg.cn/blog_migrate/b392410ee9bc28d119582005ec4fcf44.png"></p>
<p>åœ¨ä¸»ç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ä¸­å¯åŠ¨äº†ä¸€ä¸ªå­è¿›ç¨‹ï¼Œæœ‰æ—¶ä¸»è¿›ç¨‹è¦ç­‰å¾…å­è¿›ç¨‹å¤„ç†ç»“æœåæ ¹æ®è¿”å›çš„ä¿¡æ¯å†æ§åˆ¶åç»­ä»£ç çš„æ‰§è¡Œï¼Œæœ‰æ—¶å­è¿›ç¨‹éœ€è¦æ„ŸçŸ¥ä¸»è¿›ç¨‹æ˜¯å¦å·²ç»é€€å‡ºï¼Œè¿™ä¸¤ç§æƒ…å†µéƒ½éœ€è¦æ„ŸçŸ¥å¦ä¸€ä¸ªè¿›ç¨‹æ˜¯å¦å·²ç»é€€å‡ºã€‚å¯¹äºçº¿ç¨‹åœ¨æŸäº›åœºåˆä¸‹é¡µå­˜åœ¨ç±»ä¼¼çš„éœ€æ±‚ã€‚</p>
<h5 id="5-2-1ã€å­è¿›ç¨‹å®æ—¶ç›‘æµ‹ä¸»è¿›ç¨‹æ˜¯å¦å·²ç»é€€å‡ºï¼Œä¸»è¿›ç¨‹é€€å‡ºäº†ï¼Œåˆ™å­è¿›ç¨‹è¦è‡ªåŠ¨é€€å‡º"><a href="#5-2-1ã€å­è¿›ç¨‹å®æ—¶ç›‘æµ‹ä¸»è¿›ç¨‹æ˜¯å¦å·²ç»é€€å‡ºï¼Œä¸»è¿›ç¨‹é€€å‡ºäº†ï¼Œåˆ™å­è¿›ç¨‹è¦è‡ªåŠ¨é€€å‡º" class="headerlink" title="5.2.1ã€å­è¿›ç¨‹å®æ—¶ç›‘æµ‹ä¸»è¿›ç¨‹æ˜¯å¦å·²ç»é€€å‡ºï¼Œä¸»è¿›ç¨‹é€€å‡ºäº†ï¼Œåˆ™å­è¿›ç¨‹è¦è‡ªåŠ¨é€€å‡º"></a>5.2.1ã€å­è¿›ç¨‹å®æ—¶ç›‘æµ‹ä¸»è¿›ç¨‹æ˜¯å¦å·²ç»é€€å‡ºï¼Œä¸»è¿›ç¨‹é€€å‡ºäº†ï¼Œåˆ™å­è¿›ç¨‹è¦è‡ªåŠ¨é€€å‡º</h5><p>ä¸»è¿›ç¨‹åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å¯åŠ¨äº†ä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¯åŠ¨å­è¿›ç¨‹æ—¶å°†ä¸»è¿›ç¨‹çš„è¿›ç¨‹idä¼ ç»™å­è¿›ç¨‹ã€‚å­è¿›ç¨‹æ˜¯ä¾èµ–äºä¸»è¿›ç¨‹å­˜æ´»çš„ï¼Œå¦‚æœä¸»è¿›ç¨‹é€€å‡ºæˆ–è€…å´©æºƒäº†ï¼Œåˆ™å­è¿›ç¨‹å°±æ²¡æœ‰å­˜åœ¨çš„æ„ä¹‰äº†ï¼Œè¦è‡ªåŠ¨é€€å‡ºï¼æ‰€ä»¥å­è¿›ç¨‹è¦å®æ—¶ç›‘æµ‹ä¸»è¿›ç¨‹çš„çŠ¶æ€ï¼Œç›‘æµ‹ä¸»è¿›ç¨‹æœ‰æ²¡æœ‰é€€å‡ºï¼ˆåŒ…æ‹¬å´©æºƒé—ªé€€ï¼‰ã€‚</p>
<p>å¯èƒ½æœ‰äººä¼šè¯´ï¼Œä¸»è¿›ç¨‹å¯ä»¥åœ¨é€€å‡ºæ—¶é€šçŸ¥å­è¿›ç¨‹ï¼Œå­è¿›ç¨‹æ”¶åˆ°é€šçŸ¥åå†è‡ªè¡Œé€€å‡ºã€‚<strong>ä½†ä¸»è¿›ç¨‹å¯èƒ½ä¼šå‘ç”Ÿå´©æºƒæˆ–é—ªé€€ï¼Œè¿™ç§æƒ…å†µä¸‹ä¸€èˆ¬æ—¶æ²¡æ³•é€šçŸ¥å­è¿›ç¨‹çš„ã€‚</strong></p>
<p>é‚£å­è¿›ç¨‹å¦‚ä½•æ‰èƒ½å®æ—¶ç›‘æµ‹ä¸»è¿›ç¨‹æ˜¯å¦é€€å‡ºäº†å‘¢ï¼Ÿä¸ç®¡æ˜¯ä¸»è¿›ç¨‹æ­£å¸¸é€€å‡ºï¼Œè¿˜æ˜¯å¼‚å¸¸å´©æºƒé—ªé€€ï¼Œéƒ½è¦æ„ŸçŸ¥åˆ°ã€‚å­è¿›ç¨‹å¯ä»¥å¯åŠ¨ä¸€ä¸ªå­çº¿ç¨‹ï¼Œåœ¨å­çº¿ç¨‹ä¸­é€šè¿‡ä¸»è¿›ç¨‹ä¼ è¿‡æ¥çš„ä¸»è¿›ç¨‹idï¼Œè·å–ä¸»è¿›ç¨‹å¥æŸ„ï¼Œç„¶åè°ƒç”¨WaitForSingleObjectç­‰å¾…ä¸»è¿›ç¨‹é€€å‡ºï¼Œå¯ä»¥åœ¨å­çº¿ç¨‹ä¸­æ— é™ç­‰å¾…ã€‚å¦‚æœä¸»è¿›ç¨‹ä¸€æ—¦é€€å‡ºï¼ŒWaitForSingleObjectå‡½æ•°å°±ä¼šç«‹å³è¿”å›ï¼Œè¿™æ—¶å­è¿›ç¨‹å°±å¯ä»¥è°ƒç”¨ExitProcessç­‰æ¥å£è‡ªè¡Œé€€å‡ºå½“å‰å­è¿›ç¨‹äº†ã€‚</p>
<p>å…·ä½“çš„ä»£ç å®ç°æ˜¯ï¼Œå­è¿›ç¨‹ä¸­å¯åŠ¨ä¸€ä¸ªå­çº¿ç¨‹ï¼Œå°†ä¸»è¿›ç¨‹ä¼ è¿‡æ¥çš„ä¸»è¿›ç¨‹idä¼ ç»™è¯¥å­çº¿ç¨‹ï¼Œå¦‚ä¸‹ï¼šï¼ˆå…¶ä¸­MonitorMainProcessæ˜¯çº¿ç¨‹å‡½æ•°ï¼‰</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">HANDLE hThread = (HANDLE)_beginthreadex( <span class="literal">NULL</span>, <span class="number">0</span>, MonitorMainProcess, (<span class="type">void</span>*)dwMainProcessId, <span class="number">0</span>, <span class="literal">NULL</span> );</span><br><span class="line"><span class="keyword">if</span> ( hThread != <span class="literal">NULL</span> )</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CloseHandle</span>( hThread );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>çº¿ç¨‹å‡½æ•°MonitorMainProcesså®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç›‘æ§ä¸»å·¥ç¨‹</span></span><br><span class="line"><span class="function"><span class="type">unsigned</span> __stdcall <span class="title">MonitorMainProcess</span><span class="params">(<span class="type">void</span> * pParam )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    DWORD dwProcessId = (DWORD)pParam;</span><br><span class="line">    HANDLE hProcess = <span class="built_in">OpenProcess</span>( SYNCHRONIZE, FALSE, dwProcessId );</span><br><span class="line">    <span class="keyword">if</span>(hProcess == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">ExitProcess</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// è®¾ç½®INFINITEæ— é™ç­‰å¾…</span></span><br><span class="line">    <span class="built_in">WaitForSingleObject</span>( hProcess, INFINITE );</span><br><span class="line">    <span class="built_in">CloseHandle</span>( hProcess );</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// WaitForSingleObjectè¿”å›äº†ï¼Œå°±è¡¨ç¤ºä¸»è¿›ç¨‹å·²ç»é€€å‡ºï¼Œç›´æ¥é€€å‡ºæœ¬è¿›ç¨‹</span></span><br><span class="line">    <span class="built_in">ExitProcess</span>( <span class="number">-1</span> );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>è¿›ç¨‹åˆå§‹æ˜¯æ— ä¿¡å·çš„ï¼Œè¿›ç¨‹é€€å‡ºæ—¶å°±å˜æˆäº†æœ‰ä¿¡å·ï¼Œè¿™æ ·WaitForSingleObjectç­‰å¾…åˆ°ä¿¡å·åï¼Œå°±è¿”å›äº†ï¼Œè¿™æ ·å­è¿›ç¨‹å°±ç›´åˆ°ä¸»è¿›ç¨‹é€€å‡ºäº†ã€‚</p>
<p>æ­¤å¤„éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œè°ƒç”¨OpenProcessæ—¶å¿…é¡»è¦è®¾ç½®SYNCHRONIZEå‚æ•°ï¼Œå› ä¸ºè®¾ç½®è¯¥æ ‡è®°å‚æ•°åæ‰èƒ½è°ƒç”¨WaitForSingleObjectå»ç­‰å¾…è¿›ç¨‹ã€‚å¾®è½¯MSDNä¸Šå¯¹SYNCHRONIZEå¦‚ä¸‹ï¼š</p>
<blockquote>
<p><strong>SYNCHRONIZE</strong>ï¼šThe right to use the object for synchronization. This enables a thread to wait until the object is in the signaled state.</p>
</blockquote>
<p>æ­¤å¤–ï¼Œç›‘æµ‹ä¸»è¿›ç¨‹æ˜¯å¦é€€å‡ºçš„ä»£ç æ˜¯é˜»å¡å¼çš„ï¼Œä¸èƒ½æ”¾åœ¨ä¸»çº¿ç¨‹ä¸­çš„ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¦å¯åŠ¨ä¸€ä¸ªå­çº¿ç¨‹å»ä¸“é—¨åšè¿™ä¸ªç›‘æµ‹ä»»åŠ¡çš„åŸå› ã€‚</p>
<h5 id="5-2-2ã€å¯åŠ¨å­è¿›ç¨‹åç­‰å¾…å­è¿›ç¨‹æ‰§è¡Œå®Œé€€å‡ºåï¼Œå†æ‰§è¡Œåç»­æ“ä½œ"><a href="#5-2-2ã€å¯åŠ¨å­è¿›ç¨‹åç­‰å¾…å­è¿›ç¨‹æ‰§è¡Œå®Œé€€å‡ºåï¼Œå†æ‰§è¡Œåç»­æ“ä½œ" class="headerlink" title="5.2.2ã€å¯åŠ¨å­è¿›ç¨‹åç­‰å¾…å­è¿›ç¨‹æ‰§è¡Œå®Œé€€å‡ºåï¼Œå†æ‰§è¡Œåç»­æ“ä½œ"></a>5.2.2ã€å¯åŠ¨å­è¿›ç¨‹åç­‰å¾…å­è¿›ç¨‹æ‰§è¡Œå®Œé€€å‡ºåï¼Œå†æ‰§è¡Œåç»­æ“ä½œ</h5><p>æœ‰æ—¶æˆ‘ä»¬éœ€è¦å¯åŠ¨ä¸€ä¸ªå­è¿›ç¨‹å»å®ŒæˆæŸé¡¹æ“ä½œï¼Œä¸»è¿›ç¨‹åœ¨ç­‰å¾…å­è¿›ç¨‹çš„æ‰§è¡Œç»“æœï¼ˆéœ€è¦è·å–å­è¿›ç¨‹çš„æ‰§è¡Œæ•°æ®ï¼‰ï¼Œ ç„¶åä¸»è¿›ç¨‹å†å»æ‰§è¡Œåç»­æ“ä½œã€‚ä¸»è¿›ç¨‹åœ¨å¯åŠ¨å­è¿›ç¨‹åï¼Œå°±å¯ä»¥è°ƒç”¨WaitForSingleObjectç­‰å¾…å­è¿›ç¨‹é€€å‡ºï¼Œæ¯”å¦‚å¦‚ä¸‹çš„ä»£ç ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯åŠ¨ä¸€ä¸ªå­è¿›ç¨‹å»æ‰§è¡Œä¸€ä¸ªæ“ä½œä»»åŠ¡</span></span><br><span class="line">STARTUPINFO s  = &#123;<span class="built_in">sizeof</span>(s)&#125;; </span><br><span class="line">PROCESS_INFORMATION   pi = &#123;<span class="number">0</span>&#125;;   </span><br><span class="line"><span class="keyword">if</span>( <span class="built_in">CreateProcess</span>( <span class="literal">NULL</span>, cmdLine, <span class="literal">NULL</span>, <span class="literal">NULL</span>, TRUE, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, &amp;s, &amp;pi ) )</span><br><span class="line">&#123;   </span><br><span class="line">    <span class="comment">// ç­‰å¾…è¿›ç¨‹æ‰§è¡Œå®Œæ¯•   </span></span><br><span class="line">    <span class="built_in">WaitForSingleObject</span>( pi.hProcess, INFINITE );   </span><br><span class="line"> </span><br><span class="line">    <span class="comment">// å…³é—­è¿›ç¨‹å’Œä¸»çº¿ç¨‹å¥æŸ„</span></span><br><span class="line">    <span class="built_in">CloseHandle</span>( pi.hProcess );   </span><br><span class="line">    <span class="built_in">CloseHandle</span>( pi.hThread );   </span><br><span class="line">&#125;  </span><br><span class="line"> </span><br><span class="line"><span class="comment">// ...  // å»æ‹¿å­è¿›ç¨‹çš„æ‰§è¡Œç»“æœï¼Œå»æ‰§è¡Œåç»­æ“ä½œ</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æœ‰æ—¶å¯åŠ¨ä¸€ä¸ªå­çº¿ç¨‹ï¼Œè¦ç­‰å­çº¿ç¨‹æ‰§è¡Œå®Œé€€å‡ºåï¼Œæ ¹æ®å¤„ç†ç»“æœä¿¡æ¯å»ç»§ç»­æ‰§è¡Œï¼Œå’Œä¸Šé¢ç­‰å¾…è¿›ç¨‹é€€å‡ºæ˜¯ç±»ä¼¼çš„ã€‚</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/05/26/debug/%E4%BE%8B%E5%AD%90/Windows%20UAC%E6%9D%83%E9%99%90%E8%AF%A6%E8%A7%A3%E4%BB%A5%E5%8F%8Awindbg%E6%9D%83%E9%99%90%E9%97%AE%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/05/26/debug/%E4%BE%8B%E5%AD%90/Windows%20UAC%E6%9D%83%E9%99%90%E8%AF%A6%E8%A7%A3%E4%BB%A5%E5%8F%8Awindbg%E6%9D%83%E9%99%90%E9%97%AE%E9%A2%98/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2025-05-26 22:32:50 / Modified: 23:05:07" itemprop="dateCreated datePublished" datetime="2025-05-26T22:32:50+08:00">2025-05-26</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="1ã€ä»€ä¹ˆæ˜¯UACï¼Ÿ"><a href="#1ã€ä»€ä¹ˆæ˜¯UACï¼Ÿ" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯UACï¼Ÿ"></a>1ã€ä»€ä¹ˆæ˜¯<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=UAC&spm=1001.2101.3001.7020">UAC</a>ï¼Ÿ</h3><p><strong>UACï¼ˆUser Account Controlï¼‰ï¼Œç”¨æˆ·å¸æˆ·æ§åˆ¶ï¼Œæ˜¯å¾®è½¯ä»Windows Vistaå¼€å§‹å¼•å…¥çš„ä¸€ç§æ–°çš„æ§åˆ¶æœºåˆ¶</strong>ï¼Œå…¶åŸç†æ˜¯é€šçŸ¥ç”¨æˆ·æ˜¯å¦å¯¹åº”ç”¨ç¨‹åºä½¿ç”¨ç¡¬ç›˜é©±åŠ¨å™¨å’Œç³»ç»Ÿæ–‡ä»¶æˆæƒï¼Œä»¥è¾¾åˆ°é˜»æ­¢æ¶æ„ç¨‹åºï¼ˆæœ‰æ—¶ä¹Ÿç§°ä¸ºâ€œæ¶æ„è½¯ä»¶â€ï¼‰æŸåç³»ç»Ÿçš„ç›®çš„ã€‚</p>
<blockquote>
<p>UACç”¨æˆ·è´¦æˆ·æ§åˆ¶æœºåˆ¶ä¸»è¦æ˜¯æƒé™éš”ç¦»ï¼Œé˜²æ­¢ä½æƒé™ã€ä½å®‰å…¨çš„åº”ç”¨è·å–ç³»ç»Ÿé«˜ç­‰çº§æƒé™ã€‚ç³»ç»Ÿå¼¹å‡ºUACæç¤ºæ¡†ï¼Œè®©ç”¨æˆ·ç¡®è®¤æ˜¯å¦ä¿¡ä»»ã€æ˜¯å¦ä»¥ç®¡ç†å‘˜æƒé™è¿è¡ŒæœªçŸ¥ã€æœªç­¾ååº”ç”¨ã€‚</p>
</blockquote>
<p>å½“è¿è¡Œä¸€äº›ä¼šå½±å“ç³»ç»Ÿå®‰å…¨çš„ç¨‹åºæ—¶ï¼Œä¼šè‡ªåŠ¨è§¦å‘UACï¼Œç”¨æˆ·ç¡®è®¤åç¨‹åºæ‰èƒ½è¿è¡Œã€‚æ¯”å¦‚å½“ä½ è¿è¡Œä¸€ä¸ªå®‰è£…ç¨‹åºï¼ˆä¸€èˆ¬ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œï¼‰æˆ–è€…æ‰“å¼€ä¸€ä¸ªæœªç»éªŒè¯çš„ç¨‹åºæ—¶ï¼Œå°±ä¼šå¼¹å‡ºç±»ä¼¼å¦‚ä¸‹çš„UACæç¤ºæ¡†ï¼šï¼ˆä»¥åœ¨Win10ç³»ç»Ÿä¸­åŒå‡»éœ€è¦ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œçš„QQå®‰è£…åŒ…ç¨‹åºä¸ºä¾‹ï¼‰</p>
<p><img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202505262255020.png" alt="image.png"></p>
<p>ç”¨æˆ·ç¡®è®¤åç¨‹åºæ‰èƒ½ç»§ç»­è¿è¡Œã€‚</p>
<p>è¿™ä¸ªå¼¹æ¡†æ˜¯æç¤ºç”¨æˆ·ç¨‹åºå¯èƒ½ä¼šå¯¹å½“å‰è®¡ç®—æœºè¿›è¡Œä¿®æ”¹ï¼Œä½†è¿™ä¸ªæç¤ºå¯¹å¯¹ç»å¤§éƒ¨åˆ†ç”¨æˆ·æ¥è¯´ï¼Œå¥½åƒå¹¶æ²¡æœ‰ä»€ä¹ˆç”¨ã€‚å¯¹æ™®é€šç”¨æˆ·è€Œè¨€ï¼Œä¸ä½†æ²¡ä»€ä¹ˆç”¨ï¼Œåè€Œä¼šå¸¦æ¥å›°æ‰°ï¼ˆåˆ°åº•æ˜¯è¯¥å…è®¸å‘¢ï¼Ÿè¿˜æ˜¯ä¸å…è®¸å‘¢ï¼Ÿï¼‰ã€‚å¹¶ä¸”è€æ˜¯æ—¶ä¸æ—¶åœ°å¼¹æ¡†ï¼Œç”¨æˆ·ä¹Ÿå¾ˆåŒçƒ¦ï¼</p>
<p>ç¨å¾®ä¸“ä¸šçš„ç”¨æˆ·ï¼Œå¯èƒ½ä¼šå°†UACé€šçŸ¥å…³é—­æ‰ã€‚å…·ä½“æ–¹æ³•æ˜¯ï¼Œæ‰“å¼€æ§åˆ¶é¢æ¿ï¼Œç„¶åç‚¹å‡»â€œç”¨æˆ·è´¦æˆ·â€ï¼Œè¿›å…¥ç”¨æˆ·è´¦æˆ·è®¾ç½®é¡µé¢ï¼š<br>Â  Â  Â  Â <br><img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202505262255546.png" alt="image.png"></p>
<p>ç„¶åç‚¹å‡»â€œæ›´æ”¹ç”¨æˆ·è´¦æˆ·æ§åˆ¶è®¾ç½®â€ï¼Œåˆ°å¦‚ä¸‹çš„é¡µé¢ä¸­ï¼š</p>
<p><img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202505262255909.png" alt="image.png"></p>
<p>å°†æ»šåŠ¨æ¡æ‹‰åˆ°åº•ï¼Œå°±å¯ä»¥å°†UACé€šçŸ¥å…³é—­æ‰ã€‚å…³é—­åï¼Œå°±ä¸ä¼šå†å¼¹UACæç¤ºæ¡†äº†ã€‚</p>
<p>æ—¢ç„¶å¤§å®¶éƒ½ä¸å–œæ¬¢UACæç¤ºæ¡†ï¼Œå¾®è½¯ä¸ºä»€ä¹ˆè¿˜è¦è®¾è®¡å‡ºè¿™æ ·ä¸€ä¸ªåˆ«è„šçš„ä¸œè¥¿æ¥å‘¢ï¼Ÿ</p>
<h3 id="2ã€å¾®è½¯ä¸ºä»€ä¹ˆè¦è®¾è®¡UACï¼Ÿ"><a href="#2ã€å¾®è½¯ä¸ºä»€ä¹ˆè¦è®¾è®¡UACï¼Ÿ" class="headerlink" title="2ã€å¾®è½¯ä¸ºä»€ä¹ˆè¦è®¾è®¡UACï¼Ÿ"></a>2ã€å¾®è½¯ä¸ºä»€ä¹ˆè¦è®¾è®¡UACï¼Ÿ</h3><p>å¾ˆå¤šäººéƒ½ç”¨è¿‡Windows XPï¼Œå¤§å¤šæ•°äººåœ¨ç”¨Windows XPæ—¶ï¼Œä½¿ç”¨çš„åº”è¯¥æ˜¯ç®¡ç†å‘˜æƒé™çš„è´¦æˆ·ã€‚è€Œåœ¨å¾®è½¯çš„è®¾æƒ³ä¸­ï¼Œæ™®é€šç”¨æˆ·éƒ½åº”è¯¥éƒ½ä½¿ç”¨æ ‡å‡†è´¦æˆ·ã€‚ä¸ºä»€ä¹ˆå¤§å®¶ä¸ç”¨æ ‡å‡†è´¦æˆ·ï¼ŸWindows XPé‡Œçš„æ ‡å‡†è´¦æˆ·ï¼Œå¯èƒ½è¿ç¨‹åºéƒ½æ²¡æ³•æ­£å¸¸å®‰è£…ï¼æ²¡æœ‰äººæ„¿æ„ä¸ºäº†è£…ä¸ªç¨‹åºï¼Œåˆ‡æ¢åˆ°ç®¡ç†å‘˜è´¦æˆ·ï¼Œè£…å®Œäº†å†åˆ‡æ¢å›æ ‡å‡†ç”¨æˆ·ã€‚</p>
<p>Â Â å½“ç„¶ï¼Œå¾®è½¯ä¹Ÿæ³¨æ„åˆ°äº†è¿™ä¸€ç‚¹ï¼Œäºæ˜¯å°±è®¾è®¡äº†UACç³»ç»Ÿã€‚UACä¸Windows XPçš„ç”¨æˆ·è´¦æˆ·æƒé™ç®¡ç†ï¼Œæœ€å¤§çš„ä¸åŒåœ¨äºï¼ŒUACå¯¹æƒé™çš„æ§åˆ¶å¾ˆæœ‰å¼¹æ€§ã€‚å®ƒé»˜è®¤æ‰€æœ‰ç¨‹åºéƒ½æ˜¯ä»¥æ ‡å‡†æƒé™è¿è¡Œçš„ï¼ˆæ— è®ºä½ ä½¿ç”¨çš„æ˜¯ç®¡ç†å‘˜è´¦æˆ·è¿˜æ˜¯æ ‡å‡†è´¦æˆ·ï¼‰ï¼Œè€Œå½“ä½ è¿è¡Œä¸€ä¸ªéœ€è¦ç®¡ç†å‘˜æƒé™è¿è¡Œçš„ç¨‹åºæ—¶ï¼ŒUACå°±ä¼šè·‘å‡ºæ¥é—®ä½ ï¼Œè¿™ä¸ªç¨‹åºéœ€è¦ç®¡ç†å‘˜æƒé™ï¼Œè¦ä¸è¦ç»§ç»­ï¼Œå¦‚ä¸‹ï¼š<br>Â Â <img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202505262256885.png" alt="image.png"></p>
<p>å¦‚æœä½ å…è®¸ï¼ŒUACå°±ä¼šæå‡æƒé™ï¼Œç”¨ç®¡ç†å‘˜æƒé™è¿è¡Œè¿™ä¸ªç¨‹åºã€‚</p>
<p>å…¶å®ä»UACçš„è®¾è®¡çš„æœ¬æ„ä¸Šæ¥çœ‹ï¼Œå®ƒå³é¿å…äº†ç›´æ¥ä½¿ç”¨ç®¡ç†å‘˜è´¦æˆ·å¯¼è‡´æƒé™æ§åˆ¶å½¢åŒè™šè®¾ï¼Œåˆè§£å†³äº†æ ‡å‡†ç”¨æˆ·éœ€è¦é¢‘ç¹åˆ‡æ¢åˆ°ç®¡ç†å‘˜è´¦æˆ·çš„é—®é¢˜ï¼ˆå¯èƒ½æ˜¯æ¨¡ä»¿Linuxç³»ç»Ÿä¸­çš„suæƒé™æå‡ï¼‰ã€‚</p>
<p>ä½†Windowsä¸‹çš„UACä¸€ç‚¹ä¹Ÿä¸æ™ºèƒ½ï¼Œè¿å¤åˆ¶æ–‡ä»¶ä¹‹ç±»çš„æ“ä½œï¼Œç”šè‡³éƒ½ä¼šè·‘è¿‡æ¥é—®ä½ ä¸€ä¸‹ï¼Œå¾ˆå¤šç”¨æˆ·ä¸åŒå…¶çƒ¦ï¼Œç›´æ¥æŠŠUACä¸€å…³äº†äº‹ã€‚å°½ç®¡Windowså¯¹UACåšäº†ä¸€äº›æ”¹å˜å’Œä¼˜åŒ–ï¼Œä½†UACè¿˜æ˜¯å¾ˆçƒ¦ã€‚æ¯”å¦‚ï¼Œä½ ç¬¬ä¸€æ¬¡æ‰“å¼€ä¸€ä¸ªéœ€è¦ç®¡ç†å‘˜æƒé™çš„ç¨‹åºï¼ŒUACä¼šå°½å¿ èŒå®ˆåœ°é—®ä½ æ˜¯å¦è¦æå‡æƒé™ï¼›ä½ ç¬¬äºŒæ¬¡æ‰“å¼€ï¼ŒUACè¿˜ä¼šå°½å¿ èŒå®ˆåœ°é—®ä½ æ˜¯å¦è¦æå‡æƒé™ï¼›ä½ ç¬¬ä¸‰æ¬¡æ‰“å¼€ï¼ŒUACè¿˜ä¼šå°½å¿ èŒå®ˆåœ°é—®ä½ æ˜¯å¦è¦æå‡æƒé™â€¦â€¦äºæ˜¯å¤§å®¶ä¸æ„¿æ„äº†ï¼ŒæŠŠUACä¸€å…³äº†ä¹‹ã€‚</p>
<h3 id="3ã€æ ‡å‡†ç”¨æˆ·æƒé™ä¸ç®¡ç†å‘˜æƒé™"><a href="#3ã€æ ‡å‡†ç”¨æˆ·æƒé™ä¸ç®¡ç†å‘˜æƒé™" class="headerlink" title="3ã€æ ‡å‡†ç”¨æˆ·æƒé™ä¸ç®¡ç†å‘˜æƒé™"></a>3ã€æ ‡å‡†<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90&spm=1001.2101.3001.7020">ç”¨æˆ·æƒé™</a>ä¸ç®¡ç†å‘˜æƒé™</h3><p>Windowsä»Vistaç³»ç»Ÿå¼€å§‹å°±å¼•å…¥äº†UACæƒé™æ§åˆ¶æœºåˆ¶ï¼Œå¼ºåŒ–äº†ç®¡ç†å‘˜æƒé™çš„æ¦‚å¿µï¼Œåšäº†æ›´ä¸¥æ ¼çš„æƒé™é™åˆ¶ä¸å®‰å…¨æ§åˆ¶ã€‚æ¯”å¦‚å¯¹ä¸€äº›æƒé™æ•æ„Ÿçš„è·¯å¾„ï¼Œæ¯”å¦‚C:\Program Filesã€C:\Windows\system32ï¼Œå¦‚æœè¦åœ¨è¿™äº›è·¯å¾„ä¸‹åˆ›å»ºæ–‡ä»¶ã€å‘æ–‡ä»¶ä¸­å†™æ•°æ®ï¼Œéƒ½æ˜¯éœ€è¦ç®¡ç†å‘˜æƒé™çš„ã€‚å†æ¯”å¦‚ï¼Œåœ¨Windowsç³»ç»Ÿçš„æ³¨å†Œè¡¨ä¸­ï¼Œå¦‚æœè¦å‘HKEY_LOCAL_MACHINEè·¯åŠ²ä¸‹å†™å…¥æˆ–ä¿®æ”¹å†…å®¹æ—¶ï¼Œä¹Ÿéœ€è¦ç®¡ç†å‘˜æƒé™çš„ã€‚</p>
<p>ç¨‹åºè¿è¡Œæƒé™ä¸»è¦æœ‰æ ‡å‡†ç”¨æˆ·æƒé™å’Œç®¡ç†å‘˜æƒé™ä¸¤ç§ã€‚æœ‰å¾ˆå¤šæ“ä½œï¼Œéƒ½éœ€è¦ç®¡ç†å‘˜æƒé™ï¼Œæ¯”å¦‚ï¼š</p>
<blockquote>
<p>1ï¼‰ç®¡ç†å‘˜æƒé™çš„ç¨‹åºæ‰èƒ½å‘ç³»ç»Ÿå®‰å…¨æ•æ„Ÿè·¯å¾„æ‰§è¡Œå†™æ“ä½œï¼Œæ¯”å¦‚åœ¨C:\Program Filesã€C:\Windows\system32ç­‰ç³»ç»Ÿè·¯å¾„ä¸­åˆ›å»ºæ–‡ä»¶ã€æ‹·è´æ–‡ä»¶ï¼Œå‘è¿™äº›è·¯å¾„ä¸‹çš„æ–‡ä»¶æ‰§è¡Œå†™æ“ä½œã€‚<br>2ï¼‰åªæœ‰ç®¡ç†å‘˜æƒé™çš„ç¨‹åºï¼Œæ‰èƒ½å‘ç³»ç»Ÿæ³¨å†Œè¡¨è·¯å¾„HKEY_LOCAL_MACHINEä¸‹æ‰§è¡Œåˆ›å»ºæˆ–å†™æ“ä½œã€‚æ²¡æœ‰ç®¡ç†å‘˜æƒé™çš„ç¨‹åºï¼Œåªèƒ½å¯¹HKEY_CURRENT_USERè·¯å¾„ä¸‹æ‰§è¡Œå†™æ“ä½œã€‚<br>3ï¼‰åªæœ‰ç®¡ç†å‘˜æƒé™çš„ç¨‹åºï¼Œæ‰èƒ½å‘ç³»ç»Ÿæ³¨å†Œæ§ä»¶ï¼ˆè¦å‘HKEY_LOCAL_MACHINEè·¯å¾„ä¸‹çš„æ³¨å†Œè¡¨å†™å…¥ä¿¡æ¯ï¼‰ã€‚</p>
</blockquote>
<p>å®‰è£…åŒ…ç¨‹åºä¸€èˆ¬é»˜è®¤æ˜¯å°†ç¨‹åºé»˜è®¤å®‰è£…åˆ°C:\Program Filesè·¯å¾„ä¸­ï¼Œéœ€è¦å‘ç³»ç»Ÿæ³¨å†Œæ§ä»¶ï¼Œè¿™äº›æ“ä½œéƒ½éœ€è¦ç®¡ç†å‘˜æƒé™æ‰èƒ½æ‰§è¡Œï¼Œæ‰€ä»¥å®‰è£…åŒ…ç¨‹åºä¸€èˆ¬éƒ½è¦è®¾ç½®ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œã€‚å¦‚æœç¨‹åºè®¾ç½®äº†ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œçš„å±æ€§ï¼Œåˆ™ç¨‹åºå›¾æ ‡çš„å³ä¸‹è§’ä¼šæ˜¾ç¤ºå°ç›¾ç‰Œçš„å›¾æ ‡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202505262256867.png" alt="image.png"></p>
<blockquote>
<p>æ³¨æ„ï¼Œå¦‚æœåœ¨è¶…çº§ç®¡ç†å‘˜Administratorç™»å½•çš„åœºæ™¯ä¸‹ï¼Œæ˜¯çœ‹ä¸åˆ°å°ç›¾ç‰Œçš„ï¼Œå› ä¸ºåœ¨è¶…çº§ç®¡ç†å‘˜ç™»å½•çš„æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ç¨‹åºé»˜è®¤ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œï¼Œä¸ç®¡ç¨‹åºæœ‰æ²¡æœ‰è®¾ç½®ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œã€‚</p>
</blockquote>
<p>æ­¤å¤–ï¼Œ<strong>å¯¹äºä»¥æ ‡å‡†ç”¨æˆ·æƒé™è¿è¡Œçš„ç¨‹åºï¼Œå¦‚æœè¦æ‰§è¡Œéœ€è¦ç®¡ç†å‘˜æƒé™æ‰èƒ½æ­£å¸¸æ‰§è¡Œçš„æ“ä½œ</strong>ï¼Œä¼šæ¶‰åŠåˆ°ä¸€ä¸ª<strong>ç³»ç»Ÿé‡å®šå‘</strong>çš„é—®é¢˜</p>
<h3 id="4ã€ç¨‹åºåˆ°åº•ä»¥å“ªç§æƒé™è¿è¡Œï¼Ÿä¸å“ªäº›å› ç´ æœ‰å…³ï¼Ÿ"><a href="#4ã€ç¨‹åºåˆ°åº•ä»¥å“ªç§æƒé™è¿è¡Œï¼Ÿä¸å“ªäº›å› ç´ æœ‰å…³ï¼Ÿ" class="headerlink" title="4ã€ç¨‹åºåˆ°åº•ä»¥å“ªç§æƒé™è¿è¡Œï¼Ÿä¸å“ªäº›å› ç´ æœ‰å…³ï¼Ÿ"></a>4ã€ç¨‹åºåˆ°åº•ä»¥å“ªç§æƒé™è¿è¡Œï¼Ÿä¸å“ªäº›å› ç´ æœ‰å…³ï¼Ÿ</h3><p>ç¨‹åºæœ‰æ²¡æœ‰ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œï¼Œä¸»è¦å’Œä¸¤ä¸ªå› ç´ æœ‰å…³ï¼Œä¸€ä¸ªæ˜¯å½“å‰ç³»ç»Ÿç™»å½•çš„ç”¨æˆ·ç±»å‹ï¼ˆæ ‡å‡†ç”¨æˆ·ã€ç®¡ç†å‘˜ç”¨æˆ·ä»¥åŠè¶…çº§ç®¡ç†å‘˜ç”¨æˆ·ï¼‰ï¼Œä¸€ä¸ªæ˜¯ç¨‹åºæœ‰æ²¡æœ‰è®¾ç½®ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œçš„å±æ€§ã€‚ä¸‹é¢ä»¥win10ç³»ç»Ÿæ¥è¯´æ˜ï¼Œwin10ç³»ç»Ÿå’Œwin7ç³»ç»Ÿæœ‰ä¸€äº›ä¸åŒçš„ï¼Œä¸è¿‡å¤§ä½“ä¸Šæ˜¯ä¸€æ ·çš„ã€‚</p>
<h4 id="4-1ã€ç»™ç¨‹åºè®¾ç½®ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œçš„å±æ€§"><a href="#4-1ã€ç»™ç¨‹åºè®¾ç½®ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œçš„å±æ€§" class="headerlink" title="4.1ã€ç»™ç¨‹åºè®¾ç½®ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œçš„å±æ€§"></a>4.1ã€ç»™ç¨‹åºè®¾ç½®ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œçš„å±æ€§</h4><p>å¦‚ä½•ç»™ç¨‹åºè®¾ç½®ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œçš„å±æ€§å‘¢ï¼Ÿå¯¹äºVisual Studioç¼–è¯‘çš„ç¨‹åºï¼Œè®¾ç½®ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œæ¯”è¾ƒç®€å•ã€‚åªè¦åœ¨exeä¸»ç¨‹åºçš„<strong>å·¥ç¨‹å±æ€§ä¸­ï¼Œé“¾æ¥å™¨ -&gt; æ¸…å•æ–‡ä»¶ -&gt; UACæ‰§è¡Œçº§åˆ«</strong>ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202505262257058.png" alt="image.png"></p>
<p>æˆ‘ä»¬é€‰æ‹©reguireAdministratoré€‰é¡¹å°±å¯ä»¥äº†ã€‚<strong>è®¾ç½®è¿™ä¸ªå±æ€§åï¼Œç¨‹åºåœ¨å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨å‘ç³»ç»Ÿç”³è¯·ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œã€‚</strong></p>
<blockquote>
<p>å¦‚æœå½“å‰ç™»å½•çš„ç®¡ç†å‘˜ç”¨æˆ·ï¼Œåˆ™ç¨‹åºå¯åŠ¨æ—¶ç›´æ¥ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œã€‚å¦‚æœå½“å‰ç™»å½•çš„æ˜¯æ ‡å‡†ç”¨æˆ·ï¼Œåˆ™å¯åŠ¨æ—¶ä¼šå¼¹å‡ºææƒçš„æç¤ºæ¡†ï¼Œéœ€è¦è¾“å…¥ä¸€ä¸ªç®¡ç†å‘˜è´¦æˆ·å’Œå¯†ç æ‰èƒ½å°†ç¨‹åºå¯åŠ¨èµ·æ¥ã€‚</p>
</blockquote>
<h4 id="4-2ã€å½“å‰ç™»å½•ç”¨æˆ·çš„ç±»å‹"><a href="#4-2ã€å½“å‰ç™»å½•ç”¨æˆ·çš„ç±»å‹" class="headerlink" title="4.2ã€å½“å‰ç™»å½•ç”¨æˆ·çš„ç±»å‹"></a>4.2ã€å½“å‰ç™»å½•ç”¨æˆ·çš„ç±»å‹</h4><p>ç¨‹åºåˆ°åº•ä»¥å“ªç§æƒé™è¿è¡Œï¼Œé™¤äº†è®¾ç½®ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œçš„å±æ€§å¤–ï¼Œè¿˜å’Œå½“å‰ç™»å½•çš„ç”¨æˆ·æœ‰å…³ã€‚</p>
<p><strong>4.2.1ã€è¶…çº§ç®¡ç†å‘˜Administratorç™»å½•</strong></p>
<p>å¦‚æœä½¿ç”¨Administratorè¶…çº§ç®¡ç†å‘˜ç™»å½•ï¼Œä¸ç®¡ç¨‹åºæœ‰æ²¡æœ‰è®¾ç½®ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œï¼Œéƒ½ä¼šä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œã€‚è¶…çº§ç®¡ç†å‘˜Administratorçš„æƒé™æ˜¯æœ€é«˜çš„ã€‚</p>
<p>åœ¨Windowsç³»ç»Ÿä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¶…çº§ç®¡ç†å‘˜Administratoræ˜¯ç¦ç”¨çš„ï¼Œå¯ä»¥é€šè¿‡è¿™æ ·çš„é€”å¾„æ¥å¼€å¯ï¼šå³é”®è®¡ç®—æœº -&gt;ç®¡ç† -&gt;ç³»ç»Ÿå·¥å…· -&gt;æœ¬åœ°ç”¨æˆ·å’Œç»„ -&gt;ç”¨æˆ· -&gt;å³é”®Administrator -&gt;å±æ€§ -&gt;å–æ¶ˆè´¦æˆ·ç¦ç”¨ï¼š</p>
<p><img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202505262258831.png" alt="image.png"></p>
<p>è¶…çº§ç®¡ç†å‘˜åœ¨ç”¨æˆ·ç®¡ç†ä¸­æ˜¯å¯ä»¥é‡å‘½åçš„ã€‚</p>
<p><strong>4.2.2ã€ç®¡ç†å‘˜ç”¨æˆ·ç™»å½•</strong></p>
<p>è¿™é‡Œè®²çš„ç®¡ç†å‘˜æ˜¯æ™®é€šç®¡ç†å‘˜ï¼Œä¸æ˜¯è¶…çº§ç®¡ç†å‘˜ã€‚å¯ä»¥å³é”®ç‚¹å‡»ç¨‹åºï¼Œåœ¨å¼¹å‡ºçš„å³é”®èœå•ä¸­ç‚¹å‡»â€œä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œâ€ï¼š</p>
<p><img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202505262258917.png" alt="image.png"></p>
<p>éœ€è¦è¾“å…¥ç®¡ç†å‘˜è´¦æˆ·å’Œå¯†ç ï¼Œè¦ææƒåˆ°ç®¡ç†å‘˜è´¦æˆ·ï¼Œç„¶åæ‰èƒ½ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œã€‚å¦‚æœå–æ¶ˆç®¡ç†å‘˜è´¦æˆ·çš„ç™»å½•ï¼Œåˆ™ç¨‹åºå¯åŠ¨å¤±è´¥ã€‚</p>
<h3 id="5ã€æ¡ˆä¾‹1-æ— æ³•åœ¨ä¼ä¸šå¾®ä¿¡èŠå¤©æ¡†ä¸­å¯åŠ¨å®‰è£…åŒ…ç¨‹åº"><a href="#5ã€æ¡ˆä¾‹1-æ— æ³•åœ¨ä¼ä¸šå¾®ä¿¡èŠå¤©æ¡†ä¸­å¯åŠ¨å®‰è£…åŒ…ç¨‹åº" class="headerlink" title="5ã€æ¡ˆä¾‹1 - æ— æ³•åœ¨ä¼ä¸šå¾®ä¿¡èŠå¤©æ¡†ä¸­å¯åŠ¨å®‰è£…åŒ…ç¨‹åº"></a>5ã€æ¡ˆä¾‹1 - æ— æ³•åœ¨ä¼ä¸šå¾®ä¿¡èŠå¤©æ¡†ä¸­å¯åŠ¨å®‰è£…åŒ…ç¨‹åº</h3><p>ä¼ä¸šå¾®ä¿¡é»˜è®¤æ˜¯ä»¥æ ‡å‡†ç”¨æˆ·è¿è¡Œçš„ï¼Œæ¯”å¦‚åŒå‡»æ¡Œé¢å¿«æ·æ–¹å¼æˆ–è€…ä»å¼€å§‹èœå•ä¸­ç‚¹å‡»è¿è¡Œèµ·æ¥çš„ï¼Œéƒ½æ˜¯ä»¥æ ‡å‡†ç”¨æˆ·æƒé™è¿è¡Œçš„ã€‚æŸå¤©æˆ‘å°†è½¯ä»¶æœ€æ–°çš„å®‰è£…åŒ…å‘åˆ°ä¼ä¸šå¾®ä¿¡çš„ç¾¤ä¸­ï¼ŒåŒäº‹åœ¨ç¾¤ä¸­æ”¶åˆ°è¯¥æ–‡ä»¶åï¼Œ<em>ç›´æ¥åœ¨ä¼ä¸šå¾®ä¿¡èŠå¤©æ¡†ä¸­åŒå‡»è¯¥å®‰è£…åŒ…æ–‡ä»¶ï¼Œä½†å¼¹å‡ºäº†å¦‚ä¸‹çš„æŠ¥é”™æç¤ºæ¡†</em>ï¼š<br><img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202505262258375.png" alt="image.png"></p>
<p>å¤§å®¶å¹³æ—¶åœ¨ä¼ä¸šå¾®ä¿¡ä¸­æ”¶åˆ°æ–‡ä»¶åï¼Œå¸¸ä¹ æƒ¯äºç›´æ¥åŒå‡»å»æŸ¥çœ‹æ–‡ä»¶æˆ–è€…å¯åŠ¨ç¨‹åºï¼Œä½†æ­¤æ¬¡åŒå‡»å´æŠ¥é”™äº†ã€‚åŒäº‹æ€€ç–‘æ˜¯æˆ‘ä»¬çš„è½¯ä»¶å®‰è£…åŒ…æœ‰é—®é¢˜ï¼Œè¯¢é—®æˆ‘ä»¬æ˜¯æ€ä¹ˆå›äº‹ã€‚ä»è¿™ä¸ªæˆªå›¾çœ‹ï¼Œæˆªå›¾çš„æ ‡é¢˜æ˜¯ä¸ªä¼ä¸šå¾®ä¿¡çš„è·¯å¾„ï¼Œç„¶åæç¤ºæ–‡å­—æ˜¯ï¼šWindows æ— æ³•è®¿é—®æŒ‡å®šè®¾å¤‡ã€è·¯å¾„æˆ–æ–‡ä»¶ã€‚ä½ å¯èƒ½æ²¡æœ‰é€‚å½“çš„æƒé™è®¿é—®è¯¥é¡¹ç›®ã€‚</p>
<p>ä½œä¸ºå¼€å‘äººå‘˜ï¼Œæˆ‘ä»¬è¿™ç±»ç¨‹åºè¿è¡Œæƒé™çš„é—®é¢˜æ¯”è¾ƒç†Ÿæ‚‰äº†ï¼Œä¸€çœ‹å°±å¤§æ¦‚çŸ¥é“æ€ä¹ˆå›äº‹äº†ã€‚_å½“å‰çš„ä¼ä¸šå¾®ä¿¡æ˜¯ä»¥æ ‡å‡†ç”¨æˆ·æƒé™è¿è¡Œçš„ï¼Œè€Œæˆ‘ä»¬çš„è½¯ä»¶å®‰è£…åŒ…æ˜¯è®¾ç½®ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œçš„ï¼Œä¸¤ä¸ªç¨‹åºè¿›ç¨‹çš„æƒé™ä¸å¯¹ç­‰ï¼Œæ‰€ä»¥æ“ä½œå¤±è´¥äº†ã€‚_<em>ä½æƒé™ï¼ˆæ ‡å‡†ç”¨æˆ·æƒé™ï¼‰è¿›ç¨‹ä¸èƒ½å¯åŠ¨é«˜æƒé™ï¼ˆç®¡ç†å‘˜æƒé™ï¼‰è¿›ç¨‹ã€‚</em></p>
<h3 id="6ã€æ¡ˆä¾‹2-ä½¿ç”¨Windbgæ—¶å¯èƒ½ä¼šé‡åˆ°çš„æƒé™ä¸å¯¹ç­‰å¯¼è‡´æ“ä½œå¤±è´¥çš„é—®é¢˜"><a href="#6ã€æ¡ˆä¾‹2-ä½¿ç”¨Windbgæ—¶å¯èƒ½ä¼šé‡åˆ°çš„æƒé™ä¸å¯¹ç­‰å¯¼è‡´æ“ä½œå¤±è´¥çš„é—®é¢˜" class="headerlink" title="6ã€æ¡ˆä¾‹2 - ä½¿ç”¨Windbgæ—¶å¯èƒ½ä¼šé‡åˆ°çš„æƒé™ä¸å¯¹ç­‰å¯¼è‡´æ“ä½œå¤±è´¥çš„é—®é¢˜"></a>6ã€æ¡ˆä¾‹2 - ä½¿ç”¨Windbgæ—¶å¯èƒ½ä¼šé‡åˆ°çš„æƒé™ä¸å¯¹ç­‰å¯¼è‡´æ“ä½œå¤±è´¥çš„é—®é¢˜</h3><p>æˆ‘ä»¬åœ¨ä½¿ç”¨Windbgé™æ€åˆ†ædumpæ–‡ä»¶å’Œé™„åŠ åˆ°ç›®æ ‡è¿›ç¨‹ä¸ŠåŠ¨æ€è°ƒè¯•æ—¶ï¼Œä¹Ÿé‡åˆ°è¿‡æƒé™ä¸å¯¹ç­‰å¯¼è‡´æ“ä½œå¤±è´¥çš„é—®é¢˜ã€‚</p>
<h4 id="6-1ã€Windbgé™„åŠ åˆ°ç›®æ ‡è¿›ç¨‹å¤±è´¥"><a href="#6-1ã€Windbgé™„åŠ åˆ°ç›®æ ‡è¿›ç¨‹å¤±è´¥" class="headerlink" title="6.1ã€Windbgé™„åŠ åˆ°ç›®æ ‡è¿›ç¨‹å¤±è´¥"></a>6.1ã€Windbgé™„åŠ åˆ°ç›®æ ‡è¿›ç¨‹å¤±è´¥</h4><p>å½“å‰è¦è¢«é™„åŠ è°ƒè¯•çš„ç›®æ ‡ç¨‹åºæ­£ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œï¼Œè‡³äºä¸ºä»€ä¹ˆä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œï¼Œå¯èƒ½æ˜¯å³é”®ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œçš„ï¼Œä¹Ÿæœ‰å¯èƒ½ç¨‹åºæ˜¯å®‰è£…åŒ…å®‰è£…åè‡ªåŠ¨å¯åŠ¨çš„ï¼ˆå®‰è£…åŒ…æ˜¯ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œçš„ï¼Œå…¶å¯åŠ¨çš„ç¨‹åºä¹Ÿç»§æ‰¿äº†ç®¡ç†å‘˜æƒé™ï¼‰ã€‚è€Œå½“å‰å¯åŠ¨èµ·æ¥çš„Windbgæ˜¯ä»¥æ ‡å‡†ç”¨æˆ·æƒé™è¿è¡Œï¼ˆåŒå‡»æ¡Œé¢å¿«æ·æ–¹å¼å¯åŠ¨èµ·æ¥çš„ï¼‰ï¼Œ<em>å½“å°†Windbgé™„åŠ åˆ°ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œçš„ç›®æ ‡ç¨‹åºè¿›ç¨‹ä¸Šæ—¶ï¼Œé™„åŠ å¤±è´¥</em>ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br>Â  Â  Â  Â <br><img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202505262259466.png" alt="image.png"></p>
<p><em>ä½æƒé™ï¼ˆæ ‡å‡†ç”¨æˆ·æƒé™ï¼‰Windbgæ˜¯ä¸èƒ½é™„åŠ åˆ°é«˜æƒé™ï¼ˆç®¡ç†å‘˜æƒé™ï¼‰çš„ç›®æ ‡ç¨‹åºè¿›ç¨‹ä¸Šçš„ã€‚</em></p>
<p>Â  Â  Â  Â å¦‚æœWindbgæ˜¯ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œçš„ï¼Œæ˜¯å¯ä»¥æˆåŠŸé™„åŠ åˆ°æ ‡å‡†ç”¨æˆ·æƒé™è¿è¡Œçš„è¿›ç¨‹ä¸Šçš„ï¼Œè¿™ä¸ªç³»ç»Ÿæ˜¯å…è®¸çš„ã€‚</p>
<h4 id="6-2ã€dumpæ–‡ä»¶æ‹–åˆ°ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œçš„Windbgä¸­æ²¡ååº”"><a href="#6-2ã€dumpæ–‡ä»¶æ‹–åˆ°ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œçš„Windbgä¸­æ²¡ååº”" class="headerlink" title="6.2ã€dumpæ–‡ä»¶æ‹–åˆ°ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œçš„Windbgä¸­æ²¡ååº”"></a>6.2ã€dumpæ–‡ä»¶æ‹–åˆ°ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œçš„Windbgä¸­æ²¡ååº”</h4><p>æ— æ³•ç”¨Windbgæ‰“å¼€æŸä¸ªdumpæ–‡ä»¶ï¼Œå…·ä½“ç°è±¡æ˜¯ï¼Œ<em>å°†ç£ç›˜ä¸Šçš„dumpæ–‡ä»¶æ‹–å…¥åˆ°å·²ç»æ‰“å¼€çš„Windbgä¸­æ²¡ååº”</em>ï¼š</p>
<p><img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202505262259526.png" alt="image.png"></p>
<p>æ­£å¸¸æ‰“å¼€dumpæ–‡ä»¶æ—¶çš„æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202505262259862.png" alt="image.png"></p>
<p>èµ·åˆæ€€ç–‘æ˜¯ä¸æ˜¯dumpæ–‡ä»¶æ¯”è¾ƒç‰¹æ®Šï¼Œæ¯”å¦‚æ–‡ä»¶æŸåäº†ï¼Œæ‰€ä»¥æ‰“ä¸å¼€ã€‚æŒ‰è®²ä¸åº”è¯¥çš„ï¼Œdumpæ–‡ä»¶çš„å¤§å°æ˜¯é0çš„ï¼Œä¼°è®¡æ˜¯ç¨‹åºè¿è¡Œæƒé™å¼•èµ·çš„ã€‚<br>ç»ç¡®è®¤ï¼Œ<em>Windbgæ˜¯å³é”®ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œçš„ï¼Œè€Œdumpæ–‡ä»¶æ˜¯ä»ç£ç›˜ä¸Šæ‹–è¿‡æ¥çš„ï¼Œè¿è¡Œåœ¨exploreræ–‡ä»¶èµ„æºç®¡ç†å™¨è¿›ç¨‹ä¸­çš„ï¼Œè€Œæ–‡ä»¶èµ„æºç®¡ç†å™¨æ˜¯ä»¥æ ‡å‡†ç”¨æˆ·æƒé™è¿è¡Œçš„ï¼Œ<br>å› ä¸ºWindbgè¿›ç¨‹ï¼ˆç®¡ç†å‘˜æƒé™è¿è¡Œï¼‰ä¸explorer.exeæ–‡ä»¶èµ„æºç®¡ç†å™¨è¿›ç¨‹ï¼ˆæ ‡å‡†ç”¨æˆ·æƒé™è¿è¡Œï¼‰æƒé™ä¸å¯¹ç­‰ï¼Œæ‰€ä»¥ç³»ç»Ÿç¦æ­¢äº†æ–‡ä»¶æ‹–æ”¾è¡Œä¸º</em>ï¼Œæ‰€ä»¥æ‹–åˆ°Windbgä¸­æ²¡ååº”ã€‚</p>
<h3 id="7ã€æ¡ˆä¾‹3-åŒå‡»æ¡Œé¢å¿«æ·æ–¹å¼å¯åŠ¨ç¨‹åºæ—¶å¹¶æ²¡æœ‰è‡ªåŠ¨å°†å·²ç»å¯åŠ¨èµ·æ¥çš„ç¨‹åºçª—å£å¼¹å‡ºæ¥"><a href="#7ã€æ¡ˆä¾‹3-åŒå‡»æ¡Œé¢å¿«æ·æ–¹å¼å¯åŠ¨ç¨‹åºæ—¶å¹¶æ²¡æœ‰è‡ªåŠ¨å°†å·²ç»å¯åŠ¨èµ·æ¥çš„ç¨‹åºçª—å£å¼¹å‡ºæ¥" class="headerlink" title="7ã€æ¡ˆä¾‹3 - åŒå‡»æ¡Œé¢å¿«æ·æ–¹å¼å¯åŠ¨ç¨‹åºæ—¶å¹¶æ²¡æœ‰è‡ªåŠ¨å°†å·²ç»å¯åŠ¨èµ·æ¥çš„ç¨‹åºçª—å£å¼¹å‡ºæ¥"></a>7ã€æ¡ˆä¾‹3 - åŒå‡»æ¡Œé¢å¿«æ·æ–¹å¼å¯åŠ¨ç¨‹åºæ—¶å¹¶æ²¡æœ‰è‡ªåŠ¨å°†å·²ç»å¯åŠ¨èµ·æ¥çš„ç¨‹åºçª—å£å¼¹å‡ºæ¥</h3><p>å¾ˆå¤šç¨‹åºåªå…è®¸å¯åŠ¨ä¸€ä¸ªç¨‹åºå®ä¾‹ï¼ˆåªèƒ½è¿è¡Œä¸€ä¸ªè¿›ç¨‹ï¼‰ï¼Œä¸åƒæµè§ˆå™¨ç¨‹åºï¼Œå¯ä»¥å¯åŠ¨å¤šä¸ªç¨‹åºï¼ˆçª—å£ï¼‰ã€‚åªå…è®¸ç¨‹åºè¿è¡Œä¸€ä¸ªå®ä¾‹ï¼Œå¤§ä½“æ˜¯è¿™ä¹ˆå®ç°çš„ï¼Œ<strong>å½“ç¨‹åºå¯åŠ¨æ—¶ä¼šå»æ£€æµ‹æ˜¯å¦æœ‰ç¨‹åºè¿›ç¨‹å·²ç»å¯åŠ¨ï¼Œå¦‚æœå·²ç»æœ‰ç¨‹åºè¿›ç¨‹è¿è¡Œä¸”ä¸æ˜¯å½“å‰çš„è¿›ç¨‹ï¼Œåˆ™è‡ªåŠ¨å°†å½“å‰æ–°å¯åŠ¨çš„è¿›ç¨‹é€€å‡ºï¼Œè¿™æ ·å°±èƒ½ä¿è¯ç¨‹åºåªè¿è¡Œä¸€ä¸ªå®ä¾‹äº†ã€‚</strong></p>
<p>å‡å®šå½“å‰ç¨‹åºå·²ç»è¿è¡Œä¸”åªå…è®¸è¿è¡Œä¸€ä¸ªç¨‹åºå®ä¾‹ï¼Œä½†æˆ‘ä»¬æ²¡æœ‰çœ‹åˆ°ç¨‹åºçª—å£ï¼ˆå¯èƒ½ç¨‹åºè¢«æœ€å°åŒ–äº†ï¼Œæˆ–è€…è¢«æœ€å°åŒ–åˆ°æ‰˜ç›˜åŒºåŸŸäº†ï¼‰ï¼Œä¸ç¡®å®šç¨‹åºæœ‰æ²¡æœ‰è¿è¡Œèµ·æ¥ï¼Œæˆ‘ä»¬ä¼šå»åŒå‡»æ¡Œé¢å¿«æ·æ–¹å¼ã€‚æ­¤æ—¶ï¼Œå› ä¸ºç¨‹åºä¹‹å‰å·²ç»å¯åŠ¨èµ·æ¥ï¼Œ<strong>æŒ‰ç†æˆ‘ä»¬è¦å°†å·²ç»è¿è¡Œçš„ç¨‹åºçª—å£è‡ªåŠ¨å¼¹å‡ºæ¥</strong>ã€‚æˆ‘ä»¬çš„è½¯ä»¶ä»£ç ä¹Ÿç¡®å®è¿™ä¹ˆå®ç°äº†ï¼Œä½†åœ¨æŸä¸ªåœºåˆä¸‹è¿˜æ˜¯æ²¡æœ‰å°†å·²ç»è¿è¡Œçš„ç¨‹åºçª—å£å¼¹å‡ºæ¥ã€‚</p>
<p><strong>åœºæ™¯æ˜¯è¿™æ ·çš„</strong>ï¼šå·²ç»è¿è¡Œçš„ç¨‹åºï¼Œæ˜¯ä½¿ç”¨å®‰è£…åŒ…å®‰è£…è½¯ä»¶åè‡ªåŠ¨å¯åŠ¨èµ·æ¥çš„ï¼Œå› ä¸ºå®‰è£…åŒ…æ˜¯ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œçš„ï¼Œæ‰€ä»¥è¢«å¯åŠ¨èµ·æ¥çš„ç¨‹åºé»˜è®¤æ˜¯ç»§æ‰¿äº†ç®¡ç†å‘˜æƒé™ã€‚è€Œæˆ‘ä»¬é€šè¿‡åŒå‡»æ¡Œé¢å¿«æ·æ–¹å¼å¯åŠ¨çš„æ–°çš„è¿›ç¨‹æ˜¯ä»¥æ ‡å‡†æƒé™è¿è¡Œçš„ï¼Œç¨‹åºåˆå§‹åŒ–è¿è¡Œæ—¶ä¼šå»æ£€æµ‹ç¨‹åºæ˜¯å¦å·²ç»è¿è¡Œï¼Œç¡®å®æ£€æµ‹åˆ°ç¨‹åºå·²ç»è¿è¡Œï¼Œå¹¶æ‰¾åˆ°äº†å·²ç»è¿è¡Œçš„ç¨‹åºä¸»çª—å£ï¼Œ<em>ä½†åœ¨è°ƒç”¨APIå‡½æ•°ShowWindowå°†è¯¥çª—å£Showå‡ºæ¥æ—¶å´å¤±è´¥äº†</em>ã€‚</p>
<p>Â  Â  Â  Â äºæ˜¯æƒ³åˆ°MSDNä¸ŠæŸ¥çœ‹APIå‡½æ•°ShowWindowçš„è¯´æ˜ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½å°†ç›¸å…³å€¼æ‰“å°å‡ºæ¥ï¼Œåˆ†æä¸€ä¸‹è¯¥å‡½æ•°ä¸ºä»€ä¹ˆä¼šè°ƒç”¨å¤±è´¥ã€‚ShowWindowå‡½æ•°åœ¨MSDNä¸Šçš„è¯´æ˜å¦‚ä¸‹ï¼š<br>Â  Â  Â  Â <br><img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202505262302813.png" alt="image.png"></p>
<p>è¯¥å‡½æ•°çš„è¿”å›å€¼æ˜¯BOOLå‹çš„ï¼Œä½†_è¿™ä¸ªè¿”å›å€¼åªæ˜¯æ ‡è¯†çª—å£ä¹‹å‰çš„çŠ¶æ€ï¼Œå¹¶ä¸æ˜¯æ ‡è¯†ShowWindowå‡½æ•°æ˜¯å¦æ‰§è¡ŒæˆåŠŸçš„_ï¼Œ<strong>åªèƒ½å€ŸåŠ©GetLastErrorå‡½æ•°ï¼Œé€šè¿‡è·å–LastErrorå€¼æ‰¾åˆ°ShowWindowæ‰§è¡Œå¤±è´¥çš„åŸå› </strong></p>
<blockquote>
<p>æœ‰äº›Windows APIéœ€è¦å€ŸåŠ©GetLastErrorè·å–çš„LastErrorå€¼å»åˆ¤æ–­æœ‰æ²¡æœ‰æ‰§è¡ŒæˆåŠŸï¼š</p>
<p>1ï¼‰å¦‚æœLastErrorå€¼ä¸º0ï¼Œåˆ™è¡¨ç¤ºæ‰§è¡ŒæˆåŠŸï¼›</p>
<p>2ï¼‰å¦‚æœLastErrorå€¼ä¸ä¸º0ï¼Œåˆ™è¡¨ç¤ºæ‰§è¡Œå¤±è´¥ï¼ŒLastErrorå€¼å¯¹åº”çš„å°±æ˜¯æ‰§è¡Œå¤±è´¥çš„åŸå› ã€‚</p>
</blockquote>
<p>äºæ˜¯æ·»åŠ å¦‚ä¸‹çš„æ‰“å°ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">BOOL bShowTargetWndSuccess = FALSE;</span><br><span class="line"><span class="built_in">SetLastError</span>(<span class="number">0</span>);</span><br><span class="line">::<span class="built_in">ShowWindow</span>(hPrevWnd, SW_RESTORE);</span><br><span class="line">dwLastError = <span class="built_in">GetLastError</span>();</span><br><span class="line"><span class="keyword">if</span> ( dwLastError == <span class="number">0</span> )</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// çª—å£ShowæˆåŠŸäº†</span></span><br><span class="line">    bShowTargetWndSuccess = TRUE;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// çª—å£Showå¤±è´¥äº†ï¼Œå°†APIå‡½æ•°ShowWindowè®¾ç½®å®Œåè®¾ç½®çš„LastErrorå€¼æ‰“å°å‡ºæ¥</span></span><br><span class="line">    <span class="type">char</span> szLog[<span class="number">256</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    <span class="built_in">sprintf</span>(szLog, <span class="string">&quot;[CheckShowExsitingWnd] show target window failed, LastError = %d.&quot;</span>, dwLastError);</span><br><span class="line">    <span class="built_in">WriteLog</span>(szLog);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åæ¥å¤ç°äº†è¿™ä¸ªé—®é¢˜ï¼ŒæŸ¥çœ‹åˆ°è°ƒç”¨ShowWindowçª—å£Showå¤±è´¥æ—¶è®¾ç½®çš„LastErrorå€¼ä¸º5ï¼Œåˆ°VSè‡ªå¸¦çš„é”™è¯¯æŸ¥çœ‹å·¥å…·ä¸­æŸ¥çœ‹è¯¥å€¼çš„å«ä¹‰å¦‚ä¸‹ï¼š</p>
<p><img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202505262303350.png" alt="image.png"></p>
<p>æ‹’ç»è®¿é—®ï¼Œåº”è¯¥å°±æ˜¯æƒé™é—®é¢˜å¯¼è‡´ShowWindowæ‰§è¡Œå¤±è´¥äº†ã€‚å·²ç»è¿è¡Œçš„ç¨‹åºè¿›ç¨‹å› ä¸ºæ˜¯å®‰è£…åŒ…å®‰è£…å®Œæˆåè‡ªåŠ¨å¯åŠ¨çš„ï¼Œæ‰€ä»¥æœ‰ç®¡ç†å‘˜æƒé™ï¼Œè€Œæ–°å¯åŠ¨çš„è¿›ç¨‹æ˜¯åŒå‡»æ¡Œé¢å¿«æ·æ–¹å¼å¯åŠ¨çš„ï¼Œæ‰€ä»¥æ˜¯ä»¥æ ‡å‡†ç”¨æˆ·æƒé™è¿è¡Œçš„ã€‚<em>æ–°å¯åŠ¨çš„è¿›ç¨‹æ£€æµ‹åˆ°ç¨‹åºå·²ç»è¿è¡Œï¼Œä½æƒé™ï¼ˆæ ‡å‡†ç”¨æˆ·æƒé™ï¼‰çš„æ–°è¿›ç¨‹æƒ³è¦å…¶Showé«˜æƒé™ï¼ˆç®¡ç†å‘˜æƒé™ï¼‰çš„å·²å¯åŠ¨è¿›ç¨‹ä¸­çš„çª—å£ï¼Œç³»ç»Ÿæ˜¯ä¸å…è®¸çš„ï¼Œæ‰€ä»¥å¯¼è‡´ShowWindowæ‰§è¡Œå¤±è´¥ã€‚</em></p>
<p>ç›®å‰è§„é¿çš„åŠæ³•æ˜¯ï¼Œå½“æˆ‘ä»¬å‘ç°ShowWindowæ‰§è¡Œå¤±è´¥ï¼ˆåˆ¤æ–­LastErrorå€¼ï¼‰æ—¶ï¼Œç›´æ¥å¼¹å‡ºä¸€ä¸ªæç¤ºæ¡†ï¼Œä½†è¿˜æ˜¯æ²¡æœ‰å°†å·²å¯åŠ¨çš„ç¨‹åºçª—å£å¼¹å‡ºæ¥ï¼Œè¿™åªæ˜¯ä¸ªè§„é¿é—®é¢˜çš„æ–¹æ³•ï¼Œç”¨æˆ·ä½“éªŒä¸å¥½ã€‚</p>
<p>æœ€å¥½çš„è§£å†³åŠæ³•æ˜¯ï¼Œå®‰è£…åŒ…åœ¨å®‰è£…å®Œæˆåè‡ªåŠ¨å¯åŠ¨è¿›ç¨‹æ—¶ï¼Œç›´æ¥ä»¥æ ‡å‡†ç”¨æˆ·æƒé™å¯åŠ¨ç¨‹åºï¼Œè¿™æ ·å°±æ²¡æœ‰æƒé™ä¸å¯¹ç­‰çš„é—®é¢˜äº†ï¼Œè¿™æ ·å°±èƒ½è‡ªåŠ¨å¼¹å‡ºå·²ç»è¿è¡Œçš„ç¨‹åºçª—å£äº†ã€‚</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/05/14/debug/debug%20windbg%20information/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/05/14/debug/debug%20windbg%20information/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2025-05-14 19:48:44 / Modified: 19:51:08" itemprop="dateCreated datePublished" datetime="2025-05-14T19:48:44+08:00">2025-05-14</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="windbg"><a href="#windbg" class="headerlink" title="windbg"></a>windbg</h2><h3 id="pdb"><a href="#pdb" class="headerlink" title="pdb"></a>pdb</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">!sym noisy</span><br><span class="line">!sym quiet</span><br><span class="line"></span><br><span class="line">D:\Environment\Symbols;SRV*D:\Environment\Symbols*http://msdl.microsoft.com/download/symbols;E:\Develop\Project;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="åˆ†ç¦»è¿›ç¨‹"><a href="#åˆ†ç¦»è¿›ç¨‹" class="headerlink" title="åˆ†ç¦»è¿›ç¨‹"></a>åˆ†ç¦»è¿›ç¨‹</h3><blockquote>
<p> æ³¨æ„:å¦‚æœæ˜¯windbgé™„åŠ åˆ°åº”ç”¨å±‚ï¼Œå¦‚æœä¸è¿›è¡Œåˆ†ç¦»ï¼Œç›´æ¥å…³é—­windbgï¼Œä¼šå¯¼è‡´è¢«é™„åŠ çš„è¿›ç¨‹æ­»äº¡</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.detach</span><br><span class="line">qd</span><br></pre></td></tr></table></figure>


<h3 id="è½¬å‚¨"><a href="#è½¬å‚¨" class="headerlink" title="è½¬å‚¨"></a>è½¬å‚¨</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.dump</span><br></pre></td></tr></table></figure>


<h3 id="windbg-æ§åˆ¶æ—¥å¿—è¾“å‡º"><a href="#windbg-æ§åˆ¶æ—¥å¿—è¾“å‡º" class="headerlink" title="windbg æ§åˆ¶æ—¥å¿—è¾“å‡º"></a>windbg æ§åˆ¶æ—¥å¿—è¾“å‡º</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">eb nt!Kd_DEFAULT_Mask 0</span><br><span class="line">eb nt!Kd_DEFAULT_Mask 0xf</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä¸‹é¢ eb ç›´æ¥å°†DbgPrintå‡½æ•°è¿”å›</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">eb DbgPrint 0xc3; </span><br><span class="line">eb DbgPrintEx 0xc3; </span><br><span class="line">ed nt!Kd_FUSION_Mask 0; </span><br><span class="line">ed nt!Kd_SXS_Mask 0; </span><br><span class="line">ed nt!Kd_WIN2000_Mask 0;</span><br></pre></td></tr></table></figure>


<h3 id="è¿›ç¨‹çº¿ç¨‹"><a href="#è¿›ç¨‹çº¿ç¨‹" class="headerlink" title="è¿›ç¨‹çº¿ç¨‹"></a>è¿›ç¨‹çº¿ç¨‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">!process 0 0</span><br><span class="line"></span><br><span class="line">## dump æ‰€æœ‰</span><br><span class="line">!process 0 1f  </span><br><span class="line"></span><br><span class="line">## é€šè¿‡ç¨‹åºåè·å–</span><br><span class="line">!process 0 0 &lt;xxx.exe&gt;</span><br><span class="line"></span><br><span class="line">!process ffffde06b43d04c0 1f</span><br><span class="line">!object  ffffde06b43d04c0</span><br><span class="line"></span><br><span class="line">## æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹,æŸ¥æ­»é”å¡æ­»é—®é¢˜</span><br><span class="line">!running it </span><br><span class="line">!thread &lt;&gt;</span><br><span class="line"></span><br><span class="line">## åˆ‡æ¢åˆ°ç›®æ ‡è¿›ç¨‹/çº¿ç¨‹ç©ºé—´</span><br><span class="line">.process &lt;&gt;</span><br><span class="line">.thread &lt;&gt;</span><br><span class="line"></span><br><span class="line">## æŸ¥çœ‹å½“å‰è¿›ç¨‹/çº¿ç¨‹</span><br><span class="line">.process</span><br><span class="line">.thread</span><br><span class="line"></span><br><span class="line">## è·å–çº¿ç¨‹çš„å †æ ˆèŒƒå›´</span><br><span class="line">dt _KTHREAD ffffa68d9a78e080</span><br><span class="line">+0x030 StackLimit</span><br><span class="line">+0x038 StackBase</span><br><span class="line">dsp StackLimit StackBase</span><br><span class="line"></span><br><span class="line">## å¯ä»¥æŸ¥çœ‹ä¸€ä¸ªçº¿ç¨‹çš„è°ƒç”¨æ ˆ</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">~* k</span><br></pre></td></tr></table></figure>



<h3 id="Apc"><a href="#Apc" class="headerlink" title="Apc"></a>Apc</h3><blockquote>
<p>è¿™é‡Œéœ€è¦è¿›è¡Œè¡¥å……</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">!apc</span><br><span class="line">    !apc proc Process</span><br><span class="line">    !apc thre Thread</span><br><span class="line">    !apc KAPC</span><br></pre></td></tr></table></figure>


<h3 id="IRP"><a href="#IRP" class="headerlink" title="IRP"></a>IRP</h3><p>åœ¨!process &lt;&gt; 1f çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ‰è¿›ç¨‹è¿˜æœ‰æœªå¤„ç†å®Œçš„irpï¼Œä¼šå‡ºç°ä¸€ä¸‹çš„æ—¥å¿—æ‰“å°</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">IRP List:</span><br><span class="line">            ffffde0371c7b010: (0006,0478) Flags: 00060000  Mdl: 00000000</span><br><span class="line">            ffffde036fd6ba20: (0006,0478) Flags: 00060000  Mdl: 00000000</span><br><span class="line">            ffffde03727efb20: (0006,0478) Flags: 00060000  Mdl: 00000000</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä¿¡æ¯ä¸­ ffffde0371c7b010 ä¸º IRP æŒ‡é’ˆï¼Œé€šè¿‡ <code>!irp &lt;address&gt;</code> å‘½ä»¤å¯ä»¥æŸ¥çœ‹å½“å‰irp çš„è¯¦ç»†ä¿¡æ¯ï¼Œä¾‹å¦‚ä»¥ä¸‹è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[IRP_MJ_DIRECTORY_CONTROL(c), N/A(2)]</span><br><span class="line">     0  1 ffffde036c5ad030 ffffde0374e5adf0 00000000-00000000    pending</span><br><span class="line">        \FileSystem\Ntfs</span><br><span class="line">        Args: 00000800 00000015 00000000 00000000</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ç¬¬äºŒç‚¹ï¼š<br><code>ffffde0374e5adf0</code>: FileObject åœ°å€</p>
<p>é€šè¿‡  <code>dt _FILE_OBJECT ffffde0374e5adf0</code>  è¿›è¡ŒæŸ¥çœ‹</p>
<h3 id="handle"><a href="#handle" class="headerlink" title="handle"></a>handle</h3><p>!htrace -enableï¼šå¯ç”¨handle trace,å¹¶ä¸”åˆ›å»ºç¬¬ä¸€ä¸ªå¿«ç…§ä½œä¸ºåˆå§‹çŠ¶æ€ï¼Œæ–¹ä¾¿ä½¿ç”¨ -diffé€‰é¡¹<br>!htraceï¼šæ˜¾ç¤ºå½“å‰çš„æ‰€æœ‰å¥æŸ„ä¿¡æ¯<br>!htrace -snapshotï¼šåˆ›å»ºå¿«ç…§ï¼Œç”¨ä½œ-diffé€‰é¡¹<br>!handle xxx fï¼šæŸ¥çœ‹ä¸€ä¸‹handleçš„ä¿¡æ¯</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/05/14/debug/%E4%BE%8B%E5%AD%90/windbg%20%E8%A7%82%E5%AF%9F%E5%8F%A5%E6%9F%84%E6%B3%84%E9%9C%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/05/14/debug/%E4%BE%8B%E5%AD%90/windbg%20%E8%A7%82%E5%AF%9F%E5%8F%A5%E6%9F%84%E6%B3%84%E9%9C%B2/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-05-14 19:06:11" itemprop="dateCreated datePublished" datetime="2025-05-14T19:06:11+08:00">2025-05-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-06-08 23:23:11" itemprop="dateModified" datetime="2025-06-08T23:23:11+08:00">2025-06-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="ä¸€ã€è§‚å¯Ÿè¿›ç¨‹æ˜¯å¦æœ‰å¥æŸ„æ³„æ¼"><a href="#ä¸€ã€è§‚å¯Ÿè¿›ç¨‹æ˜¯å¦æœ‰å¥æŸ„æ³„æ¼" class="headerlink" title="ä¸€ã€è§‚å¯Ÿè¿›ç¨‹æ˜¯å¦æœ‰å¥æŸ„æ³„æ¼"></a>ä¸€ã€è§‚å¯Ÿè¿›ç¨‹æ˜¯å¦æœ‰å¥æŸ„æ³„æ¼</h3><h4 id="1ã€æŸ¥çœ‹å·¥å…·"><a href="#1ã€æŸ¥çœ‹å·¥å…·" class="headerlink" title="1ã€æŸ¥çœ‹å·¥å…·"></a>1ã€æŸ¥çœ‹å·¥å…·</h4><p>ä½¿ç”¨<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E4%BB%BB%E5%8A%A1%E7%AE%A1%E7%90%86%E5%99%A8&spm=1001.2101.3001.7020">ä»»åŠ¡ç®¡ç†å™¨</a>æˆ–Process Explorerï¼ˆprocexp.exeï¼‰å·¥å…·å¯è§‚å¯Ÿè¿›ç¨‹çš„å¥æŸ„æ•°ã€‚</p>
<h5 id="ä»»åŠ¡ç®¡ç†å™¨æŸ¥çœ‹å¥æŸ„æ•°"><a href="#ä»»åŠ¡ç®¡ç†å™¨æŸ¥çœ‹å¥æŸ„æ•°" class="headerlink" title="ä»»åŠ¡ç®¡ç†å™¨æŸ¥çœ‹å¥æŸ„æ•°"></a>ä»»åŠ¡ç®¡ç†å™¨æŸ¥çœ‹å¥æŸ„æ•°</h5><p><img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202505142010412.png" alt="image.png|600"></p>
<p><img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202505142011038.png" alt="image.png"></p>
<h5 id="procexp-exeæŸ¥çœ‹è¿›ç¨‹å¥æŸ„ä¿¡æ¯"><a href="#procexp-exeæŸ¥çœ‹è¿›ç¨‹å¥æŸ„ä¿¡æ¯" class="headerlink" title="procexp.exeæŸ¥çœ‹è¿›ç¨‹å¥æŸ„ä¿¡æ¯"></a>procexp.exeæŸ¥çœ‹è¿›ç¨‹å¥æŸ„ä¿¡æ¯</h5><h5 id=""><a href="#" class="headerlink" title=""></a><img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202505142011701.png" alt="image.png"></h5><p>2ã€åˆ¤æ–­æ˜¯å¦æœ‰å¥æŸ„æ³„æ¼<br>é€šå¸¸åœ¨ç¨‹åºè¿è¡Œç¨³å®šåï¼Œå†è§‚å¯Ÿå¥æŸ„æ•°æœ‰æ— å¢é•¿ï¼Œæ¯”å¦‚è¿›ç¨‹å¯åŠ¨5åˆ†é’Ÿåå†å¼€å§‹è§‚å¯Ÿï¼Œè®©å…¶è¿è¡ŒåŠå¤©æˆ–ä¸€å¤©ï¼Œæ¯”è¾ƒå‰åçš„å¥æŸ„æ•°æœ‰æ— æ˜æ˜¾å¢é•¿ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨æ€§èƒ½ç›‘è§†å·¥å…·æˆ–è€…åœ¨Procexp.exeé€‰ä¸­è¿›ç¨‹ï¼Œç‚¹å‡»èœå•ä¸­çš„ä¿å­˜å¯ä»¥å­˜æˆtxtæ–‡æœ¬æŸ¥çœ‹ï¼Œå¯ä»¥é€šè¿‡æ¯”è¾ƒå‰åä¸¤æ¬¡çš„txtæŸ¥çœ‹å“ªäº›å¥æŸ„æœ‰æ³„æ¼ã€‚</p>
<h3 id="äºŒã€å®šä½æ–¹æ³•"><a href="#äºŒã€å®šä½æ–¹æ³•" class="headerlink" title="äºŒã€å®šä½æ–¹æ³•"></a>äºŒã€å®šä½æ–¹æ³•</h3><h4 id="1ã€WinDbgåˆ†æå¥æŸ„æ³„æ¼"><a href="#1ã€WinDbgåˆ†æå¥æŸ„æ³„æ¼" class="headerlink" title="1ã€WinDbgåˆ†æå¥æŸ„æ³„æ¼"></a>1ã€WinDbgåˆ†æå¥æŸ„æ³„æ¼</h4><h5 id="1-1-Eventå¥æŸ„æ³„æ¼"><a href="#1-1-Eventå¥æŸ„æ³„æ¼" class="headerlink" title="1.1 Eventå¥æŸ„æ³„æ¼"></a>1.1 Eventå¥æŸ„æ³„æ¼</h5><h6 id="1-1-1-ä»£ç ç¤ºä¾‹"><a href="#1-1-1-ä»£ç ç¤ºä¾‹" class="headerlink" title="1.1.1 ä»£ç ç¤ºä¾‹"></a>1.1.1 ä»£ç ç¤ºä¾‹</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;windows.h&gt;</span><br><span class="line"></span><br><span class="line">// æ•…æ„åˆ¶é€ å¥æŸ„æ³„æ¼</span><br><span class="line">void HandleLeak()</span><br><span class="line">&#123;</span><br><span class="line">    for (int i = 0; ; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        HANDLE hEvent = CreateEvent(NULL, TRUE, FALSE, NULL);</span><br><span class="line">        if (hEvent == NULL)</span><br><span class="line">        &#123;</span><br><span class="line">            printf(&quot;Failed to create event. Error code: %lu\n&quot;, GetLastError());</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        printf(&quot;Created event handle #%d: 0x%p\n&quot;, i + 1, hEvent);</span><br><span class="line">        Sleep(10000);  // æ¯10ç§’åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹ä»¶å¯¹è±¡</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    HandleLeak();</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”Ÿæˆæ–‡ä»¶åä¸ºtestC.exe</p>
<h5 id="1-1-2-windbg-åˆ†æ"><a href="#1-1-2-windbg-åˆ†æ" class="headerlink" title="1.1.2 windbg åˆ†æ"></a>1.1.2 windbg åˆ†æ</h5><p>1ï¼‰æ‰“å¼€WinDbgï¼Œè®¾ç½®å¥½pdbè·¯å¾„ä»¥åŠæºç è·¯å¾„<br><img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202505142011337.png"></p>
<p>2ï¼‰æ‰“å¼€exe</p>
<p><img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202505142011714.png" alt="image.png"></p>
<p><img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202505142017730.png" alt="image-20250514201702704"></p>
<p>3ï¼‰åœ¨WinDbgå‘½ä»¤çª—å£ä¸­æ‰§è¡Œg<br><img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202505142016924.png" alt="image-20250514201650877"></p>
<p>4ï¼‰è¿‡ä¸€ä¼šåï¼Œç‚¹å‡»WinDbgèœå•æ çš„Breakæˆ–è€…æŒ‰ä¸‹Ctrl+Break<br><img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202505142011259.png" alt="image.png"></p>
<p>5ï¼‰æ­¤æ—¶åˆ†åˆ«æ‰§è¡Œä»¥ä¸‹å‘½ä»¤<br>!htrace -enableï¼šå¯ç”¨handle trace,å¹¶ä¸”åˆ›å»ºç¬¬ä¸€ä¸ªå¿«ç…§ä½œä¸ºåˆå§‹çŠ¶æ€ï¼Œæ–¹ä¾¿ä½¿ç”¨ -diffé€‰é¡¹<br>!htraceï¼šæ˜¾ç¤ºå½“å‰çš„æ‰€æœ‰å¥æŸ„ä¿¡æ¯<br>!htrace -snapshotï¼šåˆ›å»ºå¿«ç…§ï¼Œç”¨ä½œ-diffé€‰é¡¹</p>
<p><img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202505142011425.png" alt="image.png"></p>
<p>æ­¤æ—¶ç›¸å½“äºå·²ç»åˆ›å»ºäº†ä¸€ä¸ªå¥æŸ„ä¿¡æ¯å¿«ç…§ï¼Œéšåæ‰§è¡Œä¸€ä¸‹gå‘½ä»¤ï¼Œç»§ç»­è¿è¡Œï¼ŒåŒ3ï¼‰</p>
<p>6ï¼‰ è¿è¡Œä¸€æ®µæ—¶é—´åï¼Œbreakæ‰ï¼ŒåŒ4ï¼‰ï¼Œåœ¨WinDbgå‘½ä»¤çª—å£æ‰§è¡Œ<br>!htrace -diffï¼šä½¿ç”¨å½“å‰çŠ¶æ€çš„ä¿¡æ¯ï¼Œå’Œæœ€è¿‘ä¸€æ¬¡çš„å¿«ç…§ä¿¡æ¯åšå¯¹æ¯”</p>
<p><img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202505142016594.png" alt="image-20250514201638564"></p>
<p><img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202505142016810.png" alt="image-20250514201628783"></p>
<p>ç”±å›¾å¯çŸ¥ï¼Œå’Œå¿«ç…§åšå¯¹æ¯”ï¼Œå‘ç°æ¯”å¿«ç…§å¤šäº†7ä¸ªhandle</p>
<p>7ï¼‰æ ¹æ®6ï¼‰ä¸­çš„handleå€¼ï¼Œæ‰§è¡Œ<br>!handle xxx fï¼šæŸ¥çœ‹ä¸€ä¸‹handleçš„ä¿¡æ¯</p>
<p><img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202505142016075.png" alt="image-20250514201616038"></p>
<p><img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202505142012991.png" alt="image.png"></p>
<p>ä»è¿™é‡Œå¯ä»¥çŸ¥é“è¿™ä¸ªhandleçš„ç±»å‹æ˜¯event ï¼ˆä½†æ˜¯å…¶å®ä»processé‚£ä¸€æ­¥å°±å¯ä»¥çœ‹åˆ°å¥æŸ„çš„ç±»å‹äº†ï¼‰</p>
<p>8ï¼‰åœ¨æœ‰æºç å’Œpdbçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ lsaå‘½ä»¤å®šä½åˆ°æºç æ‰€åœ¨ä½ç½®ï¼Œå¦‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsa KERNELBASE!CreateEventExW+0x0000000000000056</span><br></pre></td></tr></table></figure>
<p>å½“ç„¶è¿™é‡Œå› ä¸ºæ˜¯windowså†…éƒ¨çš„æ¨¡å—ï¼Œæ²¡æœ‰åŠ pdbå’Œæºç ï¼Œå› æ­¤ä¸ä¼šæ˜¾ç¤ºåˆ°å¯¹åº”è¡Œ</p>
<p>9ï¼‰æ ¹æ®7ï¼‰ï¼Œæˆ‘ä»¬çœ‹ä¸è§æ˜¯æˆ‘ä»¬é‚£ä¸€è¡Œä»£ç å¯¼è‡´çš„é—®é¢˜ï¼Œå› æ­¤å¯ä»¥åæ±‡ç¼–è·å–å‡½æ•°çš„è¿”å›åœ°å€ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202505142015647.png" alt="image-20250514201546604"></p>
<p>æˆ‘ä»¬æ‰¾åˆ°è¿”å›åœ°å€ï¼Œå›¾ä¸­ç®­å¤´ä½ç½®ï¼Œæ‹¿åˆ°7713a02aï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤</p>
<p><img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202505142016882.png" alt="image-20250514201602829"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.logappend /u e:/test.logï¼šè¡¨ç¤ºå°†æ­¤å‘½ä»¤çš„ç»“æœAppendåˆ°e:/test.logæ–‡ä»¶ä¸­ï¼Œ/uè¡¨ç¤º in Unicode formatã€‚</span><br><span class="line">k ï¼šè¡¨ç¤ºè¾“å‡ºæ ˆä¿¡æ¯</span><br><span class="line">r eaxï¼šè¡¨ç¤ºè¾“å‡ºeaxå¯„å­˜å™¨çš„å€¼ï¼Œå³å–å‡½æ•°çš„è¿”å›å€¼</span><br><span class="line">.logcloseï¼šè¡¨ç¤ºå…³é—­æ—¥å¿—è®°å½•                             </span><br><span class="line">gï¼šè¡¨ç¤ºå‘½ä¸­æ–­ç‚¹åç»§ç»­æ‰§è¡Œ</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥ç›´æ¥ bp ç„¶åä¸€ä¸ªä¸€ä¸ªçœ‹<br><img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202505142023460.png" alt="image.png"></p>
<p>11ï¼‰æ‰“å¼€test.log</p>
<p><img src="https://gcmz925-note.oss-cn-shenzhen.aliyuncs.com/gcmz/note202505142015563.png" alt="image-20250514201533513"></p>
<p>ç”±æ—¥å¿—å»æŸ¥çœ‹æºä»£ç ï¼Œå‘ç°CreateEventåæ²¡æœ‰closeçš„æ“ä½œï¼Œåˆ°æ­¤å°±å®šä½å‡ºäº†Eventå¥æŸ„æ³„æ¼çš„ä½ç½®ã€‚</p>
<p>å¤‡æ³¨ï¼šå½“æˆ‘ä»¬ä»æ–‡ä»¶å¾—çŸ¥å¯èƒ½å‡ºç°å¥æŸ„æ³„æ¼çš„å¥æŸ„æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨windbgæŒ‚å¯¹åº”çš„è¿›ç¨‹ï¼Œç­‰å¯¹åº”çš„è¿›ç¨‹æˆ–ç›®å½•æˆ–å…¶ä»–åç§°å‡ºç°ï¼Œè¿™ä¸ªæ—¶å€™ç”¨procexpçœ‹å¯¹åº”å¥æŸ„å€¼ï¼Œå†åœ¨windbgæ‰§è¡Œ!htrace -diffçš„å†…å®¹ä¸­æŸ¥æ‰¾å¯¹åº”çš„å¥æŸ„å€¼ã€‚</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/04/22/linux/liunx%20%E7%BC%96%E8%AF%91%E5%91%8A%E8%AD%A6%E9%80%9F%E6%9F%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/04/22/linux/liunx%20%E7%BC%96%E8%AF%91%E5%91%8A%E8%AD%A6%E9%80%9F%E6%9F%A5/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2025-04-22 16:17:41 / Modified: 17:28:08" itemprop="dateCreated datePublished" datetime="2025-04-22T16:17:41+08:00">2025-04-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>1.å¤šçº§å®å®šä¹‰å¯ä»¥åŠ  <code>error</code></p>
<blockquote>
<p>ä½¿ç”¨å¤šçº§å®åˆ¤æ–­æ—¶ï¼Œåˆ¤æ–­è¿›å…¥å“ªä¸€åˆ†æ”¯ï¼Œå¯ä»¥åœ¨ç¼–ç ä¸­åŠ å…¥  <code>error</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#ifdef __x86__</span><br><span class="line">    // x86 å¤„ç†</span><br><span class="line">#elif defined(__arm__)</span><br><span class="line">    // ARM å¤„ç†</span><br><span class="line">    #error &quot;Unsupported architecture. Please define a valid arch macro.&quot;</span><br><span class="line">#endif</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/04/22/linux/linux%20CONTAINING_RECORD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/04/22/linux/linux%20CONTAINING_RECORD/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2025-04-22 15:37:04 / Modified: 16:17:30" itemprop="dateCreated datePublished" datetime="2025-04-22T15:37:04+08:00">2025-04-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>åœ¨ C è¯­è¨€å¼€å‘ä¸­ï¼Œå°¤å…¶æ˜¯é©±åŠ¨å¼€å‘å’Œå†…æ ¸çº§ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸éœ€è¦ä»ç»“æ„ä½“çš„æŸä¸ªæˆå‘˜æŒ‡é’ˆï¼Œåæ¨æ•´ä¸ªç»“æ„ä½“çš„èµ·å§‹åœ°å€ã€‚è¿™åœ¨å®ç°å†…æ ¸é“¾è¡¨ï¼ˆå¦‚ Windows å†…æ ¸çš„ LIST_ENTRYï¼‰ã€å¯¹è±¡å°è£…æˆ–å›è°ƒç³»ç»Ÿä¸­å°¤ä¸ºå¸¸è§ã€‚å®ç°è¿™ä¸€éœ€æ±‚çš„æ ¸å¿ƒæŠ€å·§å°±æ˜¯ä½¿ç”¨ <code>CONTAINING_RECORD</code> å®ï¼Œå®ƒçš„å®ç°èƒŒåï¼Œæ­£æ˜¯ <code>&amp;((type*)0)-&gt;member</code> è¿™æ ·çš„åç§»é‡è®¡ç®—æŠ€å·§ã€‚</p>
<h2 id="ä¸€ã€CONTAINING-RECORD-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ä¸€ã€CONTAINING-RECORD-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ä¸€ã€CONTAINING_RECORD æ˜¯ä»€ä¹ˆï¼Ÿ"></a>ä¸€ã€CONTAINING_RECORD æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p><code>CONTAINING_RECORD</code> æ˜¯ä¸€ä¸ªå®ï¼Œå®ƒçš„å®šä¹‰å¦‚ä¸‹ï¼ˆå¸¸è§ç‰ˆæœ¬ï¼‰ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> CONTAINING_RECORD(address, type, field) \</span></span><br><span class="line"><span class="meta">    ((type *)((char *)(address) - (size_t)&amp;(((type *)0)-&gt;field)))</span></span><br></pre></td></tr></table></figure>

<p>å®ƒçš„ä½œç”¨æ˜¯ï¼š</p>
<blockquote>
<p>å·²çŸ¥ç»“æ„ä½“ <code>type</code> ä¸­ <code>field</code> æˆå‘˜çš„åœ°å€ä¸º <code>address</code>ï¼Œåæ¨å‡ºç»“æ„ä½“ <code>type</code> çš„èµ·å§‹åœ°å€ã€‚</p>
</blockquote>
<h2 id="äºŒã€å®æ‹†è§£åˆ†æ"><a href="#äºŒã€å®æ‹†è§£åˆ†æ" class="headerlink" title="äºŒã€å®æ‹†è§£åˆ†æ"></a>äºŒã€å®æ‹†è§£åˆ†æ</h2><p>æˆ‘ä»¬æ¥é€æ­¥æ‹†è§£è¿™ä¸ªå®ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="type">char</span> *)(address)</span><br></pre></td></tr></table></figure>

<ul>
<li>å°†æˆå‘˜åœ°å€å¼ºåˆ¶è½¬æ¢ä¸º <code>char*</code> ç±»å‹æ˜¯ä¸ºäº†æ–¹ä¾¿åšå­—èŠ‚çº§çš„æŒ‡é’ˆè¿ç®—ã€‚</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="type">size_t</span>)&amp;(((type *)<span class="number">0</span>)-&gt;field)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>è¿™éƒ¨åˆ†æ˜¯è®¡ç®— <code>field</code> æˆå‘˜åœ¨ <code>type</code> ç»“æ„ä½“ä¸­çš„åç§»é‡ã€‚</p>
</li>
<li><p>é€šè¿‡å°† 0 å¼ºåˆ¶è½¬æ¢ä¸º <code>type*</code> æŒ‡é’ˆï¼Œè®¿é—®å®ƒçš„ <code>field</code> æˆå‘˜ï¼Œå†å–åœ°å€ï¼Œå°±å¯ä»¥å¾—åˆ° <code>field</code> ç›¸å¯¹äºç»“æ„ä½“èµ·å§‹åœ°å€çš„åç§»ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚</p>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((<span class="type">char</span> *)(address) - åç§»é‡)</span><br></pre></td></tr></table></figure>

<ul>
<li>ä»æˆå‘˜åœ°å€ä¸­å‡å»åç§»é‡ï¼Œå°±å¾—åˆ°äº†ç»“æ„ä½“é¦–åœ°å€ã€‚</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((type *)...)</span><br></pre></td></tr></table></figure>

<ul>
<li>æœ€åï¼Œå°†ç»“æœå¼ºåˆ¶è½¬æ¢ä¸ºç»“æ„ä½“æŒ‡é’ˆç±»å‹ã€‚</li>
</ul>
<h2 id="ä¸‰ã€å®é™…ä¾‹å­"><a href="#ä¸‰ã€å®é™…ä¾‹å­" class="headerlink" title="ä¸‰ã€å®é™…ä¾‹å­"></a>ä¸‰ã€å®é™…ä¾‹å­</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">MY_STRUCT</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> a;</span><br><span class="line">    <span class="type">int</span> b;</span><br><span class="line">&#125; MY_STRUCT;</span><br><span class="line"></span><br><span class="line">MY_STRUCT s = &#123;<span class="number">10</span>, <span class="number">20</span>&#125;;</span><br><span class="line"><span class="type">int</span> *pb = &amp;s.b;</span><br><span class="line"></span><br><span class="line">MY_STRUCT *ps = CONTAINING_RECORD(pb, MY_STRUCT, b);</span><br></pre></td></tr></table></figure>

<p>å±•å¼€åå°±æ˜¯ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps = (MY_STRUCT *)((<span class="type">char</span> *)pb - offsetof(MY_STRUCT, b));</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä½ ä¼šå‘ç°ï¼Œ<code>CONTAINING_RECORD</code> å…¶å®å’Œ <code>offsetof</code> çš„æœ¬è´¨æ˜¯ä¸€è‡´çš„ï¼Œéƒ½æ˜¯åŸºäºæˆå‘˜åç§»é‡è®¡ç®—ç»“æ„ä½“åœ°å€ã€‚</p>
</blockquote>
<h2 id="å››ã€åº”ç”¨åœºæ™¯"><a href="#å››ã€åº”ç”¨åœºæ™¯" class="headerlink" title="å››ã€åº”ç”¨åœºæ™¯"></a>å››ã€åº”ç”¨åœºæ™¯</h2><p>è¿™ä¸ªå®åœ¨å®é™…å¼€å‘ä¸­çš„ç”¨é€”éå¸¸å¹¿æ³›ï¼Œä»¥ä¸‹æ˜¯å¸¸è§åœºæ™¯ï¼š</p>
<h3 id="1-å†…æ ¸é“¾è¡¨ç»“æ„"><a href="#1-å†…æ ¸é“¾è¡¨ç»“æ„" class="headerlink" title="1. å†…æ ¸é“¾è¡¨ç»“æ„"></a>1. å†…æ ¸é“¾è¡¨ç»“æ„</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">DEVICE</span> &#123;</span></span><br><span class="line">    LIST_ENTRY List;</span><br><span class="line">    <span class="type">int</span> DeviceId;</span><br><span class="line">&#125; DEVICE;</span><br><span class="line"></span><br><span class="line">DEVICE *dev = CONTAINING_RECORD(pListEntry, DEVICE, List);</span><br></pre></td></tr></table></figure>

<h2 id="äº”ã€å°ç»“"><a href="#äº”ã€å°ç»“" class="headerlink" title="äº”ã€å°ç»“"></a>äº”ã€å°ç»“</h2><p><code>CONTAINING_RECORD</code> çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š</p>
<blockquote>
<p><strong>ç»“æ„ä½“æŒ‡é’ˆ &#x3D; æˆå‘˜æŒ‡é’ˆ - æˆå‘˜åç§»é‡</strong></p>
</blockquote>
<p>å®ƒçœ‹èµ·æ¥æœ‰ç‚¹é»‘é­”æ³•ï¼Œä½†å®é™…æ˜¯ä¸€ç§éå¸¸é«˜æ•ˆã€é›¶å¼€é”€çš„åšæ³•ï¼Œç”¨å¥½äº†èƒ½å†™å‡ºéå¸¸ä¼˜é›…çš„åº•å±‚ä»£ç ã€‚</p>
<p>è¿™ä¸ªæŠ€å·§èƒŒåæœ€æ ¹æœ¬çš„å°±æ˜¯ <code>&amp;((type *)0)-&gt;member</code>ï¼Œå»ºè®®ä½ æ·±å…¥ç†è§£è¿™ä¸ªè¡¨è¾¾å¼èƒŒåçš„å«ä¹‰å’Œä½¿ç”¨æ–¹å¼ï¼Œå®ƒä¸ä»…å¯¹ç†è§£ <code>CONTAINING_RECORD</code> æœ‰å¸®åŠ©ï¼Œæ›´æ˜¯å¾ˆå¤šåº•å±‚ C è¯­è¨€æŠ€å·§çš„åŸºç¡€ã€‚</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">John Doe</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
